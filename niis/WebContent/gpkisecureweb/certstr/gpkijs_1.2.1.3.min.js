/*! GPKIJS-v1.2.1.3-2021.07.21-(c) 2014~2020, Dreamsecurity co.,ltd. All rights reserved. Some or all of MagicJS module, reproduced without the consent of DreamSecurity, modify, decompile, conversion into other languages is forbidden to use and distribute . MagicJS module is developed based on 'The forge software' of Digital Bazaar.*/
!function(){var n,i="dreamsecurity";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={disableNativeCode:!0});var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./aesCipherSuites","./asn1","./cipher","./cipherModes","./debug","./des","./hmac","./kem","./log","./md","./mgf1","./pbkdf2","./pem","./pkcs7","./pkcs1","./pkcs12","./pki","./prime","./prng","./pss","./random","./rc2","./ssh","./task","./tls","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)});if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e},e.exports.disableNativeCode=!1,e.exports(e.exports)}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){var t=e.intg=e.intg||{};e.vi={},e.vi.s="1d66620622b24abf758394fbbcb9978ee10a548d205404f171b6ee6d13cf4ae898d08de2d072dbb444fd36176d7ceaaf1eb77279d0c3ee99211efd8cfc6e841ece9e9365fae2764fd2f72d98b32da4e4954356d2e255ef0ebf4c171037eeea96f90e8a90f37ce5a0b9e0aad9e5bad40500741729c5f9ee52348acda60b8e4592dfc7492a4e2d8da4b9d66e356bba0e28b86efdd9dda099b3cf720fa48965b1445789769af0254bb32cac5f28da5bd0c6eeeecd528c82824990d675a9301e2bba56afd8a496a4f9e9374da913f4b3899e6ccaa677b9b7bcc7c151b322a93468937823d04fdf9e7f87c4d7066f83686c1e04d41257a22aa504fd8e52144445b2c551103c6e60fcfe65fc2046bbc90cf3228f33d7fd201e15a2050cb64f6ac0d511f70d6245fcc2af4d084b0fcffa",e.vi.gf=!1,e.vi.init=!1,t.digestLength=32,t.blockSize=64;var E=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function o(e,t,r,a,n,i){for(var s,o,c,u,d,l,p,f,y,h,g,m,C;64<=n;){for(s=t[0],o=t[1],c=t[2],u=t[3],d=t[4],l=t[5],p=t[6],f=t[7],h=0;h<16;h++)g=a+4*h,e[h]=i?(255&r.charCodeAt(g))<<24|(255&r.charCodeAt(g+1))<<16|(255&r.charCodeAt(g+2))<<8|255&r.charCodeAt(g+3):(255&r[g])<<24|(255&r[g+1])<<16|(255&r[g+2])<<8|255&r[g+3];for(h=16;h<64;h++)m=((y=e[h-2])>>>17|y<<15)^(y>>>19|y<<13)^y>>>10,C=((y=e[h-15])>>>7|y<<25)^(y>>>18|y<<14)^y>>>3,e[h]=(m+e[h-7]|0)+(C+e[h-16]|0);for(h=0;h<64;h++)m=(((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+(d&l^~d&p)|0)+(f+(E[h]+e[h]|0)|0)|0,C=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&c^o&c)|0,f=p,p=l,l=d,d=u+m|0,u=c,c=o,o=s,s=m+C|0;t[0]+=s,t[1]+=o,t[2]+=c,t[3]+=u,t[4]+=d,t[5]+=l,t[6]+=p,t[7]+=f,a+=64,n-=64}return a}var a=(r.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},r.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},r.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this.bytesHashed+=t,0<this.bufferLength){for(;this.bufferLength<64&&0<t;)this.buffer[this.bufferLength++]=e.charCodeAt(r++),t--;64===this.bufferLength&&(o(this.temp,this.state,this.buffer,0,64,!1),this.bufferLength=0)}for(64<=t&&(r=o(this.temp,this.state,e,r,t,!0),t%=64);0<t;)this.buffer[this.bufferLength++]=e.charCodeAt(r++),t--;return this},r.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,r=this.bufferLength,a=t/536870912|0,n=t<<3,i=t%64<56?64:128;this.buffer[r]=128;for(var s=r+1;s<i-8;s++)this.buffer[s]=0;this.buffer[i-8]=a>>>24&255,this.buffer[i-7]=a>>>16&255,this.buffer[i-6]=a>>>8&255,this.buffer[i-5]=a>>>0&255,this.buffer[i-4]=n>>>24&255,this.buffer[i-3]=n>>>16&255,this.buffer[i-2]=n>>>8&255,this.buffer[i-1]=n>>>0&255,o(this.temp,this.state,this.buffer,0,i,!1),this.finished=!0}for(s=0;s<8;s++)e[4*s+0]=this.state[s]>>>24&255,e[4*s+1]=this.state[s]>>>16&255,e[4*s+2]=this.state[s]>>>8&255,e[4*s+3]=this.state[s]>>>0&255;return this},r.prototype.digest=function(){var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return this.finish(e),String.fromCharCode.apply(null,e)},r.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},r.prototype._restoreState=function(e,t){for(var r=0;r<this.state.length;r++)this.state[r]=e[r];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},r);function r(){this.digestLength=t.digestLength,this.blockSize=t.blockSize,this.state=new Array(8),this.temp=new Array(64),this.buffer=new Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}t.create=function(e){var t=(new a).update(e),r=t.digest();return t.clean(),r}}var i,s="intg";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function C(h){var g,m;null!=h?((g=h.asn1=h.asn1||{}).Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},g.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},g.create=function(e,t,r,a){if(h.util.isArray(a)){for(var n=[],i=0;i<a.length;++i)void 0!==a[i]&&n.push(a[i]);a=n}return{tagClass:e,type:t,constructed:r,composed:r||h.util.isArray(a),value:a}},m=function(e){var t=e.getByte();if(128!==t){var r=128&t?e.getInt((127&t)<<3):t;return r}},g.fromDer=function(e,t,r){if(arguments.length<4&&C(),void 0===t&&(t=!0),void 0===r&&(r=!0),"string"==typeof e&&(e=h.util.createBuffer(e)),e.length()<2)throw(a=new Error("Too few bytes to parse DER.")).bytes=e.length(),a;var a,n,i=e.getByte(),s=192&i,o=31&i,c=m(e);if(e.length()<c){if(t)throw(a=new Error("Too few bytes to read ASN.1 value.")).detail=e.length()+" < "+c,a;c=e.length()}var u=32==(32&i);if(!(l=u)&&r&&s===g.Class.UNIVERSAL&&o===g.Type.BITSTRING&&1<c){var d=e.read;if(0===e.getByte()){var l,p=192&e.getByte();if(p===g.Class.UNIVERSAL||p===g.Class.CONTEXT_SPECIFIC)try{(l=m(e)===c-(e.read-d))&&(++d,--c)}catch(e){throw new Error("Error in asn1.fromDer()")}}e.read=d}if(l)if(n=[],void 0===c)for(;;){if(e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2);break}n.push(g.fromDer(e,t,r,!0))}else for(var f=e.length();0<c;)n.push(g.fromDer(e,t,r,!0)),c-=f-e.length(),f=e.length();else{if(void 0===c){if(t)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e.length()}if(o===g.Type.BMPSTRING){n="";for(var y=0;y<c;y+=2)n+=String.fromCharCode(e.getInt16())}else n=e.getBytes(c)}return g.create(s,o,u,n)},g.toDer=function(e){1==arguments.length&&C();var t=h.util.createBuffer(),r=e.tagClass|e.type,a=h.util.createBuffer();if(e.composed){e.constructed?r|=32:a.putByte(0);for(var n=0;n<e.value.length;++n)void 0!==e.value[n]&&a.putBuffer(g.toDer(e.value[n],!0))}else if(e.type===g.Type.BMPSTRING)for(n=0;n<e.value.length;++n)a.putInt16(e.value.charCodeAt(n));else a.putBytes(e.value);if(t.putByte(r),a.length()<=127)t.putByte(127&a.length());else{for(var i=a.length(),s="";s+=String.fromCharCode(255&i),0<(i>>>=8););t.putByte(128|s.length);for(n=s.length-1;0<=n;--n)t.putByte(s.charCodeAt(n))}return t.putBuffer(a),t},g.oidToDer=function(e){var t,r,a,n,i=e.split("."),s=h.util.createBuffer();s.putByte(40*parseInt(i[0],10)+parseInt(i[1],10));for(var o=2;o<i.length;++o){for(t=!0,r=[],a=parseInt(i[o],10);n=127&a,a>>>=7,t||(n|=128),r.push(n),t=!1,0<a;);for(var c=r.length-1;0<=c;--c)s.putByte(r[c])}return s},g.derToOid=function(e){"string"==typeof e&&(e=h.util.createBuffer(e));for(var t=e.getByte(),r=Math.floor(t/40)+"."+t%40,a=0;0<e.length();)a<<=7,128&(t=e.getByte())?a+=127&t:(r+="."+(a+t),a=0);return r},g.utcTimeToDate=function(e){var t,r,a,n=new Date,i=50<=(i=parseInt(e.substr(0,2),10))?1900+i:2e3+i,s=parseInt(e.substr(2,2),10)-1,o=parseInt(e.substr(4,2),10),c=parseInt(e.substr(6,2),10),u=parseInt(e.substr(8,2),10),d=0;return 11<e.length&&(t=10,"+"!==(a=e.charAt(10))&&"-"!==a&&(d=parseInt(e.substr(10,2),10),t+=2)),n.setUTCFullYear(i,s,o),n.setUTCHours(c,u,d,0),t&&("+"!==(a=e.charAt(t))&&"-"!==a||(r=60*parseInt(e.substr(t+1,2),10)+parseInt(e.substr(t+4,2),10),r*=6e4,"+"===a?n.setTime(n-r):n.setTime(+n+r))),n},g.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),a=parseInt(e.substr(4,2),10)-1,n=parseInt(e.substr(6,2),10),i=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),c=0,u=0,d=!1;"Z"===e.charAt(e.length-1)&&(d=!0);var l=e.length-5,p=e.charAt(l);return"+"!==p&&"-"!==p||(u=60*parseInt(e.substr(1+l,2),10)+parseInt(e.substr(4+l,2),10),u*=6e4,"+"===p&&(u*=-1),d=!0),"."===e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),d?(t.setUTCFullYear(r,a,n),t.setUTCHours(i,s,o,c),t.setTime(+t+u)):(t.setFullYear(r,a,n),t.setHours(i,s,o,c)),t},g.dateToUtcTime=function(e){var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var a=0;a<r.length;++a)r[a].length<2&&(t+="0"),t+=r[a];return t+="Z"},g.integerToDer=function(e){var t=h.util.createBuffer();if(-128<=e&&e<128)return t.putSignedInt(e,8);if(-32768<=e&&e<32768)return t.putSignedInt(e,16);if(-8388608<=e&&e<8388608)return t.putSignedInt(e,24);if(-2147483648<=e&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},g.derToInteger=function(e){"string"==typeof e&&(e=h.util.createBuffer(e));var t=8*e.length();if(32<t)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},g.validate=function(e,t,r,a){var n=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)a&&(e.tagClass!==t.tagClass&&a.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&a.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(n=!0,t.value&&h.util.isArray(t.value))for(var i=0,s=0;n&&s<t.value.length;++s)n=t.value[s].optional||!1,e.value[i]&&((n=g.validate(e.value[i],t.value[s],r,a))?++i:t.value[s].optional&&(n=!0)),!n&&a&&a.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');n&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e))}else a&&a.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return n}):"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"asn1")}var n,i="asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),C(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./oids"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(C);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){var t;function E(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function v(){return new E(null)}function r(e,t,r,a,n,i){for(var s=16383&t,o=t>>14;0<=--i;){var c=16383&this.data[e],u=this.data[e++]>>14,d=o*c+u*s;n=((c=s*c+((16383&d)<<14)+r.data[a]+n)>>28)+(d>>14)+o*u,r.data[a++]=268435455&c}return n}t="undefined"==typeof navigator?(E.prototype.am=r,28):"Microsoft Internet Explorer"==navigator.appName?(E.prototype.am=function(e,t,r,a,n,i){for(var s=32767&t,o=t>>15;0<=--i;){var c=32767&this.data[e],u=this.data[e++]>>15,d=o*c+u*s;n=((c=s*c+((32767&d)<<15)+r.data[a]+(1073741823&n))>>>30)+(d>>>15)+o*u+(n>>>30),r.data[a++]=1073741823&c}return n},30):"Netscape"!=navigator.appName?(E.prototype.am=function(e,t,r,a,n,i){for(;0<=--i;){var s=t*this.data[e++]+r.data[a]+n;n=Math.floor(s/67108864),r.data[a++]=67108863&s}return n},26):(E.prototype.am=r,28),E.prototype.DB=t,E.prototype.DM=(1<<t)-1,E.prototype.DV=1<<t;E.prototype.FV=Math.pow(2,52),E.prototype.F1=52-t,E.prototype.F2=2*t-52;for(var a="0123456789abcdefghijklmnopqrstuvwxyz",n=new Array,i="0".charCodeAt(0),s=0;s<=9;++s)n[i++]=s;for(i="a".charCodeAt(0),s=10;s<36;++s)n[i++]=s;for(i="A".charCodeAt(0),s=10;s<36;++s)n[i++]=s;function c(e){return a.charAt(e)}function u(e,t){var r=n[e.charCodeAt(t)];return null==r?-1:r}function g(e){var t=v();return t.fromInt(e),t}function S(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function m(e){this.m=e}function C(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function o(e,t){return e&t}function d(e,t){return e|t}function l(e,t){return e^t}function p(e,t){return e&~t}function f(){}function y(e){return e}function T(e){this.r2=v(),this.q3=v(),E.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}m.prototype.convert=function(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},m.prototype.revert=function(e){return e},m.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},m.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},m.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},C.prototype.convert=function(e){var t=v();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(E.ZERO)&&this.m.subTo(t,t),t},C.prototype.revert=function(e){var t=v();return e.copyTo(t),this.reduce(t),t},C.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=(a=32767&e.data[t])*this.mpl+((a*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM,a=t+this.m.t;for(e.data[a]+=this.m.am(0,r,e,t,0,this.m.t);e.data[a]>=e.DV;)e.data[a]-=e.DV,e.data[++a]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},C.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},C.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},E.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},E.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,0<e?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},E.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var a=e.length,n=!1,i=0;0<=--a;){var s=8==r?255&e[a]:u(e,a);s<0?"-"==e.charAt(a)&&(n=!0):(n=!1,0==i?this.data[this.t++]=s:i+r>this.DB?(this.data[this.t-1]|=(s&(1<<this.DB-i)-1)<<i,this.data[this.t++]=s>>this.DB-i):this.data[this.t-1]|=s<<i,(i+=r)>=this.DB&&(i-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,0<i&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),n&&E.ZERO.subTo(this,this)},E.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this.data[this.t-1]==e;)--this.t},E.prototype.dlShiftTo=function(e,t){for(var r=this.t-1;0<=r;--r)t.data[r+e]=this.data[r];for(r=e-1;0<=r;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},E.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},E.prototype.lShiftTo=function(e,t){for(var r=e%this.DB,a=this.DB-r,n=(1<<a)-1,i=Math.floor(e/this.DB),s=this.s<<r&this.DM,o=this.t-1;0<=o;--o)t.data[o+i+1]=this.data[o]>>a|s,s=(this.data[o]&n)<<r;for(o=i-1;0<=o;--o)t.data[o]=0;t.data[i]=s,t.t=this.t+i+1,t.s=this.s,t.clamp()},E.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var a=e%this.DB,n=this.DB-a,i=(1<<a)-1;t.data[0]=this.data[r]>>a;for(var s=r+1;s<this.t;++s)t.data[s-r-1]|=(this.data[s]&i)<<n,t.data[s-r]=this.data[s]>>a;0<a&&(t.data[this.t-r-1]|=(this.s&i)<<n),t.t=this.t-r,t.clamp()}},E.prototype.subTo=function(e,t){for(var r=0,a=0,n=Math.min(e.t,this.t);r<n;)a+=this.data[r]-e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a-=e.s;r<this.t;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;r<e.t;)a-=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a-=e.s}t.s=a<0?-1:0,a<-1?t.data[r++]=this.DV+a:0<a&&(t.data[r++]=a),t.t=r,t.clamp()},E.prototype.multiplyTo=function(e,t){var r=this.abs(),a=e.abs(),n=r.t;for(t.t=n+a.t;0<=--n;)t.data[n]=0;for(n=0;n<a.t;++n)t.data[n+r.t]=r.am(0,a.data[n],t,n,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&E.ZERO.subTo(t,t)},E.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e.data[r]=0;for(r=0;r<t.t-1;++r){var a=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,a,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}0<e.t&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},E.prototype.divRemTo=function(e,t,r){var a=e.abs();if(!(a.t<=0)){var n=this.abs();if(n.t<a.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=v());var i=v(),s=this.s,o=e.s,c=this.DB-S(a.data[a.t-1]);0<c?(a.lShiftTo(c,i),n.lShiftTo(c,r)):(a.copyTo(i),n.copyTo(r));var u=i.t,d=i.data[u-1];if(0!=d){var l=d*(1<<this.F1)+(1<u?i.data[u-2]>>this.F2:0),p=this.FV/l,f=(1<<this.F1)/l,y=1<<this.F2,h=r.t,g=h-u,m=null==t?v():t;for(i.dlShiftTo(g,m),0<=r.compareTo(m)&&(r.data[r.t++]=1,r.subTo(m,r)),E.ONE.dlShiftTo(u,m),m.subTo(i,i);i.t<u;)i.data[i.t++]=0;for(;0<=--g;){var C=r.data[--h]==d?this.DM:Math.floor(r.data[h]*p+(r.data[h-1]+y)*f);if((r.data[h]+=i.am(0,C,r,g,0,u))<C)for(i.dlShiftTo(g,m),r.subTo(m,r);r.data[h]<--C;)r.subTo(m,r)}null!=t&&(r.drShiftTo(u,t),s!=o&&E.ZERO.subTo(t,t)),r.t=u,r.clamp(),0<c&&r.rShiftTo(c,r),s<0&&E.ZERO.subTo(r,r)}}},E.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},E.prototype.isEven=function(){return 0==(0<this.t?1&this.data[0]:this.s)},E.prototype.exp=function(e,t){if(4294967295<e||e<1)return E.ONE;var r,a=v(),n=v(),i=t.convert(this),s=S(e)-1;for(i.copyTo(a);0<=--s;){t.sqrTo(a,n),0<(e&1<<s)?t.mulTo(n,i,a):(r=a,a=n,n=r)}return t.revert(a)},E.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,a=(1<<t)-1,n=!1,i="",s=this.t,o=this.DB-s*this.DB%t;if(0<s--)for(o<this.DB&&0<(r=this.data[s]>>o)&&(n=!0,i=c(r));0<=s;)o<t?(r=(this.data[s]&(1<<o)-1)<<t-o,r|=this.data[--s]>>(o+=this.DB-t)):(r=this.data[s]>>(o-=t)&a,o<=0&&(o+=this.DB,--s)),0<r&&(n=!0),n&&(i+=c(r));return n?i:"0"},E.prototype.negate=function(){var e=v();return E.ZERO.subTo(this,e),e},E.prototype.abs=function(){return this.s<0?this.negate():this},E.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;0<=--r;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},E.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+S(this.data[this.t-1]^this.s&this.DM)},E.prototype.mod=function(e){var t=v();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(E.ZERO)&&e.subTo(t,t),t},E.prototype.modPowInt=function(e,t){var r=new(e<256||t.isEven()?m:C)(t);return this.exp(e,r)},E.ZERO=g(0),E.ONE=g(1),f.prototype.convert=y,f.prototype.revert=y,f.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},f.prototype.sqrTo=function(e,t){e.squareTo(t)},T.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=v();return e.copyTo(t),this.reduce(t),t},T.prototype.revert=function(e){return e},T.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},T.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},T.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var h=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],I=(1<<26)/h[h.length-1];E.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},E.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),a=g(r),n=v(),i=v(),s="";for(this.divRemTo(a,n,i);0<n.signum();)s=(r+i.intValue()).toString(e).substr(1)+s,n.divRemTo(a,n,i);return i.intValue().toString(e)+s},E.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),a=Math.pow(t,r),n=!1,i=0,s=0,o=0;o<e.length;++o){var c=u(e,o);c<0?"-"==e.charAt(o)&&0==this.signum()&&(n=!0):(s=t*s+c,++i>=r&&(this.dMultiply(a),this.dAddOffset(s,0),s=i=0))}0<i&&(this.dMultiply(Math.pow(t,i)),this.dAddOffset(s,0)),n&&E.ZERO.subTo(this,this)},E.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(E.ONE.shiftLeft(e-1),d,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(E.ONE.shiftLeft(e-1),this);else{var a=new Array,n=7&e;a.length=1+(e>>3),t.nextBytes(a),0<n?a[0]&=(1<<n)-1:a[0]=0,this.fromString(a,256)}},E.prototype.bitwiseTo=function(e,t,r){for(var a,n=Math.min(e.t,this.t),i=0;i<n;++i)r.data[i]=t(this.data[i],e.data[i]);if(e.t<this.t){for(a=e.s&this.DM,i=n;i<this.t;++i)r.data[i]=t(this.data[i],a);r.t=this.t}else{for(a=this.s&this.DM,i=n;i<e.t;++i)r.data[i]=t(a,e.data[i]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},E.prototype.changeBit=function(e,t){var r=E.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},E.prototype.addTo=function(e,t){for(var r=0,a=0,n=Math.min(e.t,this.t);r<n;)a+=this.data[r]+e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;if(e.t<this.t){for(a+=e.s;r<this.t;)a+=this.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=this.s}else{for(a+=this.s;r<e.t;)a+=e.data[r],t.data[r++]=a&this.DM,a>>=this.DB;a+=e.s}t.s=a<0?-1:0,0<a?t.data[r++]=a:a<-1&&(t.data[r++]=this.DV+a),t.t=r,t.clamp()},E.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},E.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},E.prototype.multiplyLowerTo=function(e,t,r){var a,n=Math.min(this.t+e.t,t);for(r.s=0,r.t=n;0<n;)r.data[--n]=0;for(a=r.t-this.t;n<a;++n)r.data[n+this.t]=this.am(0,e.data[n],r,n,0,this.t);for(a=Math.min(e.t,t);n<a;++n)this.am(0,e.data[n],r,n,0,t-n);r.clamp()},E.prototype.multiplyUpperTo=function(e,t,r){--t;var a=r.t=this.t+e.t-t;for(r.s=0;0<=--a;)r.data[a]=0;for(a=Math.max(t-this.t,0);a<e.t;++a)r.data[this.t+a-t]=this.am(t-a,e.data[a],r,0,0,this.t+a-t);r.clamp(),r.drShiftTo(1,r)},E.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(0<this.t)if(0==t)r=this.data[0]%e;else for(var a=this.t-1;0<=a;--a)r=(t*r+this.data[a])%e;return r},E.prototype.millerRabin=function(e){var t=this.subtract(E.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var a,n=t.shiftRight(r),i={nextBytes:function(e){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues){Math.ceil(e.length/4);var r=new Uint32Array(Math.ceil(e.length/4));t.getRandomValues(r);for(var a=0,n=0;n<r.length;++n)n==r.length-1?(a<e.length&&(e[a++]=r[n]>>24&255),a<e.length&&(e[a++]=r[n]>>16&255),a<e.length&&(e[a++]=r[n]>>8&255),a<e.length&&(e[a++]=255&r[n])):(e[a++]=r[n]>>24&255,e[a++]=r[n]>>16&255,e[a++]=r[n]>>8&255,e[a++]=255&r[n])}else for(n=0;n<e.length;++n)e[n]=Math.floor(255*Math.random())}},s=0;s<e;++s){for(;(a=new E(this.bitLength(),i)).compareTo(E.ONE)<=0||0<=a.compareTo(t););var o=a.modPow(n,this);if(0!=o.compareTo(E.ONE)&&0!=o.compareTo(t)){for(var c=1;c++<r&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(E.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},E.prototype.clone=function(){var e=v();return this.copyTo(e),e},E.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},E.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},E.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},E.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},E.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,a=this.DB-e*this.DB%8,n=0;if(0<e--)for(a<this.DB&&(r=this.data[e]>>a)!=(this.s&this.DM)>>a&&(t[n++]=r|this.s<<this.DB-a);0<=e;)a<8?(r=(this.data[e]&(1<<a)-1)<<8-a,r|=this.data[--e]>>(a+=this.DB-8)):(r=this.data[e]>>(a-=8)&255,a<=0&&(a+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==n&&(128&this.s)!=(128&r)&&++n,(0<n||r!=this.s)&&(t[n++]=r);return t},E.prototype.equals=function(e){return 0==this.compareTo(e)},E.prototype.min=function(e){return this.compareTo(e)<0?this:e},E.prototype.max=function(e){return 0<this.compareTo(e)?this:e},E.prototype.and=function(e){var t=v();return this.bitwiseTo(e,o,t),t},E.prototype.or=function(e){var t=v();return this.bitwiseTo(e,d,t),t},E.prototype.xor=function(e){var t=v();return this.bitwiseTo(e,l,t),t},E.prototype.andNot=function(e){var t=v();return this.bitwiseTo(e,p,t),t},E.prototype.not=function(){for(var e=v(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},E.prototype.shiftLeft=function(e){var t=v();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},E.prototype.shiftRight=function(e){var t=v();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},E.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+function(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}(this.data[e]);return this.s<0?this.t*this.DB:-1},E.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=function(e){for(var t=0;0!=e;)e&=e-1,++t;return t}(this.data[r]^t);return e},E.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},E.prototype.setBit=function(e){return this.changeBit(e,d)},E.prototype.clearBit=function(e){return this.changeBit(e,p)},E.prototype.flipBit=function(e){return this.changeBit(e,l)},E.prototype.add=function(e){var t=v();return this.addTo(e,t),t},E.prototype.subtract=function(e){var t=v();return this.subTo(e,t),t},E.prototype.multiply=function(e){var t=v();return this.multiplyTo(e,t),t},E.prototype.divide=function(e){var t=v();return this.divRemTo(e,t,null),t},E.prototype.remainder=function(e){var t=v();return this.divRemTo(e,null,t),t},E.prototype.divideAndRemainder=function(e){var t=v(),r=v();return this.divRemTo(e,t,r),new Array(t,r)},E.prototype.modPow=function(e,t){var r,a,n=e.bitLength(),i=g(1);if(n<=0)return i;r=n<18?1:n<48?3:n<144?4:n<768?5:6,a=new(n<8?m:t.isEven()?T:C)(t);var s=new Array,o=3,c=r-1,u=(1<<r)-1;if(s[1]=a.convert(this),1<r){var d=v();for(a.sqrTo(s[1],d);o<=u;)s[o]=v(),a.mulTo(d,s[o-2],s[o]),o+=2}for(var l,p,f=e.t-1,y=!0,h=v(),n=S(e.data[f])-1;0<=f;){for(c<=n?l=e.data[f]>>n-c&u:(l=(e.data[f]&(1<<n+1)-1)<<c-n,0<f&&(l|=e.data[f-1]>>this.DB+n-c)),o=r;0==(1&l);)l>>=1,--o;if((n-=o)<0&&(n+=this.DB,--f),y)s[l].copyTo(i),y=!1;else{for(;1<o;)a.sqrTo(i,h),a.sqrTo(h,i),o-=2;0<o?a.sqrTo(i,h):(p=i,i=h,h=p),a.mulTo(h,s[l],i)}for(;0<=f&&0==(e.data[f]&1<<n);)a.sqrTo(i,h),p=i,i=h,h=p,--n<0&&(n=this.DB-1,--f)}return a.revert(i)},E.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return E.ZERO;for(var r=e.clone(),a=this.clone(),n=g(1),i=g(0),s=g(0),o=g(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(n.isEven()&&i.isEven()||(n.addTo(this,n),i.subTo(e,i)),n.rShiftTo(1,n)):i.isEven()||i.subTo(e,i),i.rShiftTo(1,i);for(;a.isEven();)a.rShiftTo(1,a),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);0<=r.compareTo(a)?(r.subTo(a,r),t&&n.subTo(s,n),i.subTo(o,i)):(a.subTo(r,a),t&&s.subTo(n,s),o.subTo(i,o))}return 0!=a.compareTo(E.ONE)?E.ZERO:0<=o.compareTo(e)?o.subtract(e):o.signum()<0?(o.addTo(e,o),o.signum()<0?o.add(e):o):o},E.prototype.pow=function(e){return this.exp(e,new f)},E.prototype.gcd=function(e){var t,r=this.s<0?this.negate():this.clone(),a=e.s<0?e.negate():e.clone();r.compareTo(a)<0&&(t=r,r=a,a=t);var n=r.getLowestSetBit(),i=a.getLowestSetBit();if(i<0)return r;for(n<i&&(i=n),0<i&&(r.rShiftTo(i,r),a.rShiftTo(i,a));0<r.signum();)0<(n=r.getLowestSetBit())&&r.rShiftTo(n,r),0<(n=a.getLowestSetBit())&&a.rShiftTo(n,a),0<=r.compareTo(a)?(r.subTo(a,r),r.rShiftTo(1,r)):(a.subTo(r,a),a.rShiftTo(1,a));return 0<i&&a.lShiftTo(i,a),a},E.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=h[h.length-1]){for(t=0;t<h.length;++t)if(r.data[0]==h[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<h.length;){for(var a=h[t],n=t+1;n<h.length&&a<I;)a*=h[n++];for(a=r.modInt(a);t<n;)if(a%h[t++]==0)return!1}return r.millerRabin(e)},e.jsbn=e.jsbn||{},e.jsbn.BigInteger=E}var i,s="jsbn";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){var t=e.err=e.err||{};t.unsupported=1,t.wrongPasswd=2,t.revoked=3,t.expired=4,t.encrypt=5,t.decrypt=6,t.sign=7,t.verify=8,t.generate=9,t.process=10,t.encode=11,t.decode=12,t.license=13,t.invalidInput=14,t.vidNotExist=15;var u=e.util=e.util||{};"undefined"!=typeof process&&process.nextTick?(u.nextTick=process.nextTick,"function"==typeof setImmediate?u.setImmediate=setImmediate:u.setImmediate=u.nextTick):"function"==typeof setImmediate?(u.setImmediate=setImmediate,u.nextTick=function(e){return setImmediate(e)}):(u.setImmediate=function(e){setTimeout(e,0)},u.nextTick=u.setImmediate),u.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},u.arrayIndexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1};var r=[];function a(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(u.isArrayBuffer(e)||u.isArrayBufferView(e)){var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof a||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read)}"undefined"!=typeof DataView&&r.push(DataView),"undefined"!=typeof Int8Array&&r.push(Int8Array),"undefined"!=typeof Uint8Array&&r.push(Uint8Array),"undefined"!=typeof Uint8ClampedArray&&r.push(Uint8ClampedArray),"undefined"!=typeof Int16Array&&r.push(Int16Array),"undefined"!=typeof Uint16Array&&r.push(Uint16Array),"undefined"!=typeof Int32Array&&r.push(Int32Array),"undefined"!=typeof Uint32Array&&r.push(Uint32Array),"undefined"!=typeof Float32Array&&r.push(Float32Array),"undefined"!=typeof Float64Array&&r.push(Float64Array),u.isArrayBufferView=function(e){for(var t=0;t<r.length;++t)if(e instanceof r[t])return!0;return!1},u.ByteBuffer=a,u.ByteStringBuffer=a,u.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},u.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},u.ByteStringBuffer.prototype.putByte=function(e){return this.data+=String.fromCharCode(e),this},u.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return this.data=r,this},u.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this},u.ByteStringBuffer.prototype.putString=function(e){return this.data+=u.encodeUtf8(e),this},u.ByteStringBuffer.prototype.putInt16=function(e){return this.data+=String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt24=function(e){return this.data+=String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt32=function(e){return this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},u.ByteStringBuffer.prototype.putInt16Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255),this},u.ByteStringBuffer.prototype.putInt24Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255),this},u.ByteStringBuffer.prototype.putInt32Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255),this},u.ByteStringBuffer.prototype.putInt=function(e,t){for(;t-=8,this.data+=String.fromCharCode(e>>t&255),0<t;);return this},u.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},u.ByteStringBuffer.prototype.putBuffer=function(e){return this.data+=e.getBytes(),this},u.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},u.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},u.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},u.ByteStringBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.charCodeAt(this.read++),0<(e-=8););return t},u.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return r<=t&&(t-=r<<1),t},u.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},u.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},u.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},u.ByteStringBuffer.prototype.copy=function(){var e=u.createBuffer(this.data);return e.read=this.read,e},u.ByteStringBuffer.prototype.compact=function(){return 0<this.read&&(this.data=this.data.slice(this.read),this.read=0),this},u.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},u.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},u.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.ByteStringBuffer.prototype.toString=function(){return u.decodeUtf8(this.bytes())},u.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=u.isArrayBuffer(e),a=u.isArrayBufferView(e);if(r||a)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},u.DataBuffer.prototype.length=function(){return this.write-this.read},u.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},u.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),a=new Uint8Array(this.length()+t);return a.set(r),this.data=new DataView(a.buffer),this},u.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},u.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},u.DataBuffer.prototype.putBytes=function(e,t){if(u.isArrayBufferView(e)){var r=(a=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-a.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(a),this.write+=r,this}if(u.isArrayBuffer(e)){var a=new Uint8Array(e);return this.accommodate(a.byteLength),new Uint8Array(this.data.buffer).set(a,this.write),this.write+=a.byteLength,this}if(e instanceof u.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&u.isArrayBufferView(e.data)){a=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(a.byteLength),new Uint8Array(e.data.byteLength,this.write).set(a),this.write+=a.byteLength,this}if(e instanceof u.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"!=typeof e)throw Error("Invalid parameter: "+e);var n;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),n=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.hex.decode(e,n,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),n=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.base64.decode(e,n,this.write),this;if("utf8"===t&&(e=u.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),n=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.raw.decode(n),this;if("utf16"===t)return this.accommodate(2*e.length),n=new Uint16Array(this.data.buffer,this.write),this.write+=u.text.utf16.encode(n),this;throw new Error("Invalid encoding: "+t)},u.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},u.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},u.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},u.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},u.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},u.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},u.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},u.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},u.DataBuffer.prototype.putInt=function(e,t){for(this.accommodate(t/8);t-=8,this.data.setInt8(this.write++,e>>t&255),0<t;);return this},u.DataBuffer.prototype.putSignedInt=function(e,t){return this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},u.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},u.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},u.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},u.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},u.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},u.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},u.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},u.DataBuffer.prototype.getInt=function(e){for(var t=0;t=(t<<8)+this.data.getInt8(this.read++),0<(e-=8););return t},u.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return r<=t&&(t-=r<<1),t},u.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},u.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},u.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},u.DataBuffer.prototype.copy=function(){return new u.DataBuffer(this)},u.DataBuffer.prototype.compact=function(){var e,t;return 0<this.read&&(e=new Uint8Array(this.data.buffer,this.read),(t=new Uint8Array(e.byteLength)).set(e),this.data=new DataView(t),this.write-=this.read,this.read=0),this},u.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},u.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},u.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return u.binary.raw.encode(t);if("hex"===e)return u.binary.hex.encode(t);if("base64"===e)return u.binary.base64.encode(t);if("utf8"===e)return u.text.utf8.decode(t);if("utf16"===e)return u.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},u.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=u.encodeUtf8(e)),new u.ByteBuffer(e)},u.fillString=function(e,t){for(var r="";0<t;)1&t&&(r+=e),0<(t>>>=1)&&(e+=e);return r},u.xorBytes=function(e,t,r){for(var a,n="",i="",s=0,o=0;0<r;--r,++s)a=e.charCodeAt(s)^t.charCodeAt(s),10<=o&&(n+=i,i="",o=0),i+=String.fromCharCode(a),++o;return n+=i},u.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e.substr(0,1),16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},u.bytesToHex=function(e){return u.createBuffer(e).toHex()},u.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];u.encode64=function(e,t){for(var r,a,n,i="",s="",o=0;o<e.length;)r=e.charCodeAt(o++),a=e.charCodeAt(o++),n=e.charCodeAt(o++),i+=c.charAt(r>>2),i+=c.charAt((3&r)<<4|a>>4),isNaN(a)?i+="==":(i+=c.charAt((15&a)<<2|n>>6),i+=isNaN(n)?"=":c.charAt(63&n)),t&&i.length>t&&(s+=i.substr(0,t)+"\r\n",i=i.substr(t));return s+=i},u.decode64=function(e){if(0<(e=(e=e.replace(/\s/gi,"")).replace(/\r\n/gm,"")).search(/[^A-Za-z0-9\+\/\=]/g)){var t=new Error("Base64 decode fail. (unknown charactor)");throw t.errors=[],t}for(var r,a,n,i,s="",o=0;o<e.length;)r=d[e.charCodeAt(o++)-43],a=d[e.charCodeAt(o++)-43],n=d[e.charCodeAt(o++)-43],i=d[e.charCodeAt(o++)-43],s+=String.fromCharCode(r<<2|a>>4),64!==n&&(s+=String.fromCharCode((15&a)<<4|n>>2),64!==i&&(s+=String.fromCharCode((3&n)<<6|i)));return s},u.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},u.decodeUtf8=function(e){return decodeURIComponent(escape(e))},u.binary={raw:{},hex:{},base64:{}},u.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},u.binary.raw.decode=function(e,t,r){for(var a=(a=t)||new Uint8Array(e.length),n=r=r||0,i=0;i<e.length;++i)a[n++]=e.charCodeAt(i);return t?n-r:a},u.binary.hex.encode=u.bytesToHex,u.binary.hex.decode=function(e,t,r){var a=(a=t)||new Uint8Array(Math.ceil(e.length/2)),n=0,i=r=r||0;for(1&e.length&&(n=1,a[i++]=parseInt(e[0],16));n<e.length;n+=2)a[i++]=parseInt(e.substr(n,2),16);return t?i-r:a},u.binary.base64.encode=function(e,t){for(var r,a,n,i="",s="",o=0;o<e.byteLength;)r=e[o++],a=e[o++],n=e[o++],i+=c.charAt(r>>2),i+=c.charAt((3&r)<<4|a>>4),isNaN(a)?i+="==":(i+=c.charAt((15&a)<<2|n>>6),i+=isNaN(n)?"=":c.charAt(63&n)),t&&i.length>t&&(s+=i.substr(0,t)+"\r\n",i=i.substr(t));return s+=i},u.binary.base64.decode=function(e,t,r){var a,n,i,s,o=(o=t)||new Uint8Array(3*Math.ceil(e.length/4));e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var c=0,u=r=r||0;c<e.length;)a=d[e.charCodeAt(c++)-43],n=d[e.charCodeAt(c++)-43],i=d[e.charCodeAt(c++)-43],s=d[e.charCodeAt(c++)-43],o[u++]=a<<2|n>>4,64!==i&&(o[u++]=(15&n)<<4|i>>2,64!==s&&(o[u++]=(3&i)<<6|s));return t?u-r:o},u.text={utf8:{},utf16:{}},u.text.utf8.encode=function(e,t,r){e=u.encodeUtf8(e);for(var a=(a=t)||new Uint8Array(e.length),n=r=r||0,i=0;i<e.length;++i)a[n++]=e.charCodeAt(i);return t?n-r:a},u.text.utf8.decode=function(e){return u.decodeUtf8(String.fromCharCode.apply(null,e))},u.text.utf16.encode=function(e,t,r){for(var a=(a=t)||new Uint8Array(e.length),n=new Uint16Array(a),i=r=r||0,s=r,o=0;o<e.length;++o)n[s++]=e.charCodeAt(o),i+=2;return t?i-r:a},u.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},u.deflate=function(e,t,r){var a;return t=u.decode64(e.deflate(u.encode64(t)).rval),r&&(a=2,32&t.charCodeAt(1)&&(a=6),t=t.substring(a,t.length-4)),t},u.inflate=function(e,t,r){var a=e.inflate(u.encode64(t)).rval;return null===a?null:u.decode64(a)};function s(e,t,r){if(!e)throw new Error("WebStorage not available.");var a=null===r?e.removeItem(t):(r=u.encode64(JSON.stringify(r)),e.setItem(t,r));if(void 0!==a&&!0!==a.rval){var n=new Error(a.error.message);throw n.id=a.error.id,n.name=a.error.name,n}}function o(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var a=new Error(r.error.message);throw a.id=r.error.id,a.name=r.error.name,a}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(u.decode64(r))),r}function i(e,t,r,a){var n=o(e,t);null===n&&(n={}),n[r]=a,s(e,t,n)}function n(e,t,r){var a=o(e,t);return null!==a&&(a=r in a?a[r]:null),a}function l(e,t,r){var a=o(e,t);if(null!==a&&r in a){delete a[r];var n,i=!0;for(n in a){i=!1;break}i&&(a=null),s(e,t,a)}}function p(e,t){s(e,t,null)}function f(e,t,r){var a,n=null;void 0===r&&(r=["web","flash"]);var i,s=!1,o=null;for(i in r){a=r[i];try{if("flash"===a||"both"===a){if(null===t[0])throw new Error("Flash local storage not available.");n=e.apply(this,t),s="flash"===a}"web"!==a&&"both"!==a||(t[0]=localStorage,n=e.apply(this,t),s=!0)}catch(e){o=e}if(s)break}if(!s)throw o;return n}u.setItem=function(e,t,r,a,n){f(i,arguments,n)},u.getItem=function(e,t,r,a){return f(n,arguments,a)},u.removeItem=function(e,t,r,a){f(l,arguments,a)},u.clearItems=function(e,t,r){f(p,arguments,r)},u.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),a=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return a&&(a.fullHost=a.host,a.port?(80!==a.port&&"http"===a.scheme||443!==a.port&&"https"===a.scheme)&&(a.fullHost+=":"+a.port):"http"===a.scheme?a.port=80:"https"===a.scheme&&(a.port=443),a.full=a.scheme+"://"+a.fullHost),a};var y=null;u.getQueryVariables=function(e){function t(e){for(var t={},r=e.split("&"),a=0;a<r.length;a++){var n,i=r[a].indexOf("="),s=0<i?(n=r[a].substring(0,i),r[a].substring(i+1)):(n=r[a],null);n in t||(t[n]=[]),n in Object.prototype||null===s||t[n].push(unescape(s))}return t}var r=void 0===e?(null===y&&(y="undefined"==typeof window?{}:t(window.location.search.substring(1))),y):t(e);return r},u.parseFragment=function(e){var t=e,r="",a=e.indexOf("?");0<a&&(t=e.substring(0,a),r=e.substring(a+1));var n=t.split("/");return 0<n.length&&""===n[0]&&n.shift(),{pathString:t,queryString:r,path:n,query:""===r?{}:u.getQueryVariables(r)}},u.makeRequest=function(e){var a=u.parseFragment(e),n={path:a.pathString,query:a.queryString,getPath:function(e){return void 0===e?a.path:a.path[e]},getQuery:function(e,t){var r;return void 0===e?r=a.query:(r=a.query[e])&&void 0!==t&&(r=r[t]),r},getQueryLast:function(e,t){var r=n.getQuery(e),a=r?r[r.length-1]:t;return a}};return n},u.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var a=jQuery.param(t||{});return r=r||"",e+(0<a.length?"?"+a:"")+(0<r.length?"#"+r:"")},u.setPath=function(e,t,r){if("object"==typeof e&&null!==e)for(var a=0,n=t.length;a<n;){var i,s=t[a++];a==n?e[s]=r:((!(i=s in e)||i&&"object"!=typeof e[s]||i&&null===e[s])&&(e[s]={}),e=e[s])}},u.getPath=function(e,t,r){for(var a=0,n=t.length,i=!0;i&&a<n&&"object"==typeof e&&null!==e;){var s=t[a++];(i=s in e)&&(e=e[s])}return i?e:r},u.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var r=0,a=t.length;r<a;){var n=t[r++];if(r==a)delete e[n];else{if(!(n in e)||"object"!=typeof e[n]||null===e[n])break;e=e[n]}}},u.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},u.format=function(e){for(var t,r,a=/%./g,n=0,i=[],s=0;t=a.exec(e);){0<(r=e.substring(s,a.lastIndex-2)).length&&i.push(r),s=a.lastIndex;var o=t[0][1];switch(o){case"s":case"o":n<arguments.length?i.push(arguments[1+n++]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+o+"?>")}}return i.push(e.substring(s)),i.join("")},u.formatNumber=function(e,t,r,a){var n=e,i=isNaN(t=Math.abs(t))?2:t,s=void 0===r?",":r,o=void 0===a?".":a,c=n<0?"-":"",u=parseInt(n=Math.abs(+n||0).toFixed(i),10)+"",d=3<u.length?u.length%3:0;return c+(d?u.substr(0,d)+o:"")+u.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+o)+(i?s+Math.abs(n-u).toFixed(i).slice(2):"")},u.formatSize=function(e){return e=1073741824<=e?u.formatNumber(e/1073741824,2,".","")+" GiB":1048576<=e?u.formatNumber(e/1048576,2,".","")+" MiB":1024<=e?u.formatNumber(e/1024,0)+" KiB":u.formatNumber(e,0)+" bytes"},u.bytesFromIP=function(e){return-1!==e.indexOf(".")?u.bytesFromIPv4(e):-1!==e.indexOf(":")?u.bytesFromIPv6(e):null},u.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=u.createBuffer(),r=0;r<e.length;++r){var a=parseInt(e[r],10);if(isNaN(a))return null;t.putByte(a)}return t.getBytes()},u.bytesFromIPv6=function(e){for(var t,r=0,a=2*(8-(e=e.split(":").filter(function(e){return 0===e.length&&++r,!0})).length+r),n=u.createBuffer(),i=0;i<8;++i){e[i]&&0!==e[i].length?((t=u.hexToBytes(e[i])).length<2&&n.putByte(0),n.putBytes(t)):(n.fillWithByte(0,a),a=0)}return n.getBytes()},u.bytesToIP=function(e){return 4===e.length?u.bytesToIPv4(e):16===e.length?u.bytesToIPv6(e):null},u.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},u.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t,r=[],a=[],n=0,i=0;i<e.length;i+=2){for(var s,o,c=u.bytesToHex(e[i]+e[i+1]);"0"===c[0]&&"0"!==c;)c=c.substr(1);"0"===c&&(s=a[a.length-1],o=r.length,s&&o===s.end+1?(s.end=o,s.end-s.start>a[n].end-a[n].start&&(n=a.length-1)):a.push({start:o,end:o})),r.push(c)}return 0<a.length&&(0<(t=a[n]).end-t.start&&(r.splice(t.start,t.end-t.start+1,""),0===t.start&&r.unshift(""),7===t.end&&r.push(""))),r.join(":")},u.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in u&&!e.update)return t(null,u.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&0<navigator.hardwareConcurrency)return u.cores=navigator.hardwareConcurrency,t(null,u.cores);if("undefined"==typeof Worker)return u.cores=1,t(null,u.cores);if("undefined"==typeof Blob)return u.cores=2,t(null,u.cores);var s=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})})}.toString(),")()"],{type:"application/javascript"}));function o(r,a){for(var n=[],i=[],e=0;e<r;++e){var t=new Worker(s);t.addEventListener("message",function(e){if(i.push(e.data),i.length===r){for(var t=0;t<r;++t)n[t].terminate();a(null,i)}}),n.push(t)}for(e=0;e<r;++e)n[e].postMessage(e)}function c(e,t){for(var r=[],a=0;a<e;++a)for(var n,i=t[a],s=r[a]=[],o=0;o<e;++o){a!==o&&(n=t[o],(i.st>n.st&&i.st<n.et||n.st>i.st&&n.st<i.et)&&s.push(o))}return r.reduce(function(e,t){return Math.max(e,t.length)},0)}!function r(a,n,i){if(0===n){var e=Math.floor(a.reduce(function(e,t){return e+t},0)/a.length);return u.cores=Math.max(1,e),URL.revokeObjectURL(s),t(null,u.cores)}o(i,function(e,t){a.push(c(i,t)),r(a,n-1,i)})}([],5,16)}}var i,s="util";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function g(h){var e;function i(e){function t(e,t){return" "+t}for(var r=e.name+": ",a=[],n=0;n<e.values.length;++n)a.push(e.values[n].replace(/^(\S+\r\n)/,t));r+=a.join(",")+"\r\n";for(var i,s=0,o=-1,n=0;n<r.length;++n,++s){65<s&&-1!==o?(r=","===(i=r[o])?(++o,r.substr(0,o)+"\r\n "+r.substr(o)):r.substr(0,o)+"\r\n"+i+r.substr(o+1),s=n-o-1,o=-1,++n):" "!==r[n]&&"\t"!==r[n]&&","!==r[n]||(o=n)}return r}null!=h?((e=h.pem=h.pem||{}).encode=function(e,t){g(),t=t||{};var r,a="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(a+=i(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(a+=i(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),a+=i(r)),e.headers)for(var n=0;n<e.headers.length;++n)a+=i(e.headers[n]);return e.procType&&(a+="\r\n"),a+=h.util.encode64(e.body,t.maxline||64)+"\r\n",a+="-----END "+e.type+"-----\r\n"},e.decode=function(e){g();for(var t,r=[],a=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,i=/\r?\n/;t=a.exec(e);){var s={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:h.util.decode64(t[3])};if(r.push(s),t[2]){for(var o=t[2].split(i),c=0;t&&c<o.length;){for(var u=o[c].replace(/\s+$/,""),d=c+1;d<o.length;++d){var l=o[d];if(!/\s/.test(l[0]))break;u+=l,c=d}if(t=u.match(n)){for(var p={name:t[1],values:[]},f=t[2].split(","),y=0;y<f.length;++y)p.values.push(f[y].replace(/^\s+/,""));if(s.procType)if(s.contentDomain||"Content-Domain"!==p.name)if(s.dekInfo||"DEK-Info"!==p.name)s.headers.push(p);else{if(0===p.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');s.dekInfo={algorithm:f[0],parameters:f[1]||null}}else s.contentDomain=f[0]||"";else{if("Proc-Type"!==p.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==p.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');s.procType={version:f[0],type:f[1]}}}++c}if("ENCRYPTED"===s.procType&&!s.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}):"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"pem")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),g(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(g);if((e=e||{}).defined=e.defined||{},e.defined.pem)return e.pem;e.defined.pem=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pem}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){e.pki=e.pki||{};var t=e.pki.oids=e.oids=e.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption",t.rsaEncryption="1.2.840.113549.1.1.1",t["1.2.410.200004.1.21"]="kcdsa1",t.kcdsa1="1.2.410.200004.1.21",t["1.2.410.200004.1.23"]="kcdsa1WithSHA1",t.kcdsa1WithSHA1="1.2.410.200004.1.23",t["1.2.410.200004.1.38"]="kcdsa1WithSHA256",t.kcdsa1WithSHA256="1.2.410.200004.1.38",t["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",t.md5WithRSAEncryption="1.2.840.113549.1.1.4",t["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",t.sha1WithRSAEncryption="1.2.840.113549.1.1.5",t["1.2.840.113549.1.1.7"]="RSAES-OAEP",t.RSAES_OAEP="1.2.840.113549.1.1.7",t["1.2.840.113549.1.1.8"]="mgf1",t.mgf1="1.2.840.113549.1.1.8",t["1.2.840.113549.1.1.9"]="pSpecified",t.pSpecified="1.2.840.113549.1.1.9",t["1.2.840.113549.1.1.10"]="RSASSA_PSS",t.RSASSA_PSS="1.2.840.113549.1.1.10",t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",t.sha256WithRSAEncryption="1.2.840.113549.1.1.11",t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",t.sha384WithRSAEncryption="1.2.840.113549.1.1.12",t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",t.sha512WithRSAEncryption="1.2.840.113549.1.1.13",t["1.3.14.3.2.7"]="desCBC",t.desCBC="1.3.14.3.2.7",t["1.3.14.3.2.26"]="sha1",t.sha1="1.3.14.3.2.26",t["2.16.840.1.101.3.4.2.1"]="sha256",t.sha256="2.16.840.1.101.3.4.2.1",t["2.16.840.1.101.3.4.2.2"]="sha384",t.sha384="2.16.840.1.101.3.4.2.2",t["2.16.840.1.101.3.4.2.3"]="sha512",t.sha512="2.16.840.1.101.3.4.2.3",t["1.2.840.113549.2.5"]="md5",t.md5="1.2.840.113549.2.5",t["1.2.840.113549.1.7.1"]="data",t.data="1.2.840.113549.1.7.1",t["1.2.840.113549.1.7.2"]="signedData",t.signedData="1.2.840.113549.1.7.2",t["1.2.840.113549.1.7.3"]="envelopedData",t.envelopedData="1.2.840.113549.1.7.3",t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",t.signedAndEnvelopedData="1.2.840.113549.1.7.4",t["1.2.840.113549.1.7.5"]="digestedData",t.digestedData="1.2.840.113549.1.7.5",t["1.2.840.113549.1.7.6"]="encryptedData",t.encryptedData="1.2.840.113549.1.7.6",t["1.2.840.113549.1.9.16.1.4"]="tstInfo",t.tstInfo="1.2.840.113549.1.9.16.1.4",t["1.2.840.113549.1.9.16.2.12"]="signingCertificate",t.signingCertificate="1.2.840.113549.1.9.16.2.12",t["1.2.840.113549.1.9.16.2.47"]="signingCertificateV2",t.signingCertificateV2="1.2.840.113549.1.9.16.2.47",t["1.2.410.200032.2.2"]="arcCertRes",t.arcCertRes="1.2.410.200032.2.2",t["1.2.410.200032.2.3.1"]="kiec_qualifications",t.kiec_qualifications="1.2.410.200032.2.3.1",t["1.2.410.200032.2.3.2"]="kiec_usageType",t.kiec_usageType="1.2.410.200032.2.3.2",t["1.2.410.200032.2.3.3"]="kiec_dateOfExpiration",t.kiec_dateOfExpiration="1.2.410.200032.2.3.3",t["1.2.410.200032.2.3.4"]="kiec_certifiedTime",t.kiec_certifiedTime="1.2.410.200032.2.3.4",t["1.2.410.200032.2.3.5"]="kiec_certUsage",t.kiec_certUsage="1.2.410.200032.2.3.5",t["1.2.410.200032.2.3.6"]="kiec_docContentInfoFlag",t.kiec_docContentInfoFlag="1.2.410.200032.2.3.6",t["1.2.410.200032.2.4.1"]="kiec_hashedIDNInfo",t.kiec_hashedIDNInfo="1.2.410.200032.2.4.1",t["1.2.840.113549.1.9.1"]="emailAddress",t.emailAddress="1.2.840.113549.1.9.1",t["1.2.840.113549.1.9.2"]="unstructuredName",t.unstructuredName="1.2.840.113549.1.9.2",t["1.2.840.113549.1.9.3"]="contentType",t.contentType="1.2.840.113549.1.9.3",t["1.2.840.113549.1.9.4"]="messageDigest",t.messageDigest="1.2.840.113549.1.9.4",t["1.2.840.113549.1.9.5"]="signingTime",t.signingTime="1.2.840.113549.1.9.5",t["1.2.840.113549.1.9.6"]="counterSignature",t.counterSignature="1.2.840.113549.1.9.6",t["1.2.840.113549.1.9.7"]="challengePassword",t.challengePassword="1.2.840.113549.1.9.7",t["1.2.840.113549.1.9.8"]="unstructuredAddress",t.unstructuredAddress="1.2.840.113549.1.9.8",t["1.2.840.113549.1.9.14"]="extensionRequest",t.extensionRequest="1.2.840.113549.1.9.14",t["1.2.840.113549.1.9.20"]="friendlyName",t.friendlyName="1.2.840.113549.1.9.20",t["1.2.840.113549.1.9.21"]="localKeyId",t.localKeyId="1.2.840.113549.1.9.21",t["1.2.840.113549.1.9.22.1"]="x509Certificate",t.x509Certificate="1.2.840.113549.1.9.22.1",t["1.2.840.113549.1.12.10.1.1"]="keyBag",t.keyBag="1.2.840.113549.1.12.10.1.1",t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",t["1.2.840.113549.1.12.10.1.3"]="certBag",t.certBag="1.2.840.113549.1.12.10.1.3",t["1.2.840.113549.1.12.10.1.4"]="crlBag",t.crlBag="1.2.840.113549.1.12.10.1.4",t["1.2.840.113549.1.12.10.1.5"]="secretBag",t.secretBag="1.2.840.113549.1.12.10.1.5",t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",t.safeContentsBag="1.2.840.113549.1.12.10.1.6",t["1.2.840.113549.1.5.13"]="pkcs5PBES2",t.pkcs5PBES2="1.2.840.113549.1.5.13",t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",t.pkcs5PBKDF2="1.2.840.113549.1.5.12",t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",t["1.2.840.113549.3.7"]="des-EDE3-CBC",t["des-EDE3-CBC"]="1.2.840.113549.3.7",t["2.16.840.1.101.3.4.1.2"]="aes128-CBC",t["aes128-CBC"]="2.16.840.1.101.3.4.1.2",t["2.16.840.1.101.3.4.1.22"]="aes192-CBC",t["aes192-CBC"]="2.16.840.1.101.3.4.1.22",t["2.16.840.1.101.3.4.1.42"]="aes256-CBC",t["aes256-CBC"]="2.16.840.1.101.3.4.1.42",t["1.2.410.200004.1.4"]="seedCBC",t.seedCBC="1.2.410.200004.1.4",t["1.2.410.200004.1.15"]="seedCBCWithSHA1",t.seedCBCWithSHA1="1.2.410.200004.1.15",t["1.2.410.100001.1.20"]="ariaCBC",t.ariaCBC="1.2.410.100001.1.20",t["1.2.410.200046.1.1.2"]="aria128-CBC",t["aria128-CBC"]="1.2.410.200046.1.1.2",t["1.2.410.200046.1.1.7"]="aria192-CBC",t["aria192-CBC"]="1.2.410.200046.1.1.7",t["1.2.410.200046.1.1.12"]="aria256-CBC",t["aria256-CBC"]="1.2.410.200046.1.1.12",t["1.2.410.100001.1.24"]="pbeWithSHA1AndARIA_CBC",t.pbeWithSHA1AndARIA_CBC="1.2.410.100001.1.24",t["2.5.4.3"]="commonName",t.commonName="2.5.4.3",t["2.5.4.5"]="serialName",t.serialName="2.5.4.5",t["2.5.4.6"]="countryName",t.countryName="2.5.4.6",t["2.5.4.7"]="localityName",t.localityName="2.5.4.7",t["2.5.4.8"]="stateOrProvinceName",t.stateOrProvinceName="2.5.4.8",t["2.5.4.10"]="organizationName",t.organizationName="2.5.4.10",t["2.5.4.11"]="organizationalUnitName",t.organizationalUnitName="2.5.4.11",t["2.16.840.1.113730.1.1"]="nsCertType",t.nsCertType="2.16.840.1.113730.1.1",t["2.5.29.9"]="subjectDirectoryAttributes",t["2.5.29.14"]="subjectKeyIdentifier",t.subjectKeyIdentifier="2.5.29.14",t["2.5.29.15"]="keyUsage",t.keyUsage="2.5.29.15",t["2.5.29.16"]="privateKeyUsagePeriod",t["2.5.29.17"]="subjectAltName",t.subjectAltName="2.5.29.17",t["2.5.29.18"]="issuerAltName",t.issuerAltName="2.5.29.18",t["2.5.29.19"]="basicConstraints",t.basicConstraints="2.5.29.19",t["2.5.29.20"]="cRLNumber",t.cRLNumber="2.5.29.20",t["2.5.29.21"]="cRLReason",t.cRLReason="2.5.29.21",t["2.5.29.22"]="expirationDate",t["2.5.29.23"]="instructionCode",t["2.5.29.24"]="invalidityDate",t.invalidityDate="2.5.29.24",t["2.5.29.27"]="deltaCRLIndicator",t["2.5.29.28"]="issuingDistributionPoint",t.issuingDistributionPoint="2.5.29.28",t["2.5.29.29"]="certificateIssuer",t["2.5.29.30"]="nameConstraints",t["2.5.29.31"]="cRLDistributionPoints",t.cRLDistributionPoints="2.5.29.31",t["2.5.29.32"]="certificatePolicies",t.certificatePolicies="2.5.29.32",t["2.5.29.33"]="policyMappings",t["2.5.29.35"]="authorityKeyIdentifier",t.authorityKeyIdentifier="2.5.29.35",t["2.5.29.36"]="policyConstraints",t.policyConstraints="2.5.29.36",t["2.5.29.37"]="extKeyUsage",t.extKeyUsage="2.5.29.37",t["2.5.29.46"]="freshestCRL",t["2.5.29.54"]="inhibitAnyPolicy",t["1.3.6.1.5.5.7.3.1"]="serverAuth",t.serverAuth="1.3.6.1.5.5.7.3.1",t["1.3.6.1.5.5.7.3.2"]="clientAuth",t.clientAuth="1.3.6.1.5.5.7.3.2",t["1.3.6.1.5.5.7.3.3"]="codeSigning",t.codeSigning="1.3.6.1.5.5.7.3.3",t["1.3.6.1.5.5.7.3.4"]="emailProtection",t.emailProtection="1.3.6.1.5.5.7.3.4",t["1.3.6.1.5.5.7.3.8"]="timeStamping",t.timeStamping="1.3.6.1.5.5.7.3.8",t["1.3.6.1.5.5.7.1.1"]="authorityInfoAccess",t.authorityInfoAccess="1.3.6.1.5.5.7.1.1",t["1.3.6.1.5.5.7.2.1"]="cps",t["1.3.6.1.5.5.7.2.2"]="unotice",t.cps="1.3.6.1.5.5.7.2.1",t.unotice="1.3.6.1.5.5.7.2.2",t["1.3.6.1.5.5.7.48.1"]="ad_ocsp",t.ad_ocsp="1.3.6.1.5.5.7.48.1",t["1.3.6.1.5.5.7.48.2"]="ad_caIssuers",t.ad_caIssuers="1.3.6.1.5.5.7.48.2",t["1.2.410.200004.10.1.1"]="kisa_identifyData",t.kisa_identifyData="1.2.410.200004.10.1.1",t["1.2.410.200004.10.1.1.1"]="VID",t.VID="1.2.410.200004.10.1.1.1",t["1.2.410.200004.10.1.1.3"]="randomNum",t.randomNum="1.2.410.200004.10.1.1.3"}var i,s="oids";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function i(n){var e;null!=n?(n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"==typeof r&&(r=(r=n.cipher.getAlgorithm(r))&&r()),r)return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1});var a=new Error("Unsupported algorithm: "+e);throw a.type=n.err.unsupported,a},n.cipher.createDecipher=function(e,t){var r=e;if("string"==typeof r&&(r=(r=n.cipher.getAlgorithm(r))&&r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null},(e=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)}).prototype.start=function(e){i(),e=e||{};var t,r={};for(t in e)r[t]=e[t];r.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(r)},e.prototype.update=function(e){i(),this._finish||this._input.putBuffer(e);for(var t=!0;this._input.length()>=this.blockSize||0<this._input.length()&&this._finish;)this._op.call(this.mode,this._input,this.output,t),t=!1;this._input.compact()},e.prototype.finish=function(t){i(),t&&"CBC"===this.mode.name&&(this.mode.pad=function(e){return t(this.blockSize,e,!1)},this.mode.unpad=function(e){return t(this.blockSize,e,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,e)))}):dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipher")}var n,s="cipher";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),i(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(i);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(a){var e;null!=a?(a.cipher=a.cipher||{},(e=a.cipher.modes=a.cipher.modes||{}).cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},e.cbc.prototype.start=function(e){if(n(),null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=function(e){"string"==typeof e&&(e=a.util.createBuffer(e));if(a.util.isArray(e)&&4<e.length){var t=e;e=a.util.createBuffer();for(var r=0;r<e.length;++r)e.putByte(t[r])}a.util.isArray(e)||(e=[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);return e}(e.iv),this._prev=this._iv.slice(0)}},e.cbc.prototype.encrypt=function(e,t,r){r&&n();for(var a=0;a<this._blocks;++a)this._inBlock[a]=this._prev[a]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(a=0;a<this._blocks;++a)t.putInt32(this._outBlock[a]);this._prev=this._outBlock},e.cbc.prototype.decrypt=function(e,t,r){r&&n();for(var a=0;a<this._blocks;++a)this._inBlock[a]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(a=0;a<this._blocks;++a)t.putInt32(this._prev[a]^this._outBlock[a]);this._prev=this._inBlock.slice(0)},e.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},e.cbc.prototype.unpad=function(e,t){if(0<t.overflow)return!1;var r=e.length(),a=e.at(r-1);return!(a>this.blockSize<<2)&&(e.truncate(a),!0)}):dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"cipherModes")}var i,s="cipherModes";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(d){null!=d?(d.hmac=d.hmac||{}).create=function(){n();var s=null,o=null,c=null,u=null,e={start:function(e,t){if(null!==e)if("string"==typeof e){if(!((e=e.toLowerCase())in d.md.algorithms)){var r=new Error('Unknown hash algorithm "'+e+'"');throw r.type=d.err.unsupported,r}o=d.md.algorithms[e].create()}else o=e;if(null===t)t=s;else{if("string"==typeof t)t=d.util.createBuffer(t);else if(d.util.isArray(t)){var a=t;t=d.util.createBuffer();for(var n=0;n<a.length;++n)t.putByte(a[n])}var i=t.length();i>o.blockLength&&(o.start(),o.update(t.bytes()),t=o.digest()),c=d.util.createBuffer(),u=d.util.createBuffer(),i=t.length();for(n=0;n<i;++n){a=t.at(n);c.putByte(54^a),u.putByte(92^a)}if(i<o.blockLength)for(a=o.blockLength-i,n=0;n<a;++n)c.putByte(54),u.putByte(92);s=t,c=c.bytes(),u=u.bytes()}o.start(),o.update(c)},update:function(e){o.update(e)},getMac:function(){var e=o.digest().bytes();return o.start(),o.update(u),o.update(e),o.digest()}};return e.digest=e.getMac,e}:"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"hmac")}var i,s="hmac";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function d(o){var e,c,t;function u(e,t,r){for(var a,n,i,s,o,c,u,d=r.length();64<=d;){for(n=e.h0,i=e.h1,s=e.h2,o=e.h3,c=e.h4,u=0;u<16;++u)a=r.getInt32()>>>0,t[u]=a>>>0,a=(n<<5|n>>>27)+((o^i&(s^o))>>>0)+c+1518500249+a>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;for(;u<20;++u)a=((a=(t[u-3]^t[u-8]^t[u-14]^t[u-16])>>>0)<<1|a>>>31)>>>0,a=(n<<5|n>>>27)+((o^i&(s^o))>>>0)+c+1518500249+(t[u]=a)>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;for(;u<32;++u)a=((a=(t[u-3]^t[u-8]^t[u-14]^t[u-16])>>>0)<<1|a>>>31)>>>0,t[u]=a>>>0,a=(n<<5|n>>>27)+((i^s^o)>>>0)+c+1859775393+a>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;for(;u<40;++u)a=((a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0)<<2|a>>>30)>>>0,t[u]=a>>>0,a=(n<<5|n>>>27)+((i^s^o)>>>0)+c+1859775393+a>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;for(;u<60;++u)a=((a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0)<<2|a>>>30)>>>0,t[u]=a>>>0,a=(n<<5|n>>>27)+((i&s|o&(i^s))>>>0)+c+2400959708+a>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;for(;u<80;++u)a=((a=(t[u-6]^t[u-16]^t[u-28]^t[u-32])>>>0)<<2|a>>>30)>>>0,t[u]=a>>>0,a=(n<<5|n>>>27)+((i^s^o)>>>0)+c+3395469782+a>>>0,c=o>>>0,o=s>>>0,s=(i<<30|i>>>2)>>>0,i=n>>>0,n=a>>>0;e.h0=e.h0+n|0,e.h1=e.h1+i|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,e.h4=e.h4+c|0,d-=64}}null!=o||"function"!=typeof dreamsecurity.chkIntegrity?(e=o.sha1=o.sha1||{},o.md=o.md||{},o.md.algorithms=o.md.algorithms||{},(o.md.sha1=o.md.algorithms.sha1=e).create=function(){d(),t||(c=String.fromCharCode(128),c+=o.util.fillString(String.fromCharCode(0),64),t=!0);var a=null,n=o.util.createBuffer(),i=new Array(80),s={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0],start:function(){return s.messageLength=0,s.messageLength64=[0,0],n=o.util.createBuffer(),a={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},s}};return s.start(),s.update=function(e,t){return"utf8"===t&&(e=o.util.encodeUtf8(e)),s.messageLength+=e.length,s.messageLength64[0]+=e.length/4294967296>>>0,s.messageLength64[1]+=e.length>>>0,n.putBytes(e),u(a,i,n),(2048<n.read||0===n.length())&&n.compact(),s},s.digest=function(){var e=o.util.createBuffer();e.putBytes(n.bytes()),e.putBytes(c.substr(0,64-(s.messageLength64[1]+8&63))),e.putInt32(s.messageLength64[0]<<3|s.messageLength64[0]>>>28),e.putInt32(s.messageLength64[1]<<3);var t={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3,h4:a.h4};u(t,i,e);var r=o.util.createBuffer();return r.putInt32(t.h0),r.putInt32(t.h1),r.putInt32(t.h2),r.putInt32(t.h3),r.putInt32(t.h4),r},s},c=null,t=!1):dreamsecurity.chkIntegrity(arguments.callee,"sha1")}var n,i="sha1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),d(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(d);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function d(o){var e,c,t,m;function u(e,t,r){for(var a,n,i,s,o,c,u,d,l,p,f,y,h,g=r.length();64<=g;){for(o=0;o<16;++o)t[o]=r.getInt32();for(;o<64;++o)a=((a=t[o-2])>>>17|a<<15)^(a>>>19|a<<13)^a>>>10,n=((n=t[o-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,t[o]=a+t[o-7]+n+t[o-16]|0;for(c=e.h0,u=e.h1,d=e.h2,l=e.h3,p=e.h4,f=e.h5,y=e.h6,h=e.h7,o=0;o<64;++o)i=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=c&u|d&(c^u),a=h+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(y^p&(f^y))+m[o]+t[o],h=y,y=f,f=p,p=l+a|0,l=d,d=u,u=c,c=a+(n=i+s)|0;e.h0=e.h0+c|0,e.h1=e.h1+u|0,e.h2=e.h2+d|0,e.h3=e.h3+l|0,e.h4=e.h4+p|0,e.h5=e.h5+f|0,e.h6=e.h6+y|0,e.h7=e.h7+h|0,g-=64}}null!=o?(e=o.sha256=o.sha256||{},o.md=o.md||{},o.md.algorithms=o.md.algorithms||{},t=!((o.md.sha256=o.md.algorithms.sha256=e).create=function(){d(),t||(c=String.fromCharCode(128),c+=o.util.fillString(String.fromCharCode(0),64),m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],t=!0);var a=null,n=o.util.createBuffer(),i=new Array(64),s={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0],start:function(){return s.messageLength=0,s.messageLength64=[0,0],n=o.util.createBuffer(),a={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},s}};return s.start(),s.update=function(e,t){return"utf8"===t&&(e=o.util.encodeUtf8(e)),s.messageLength+=e.length,s.messageLength64[0]+=e.length/4294967296>>>0,s.messageLength64[1]+=e.length>>>0,n.putBytes(e),u(a,i,n),(2048<n.read||0===n.length())&&n.compact(),s},s.digest=function(){var e=o.util.createBuffer();e.putBytes(n.bytes()),e.putBytes(c.substr(0,64-(s.messageLength64[1]+8&63))),e.putInt32(s.messageLength64[0]<<3|s.messageLength64[0]>>>28),e.putInt32(s.messageLength64[1]<<3);var t={h0:a.h0,h1:a.h1,h2:a.h2,h3:a.h3,h4:a.h4,h5:a.h5,h6:a.h6,h7:a.h7};u(t,i,e);var r=o.util.createBuffer();return r.putInt32(t.h0),r.putInt32(t.h1),r.putInt32(t.h2),r.putInt32(t.h3),r.putInt32(t.h4),r.putInt32(t.h5),r.putInt32(t.h6),r.putInt32(t.h7),r},s}),m=c=null):"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"sha256")}var n,i="sha256";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),d(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(d);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(l){var e,t,p,r,x,a;function f(e,t,r){for(var a,n,i,s,o,c,u,d,l,p,f,y,h,g,m,C,E,v,S,T,I,A,b,N,B,k,R,w,D,U,L,P,V,O=r.length();128<=O;){for(R=0;R<16;++R)t[R][0]=r.getInt32()>>>0,t[R][1]=r.getInt32()>>>0;for(;R<80;++R)a=(((w=(U=t[R-2])[0])>>>19|(D=U[1])<<13)^(D>>>29|w<<3)^w>>>6)>>>0,n=((w<<13|D>>>19)^(D<<3|w>>>29)^(w<<26|D>>>6))>>>0,i=(((w=(P=t[R-15])[0])>>>1|(D=P[1])<<31)^(w>>>8|D<<24)^w>>>7)>>>0,s=((w<<31|D>>>1)^(w<<24|D>>>8)^(w<<25|D>>>7))>>>0,L=t[R-7],V=t[R-16],D=n+L[1]+s+V[1],t[R][0]=a+L[0]+i+V[0]+(D/4294967296>>>0)>>>0,t[R][1]=D>>>0;for(f=e[0][0],y=e[0][1],h=e[1][0],g=e[1][1],m=e[2][0],C=e[2][1],E=e[3][0],v=e[3][1],S=e[4][0],T=e[4][1],I=e[5][0],A=e[5][1],b=e[6][0],N=e[6][1],B=e[7][0],k=e[7][1],R=0;R<80;++R)u=((S>>>14|T<<18)^(S>>>18|T<<14)^(T>>>9|S<<23))>>>0,d=(b^S&(I^b))>>>0,o=((f>>>28|y<<4)^(y>>>2|f<<30)^(y>>>7|f<<25))>>>0,c=((f<<4|y>>>28)^(y<<30|f>>>2)^(y<<25|f>>>7))>>>0,l=(f&h|m&(f^h))>>>0,p=(y&g|C&(y^g))>>>0,D=k+(((S<<18|T>>>14)^(S<<14|T>>>18)^(T<<23|S>>>9))>>>0)+((N^T&(A^N))>>>0)+x[R][1]+t[R][1],a=B+u+d+x[R][0]+t[R][0]+(D/4294967296>>>0)>>>0,n=D>>>0,i=o+l+((D=c+p)/4294967296>>>0)>>>0,s=D>>>0,B=b,k=N,b=I,N=A,I=S,A=T,S=E+a+((D=v+n)/4294967296>>>0)>>>0,T=D>>>0,E=m,v=C,m=h,C=g,h=f,g=y,f=a+i+((D=n+s)/4294967296>>>0)>>>0,y=D>>>0;D=e[0][1]+y,e[0][0]=e[0][0]+f+(D/4294967296>>>0)>>>0,e[0][1]=D>>>0,D=e[1][1]+g,e[1][0]=e[1][0]+h+(D/4294967296>>>0)>>>0,e[1][1]=D>>>0,D=e[2][1]+C,e[2][0]=e[2][0]+m+(D/4294967296>>>0)>>>0,e[2][1]=D>>>0,D=e[3][1]+v,e[3][0]=e[3][0]+E+(D/4294967296>>>0)>>>0,e[3][1]=D>>>0,D=e[4][1]+T,e[4][0]=e[4][0]+S+(D/4294967296>>>0)>>>0,e[4][1]=D>>>0,D=e[5][1]+A,e[5][0]=e[5][0]+I+(D/4294967296>>>0)>>>0,e[5][1]=D>>>0,D=e[6][1]+N,e[6][0]=e[6][0]+b+(D/4294967296>>>0)>>>0,e[6][1]=D>>>0,D=e[7][1]+k,e[7][0]=e[7][0]+B+(D/4294967296>>>0)>>>0,e[7][1]=D>>>0,O-=128}}null!=l||"function"!=typeof dreamsecurity.chkIntegrity?(e=l.sha512=l.sha512||{},l.md=l.md||{},l.md.algorithms=l.md.algorithms||{},l.md.sha512=l.md.algorithms.sha512=e,(t=l.sha384=l.sha512.sha384=l.sha512.sha384||{}).create=function(){return e.create("SHA-384")},l.md.sha384=l.md.algorithms.sha384=t,l.sha512.sha256=l.sha512.sha256||{create:function(){return e.create("SHA-512/256")}},l.md["sha512/256"]=l.md.algorithms["sha512/256"]=l.sha512.sha256,l.sha512.sha224=l.sha512.sha224||{create:function(){return e.create("SHA-512/224")}},l.md["sha512/224"]=l.md.algorithms["sha512/224"]=l.sha512.sha224,r=!(e.create=function(s){if(n(),r||(p=String.fromCharCode(128),p+=l.util.fillString(String.fromCharCode(0),128),x=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],a={"SHA-512":[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],"SHA-384":[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],"SHA-512/256":[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],"SHA-512/224":[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]]},r=!0),void 0===s&&(s="SHA-512"),!(s in a))throw new Error("Invalid SHA-512 algorithm: "+s);for(var t=a[s],o=null,c=l.util.createBuffer(),u=new Array(80),e=0;e<80;++e)u[e]=new Array(2);var d={algorithm:s.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0],start:function(){d.messageLength=0,d.messageLength128=[0,0,0,0],c=l.util.createBuffer(),o=new Array(t.length);for(var e=0;e<t.length;++e)o[e]=t[e].slice(0);return d}};return d.start(),d.update=function(e,t){"utf8"===t&&(e=l.util.encodeUtf8(e)),d.messageLength+=e.length;for(var r=[(r=e.length)/4294967296>>>0,r>>>0],a=3;0<=a;--a)d.messageLength128[a]+=r[1],r[1]=r[0]+(d.messageLength128[a]/4294967296>>>0),d.messageLength128[a]=d.messageLength128[a]>>>0,r[0]=r[1]/4294967296>>>0;return c.putBytes(e),f(o,u,c),(2048<c.read||0===c.length())&&c.compact(),d},d.digest=function(){var e=l.util.createBuffer();e.putBytes(c.bytes()),e.putBytes(p.substr(0,128-(d.messageLength128[3]+16&127)));for(var t=[],r=0;r<3;++r)t[r]=d.messageLength128[r]<<3|d.messageLength128[r-1]>>>28;t[3]=d.messageLength128[3]<<3,e.putInt32(t[0]),e.putInt32(t[1]),e.putInt32(t[2]),e.putInt32(t[3]);for(var a=new Array(o.length),r=0;r<o.length;++r)a[r]=o[r].slice(0);f(a,u,e);for(var n=l.util.createBuffer(),i="SHA-512"===s?a.length:"SHA-384"===s?a.length-2:a.length-4,r=0;r<i;++r)n.putInt32(a[r][0]),r===i-1&&"SHA-512/224"===s||n.putInt32(a[r][1]);return n},d}),a=x=p=null):dreamsecurity.chkIntegrity(arguments.callee,"sha512")}var i,s="sha512";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function f(p){var e,i;null!=p||"function"!=typeof dreamsecurity.chkIntegrity?(e="undefined"!=typeof process&&process.versions&&process.versions.node,i=null,p.disableNativeCode||!e||process.versions["node-webkit"]||(i=require("crypto")),(p.prng=p.prng||{}).create=function(e){for(var d={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0},t=e.md,r=new Array(32),a=0;a<32;++a)r[a]=t.create();function l(r){if(32<=d.pools[0].messageLength)return o(),r();var e=32-d.pools[0].messageLength<<5;d.seedFile(e,function(e,t){return e?r(e):(d.collect(t),o(),void r())})}function o(){var e=d.plugin.md.create();e.update(d.pools[0].digest().getBytes()),d.pools[0].start();for(var t=1,r=1;r<32;++r)(t=31===t?2147483648:t<<2)%d.reseeds==0&&(e.update(d.pools[r].digest().getBytes()),d.pools[r].start());var a=e.digest().getBytes();e.start(),e.update(a);var n=e.digest().getBytes();d.key=d.plugin.formatKey(a),d.seed=d.plugin.formatSeed(n),d.reseeds=4294967295===d.reseeds?0:d.reseeds+1,d.generated=0}function n(e){var t,r=null;"undefined"==typeof window||(t=window.crypto||window.msCrypto)&&t.getRandomValues&&(r=function(e){return t.getRandomValues(e)});var a=p.util.createBuffer();if(r)for(;a.length()<e;){var n=Math.max(1,Math.min(e-a.length(),65536)/4),i=new Uint32Array(Math.floor(n));try{r(i);for(var s=0;s<i.length;++s)a.putInt32(i[s])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(a.length()<e)for(var o,c,u,d=Math.floor(65536*Math.random());a.length()<e;){c=16807*(65535&d),c+=(32767&(o=16807*(d>>16)))<<16,d=4294967295&(2147483647&(c+=o>>15))+(c>>31);for(s=0;s<3;++s)u=d>>>(s<<3),u^=Math.floor(256*Math.random()),a.putByte(String.fromCharCode(255&u))}return a.getBytes(e)}return d.pools=r,d.pool=0,d.generate=function(a,n){if(f(),!n)return d.generateSync(a);var i=d.plugin.cipher,s=d.plugin.increment,o=d.plugin.formatKey,c=d.plugin.formatSeed,u=p.util.createBuffer();d.key=null,function e(t){if(t)return n(t);if(u.length()>=a)return n(null,u.getBytes(a));1048575<d.generated&&(d.key=null);if(null===d.key)return p.util.nextTick(function(){l(e)});var r=i(d.key,d.seed);d.generated+=r.length;u.putBytes(r);d.key=o(i(d.key,s(d.seed)));d.seed=c(i(d.key,d.seed));p.util.setImmediate(e)}()},d.generateSync=function(e){var t=d.plugin.cipher,r=d.plugin.increment,a=d.plugin.formatKey,n=d.plugin.formatSeed;d.key=null;for(var i=p.util.createBuffer();i.length()<e;){1048575<d.generated&&(d.key=null),null===d.key&&function(){if(32<=d.pools[0].messageLength)return o();var e=32-d.pools[0].messageLength<<5;d.collect(d.seedFileSync(e)),o()}();var s=t(d.key,d.seed);d.generated+=s.length,i.putBytes(s),d.key=a(t(d.key,r(d.seed))),d.seed=n(t(d.key,d.seed))}return i.getBytes(e)},i?(d.seedFile=function(e,r){i.randomBytes(e,function(e,t){return e?r(e):void r(null,t.toString())})},d.seedFileSync=function(e){return i.randomBytes(e).toString()}):(d.seedFile=function(e,t){try{t(null,n(e))}catch(e){t(e)}},d.seedFileSync=n),d.collect=function(e){for(var t=e.length,r=0;r<t;++r)d.pools[d.pool].update(e.substr(r,1)),d.pool=31===d.pool?0:d.pool+1},d.collectInt=function(e,t){for(var r="",a=0;a<t;a+=8)r+=String.fromCharCode(e>>a&255);d.collect(r)},d.registerWorker=function(r){r===self?d.seedFile=function(e,a){self.addEventListener("message",function e(t){var r=t.data;r._ds&&r._ds.prng&&(self.removeEventListener("message",e),a(r._ds.prng.err,r._ds.prng.bytes))}),self.postMessage({_ds:{prng:{needed:e}}})}:r.addEventListener("message",function(e){var t=e.data;t._ds&&t._ds.prng&&d.seedFile(t._ds.prng.needed,function(e,t){r.postMessage({_ds:{prng:{err:e,bytes:t}}})})})},d}):dreamsecurity.chkIntegrity(arguments.callee,"prng")}var n,i="prng";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),f(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./md","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(f);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function p(l){null!=l||"function"!=typeof dreamsecurity.chkIntegrity?l.random&&l.random.getBytes||function(e){var t={},r=new Array(4),a=l.util.createBuffer();function n(){var r=l.prng.create(t);return r.getBytes=function(e,t){return r.generate(e,t)},r.getBytesSync=function(e){return p(),r.generate(e)},r}t.formatKey=function(e){var t=l.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),l.aes._expandKey(e,!1)},t.formatSeed=function(e){var t=l.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},t.cipher=function(e,t){return l.aes._updateBlock(e,t,r,!1),a.putInt32(r[0]),a.putInt32(r[1]),a.putInt32(r[2]),a.putInt32(r[3]),a.getBytes()},t.increment=function(e){return++e[3],e},t.md=l.md.sha256;var i,s=n(),o="undefined"!=typeof process&&process.versions&&process.versions.node,c=null;if("undefined"==typeof window||(i=window.crypto||window.msCrypto)&&i.getRandomValues&&(c=function(e){return i.getRandomValues(e)}),l.disableNativeCode||!o&&!c){if(s.collectInt(+new Date,32),"undefined"!=typeof navigator){var u="";for(d in navigator)try{"string"==typeof navigator[d]&&(u+=navigator[d])}catch(e){}s.collect(u),u=null}e&&(e().mousemove(function(e){s.collectInt(e.clientX,16),s.collectInt(e.clientY,16)}),e().keypress(function(e){s.collectInt(e.charCode,8)}))}if(l.random)for(var d in s)l.random[d]=s[d];else l.random=s;l.random.createInstance=n}("undefined"!=typeof jQuery?jQuery:null):dreamsecurity.chkIntegrity(arguments.callee,"random")}var n,i="random";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),p(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./md","./prng","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(p);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function E(p){var f,y,h,g,m,s,u,d;function l(e,t,r){var a=p.util.createBuffer(),n=Math.ceil(t.n.bitLength()/8);if(e.length>n-11){var i=new Error("Message is too long for PKCS#1 v1.5 padding.");throw i.length=e.length,i.max=n-11,i}a.putByte(0),a.putByte(r);var s,o=n-3-e.length;if(0===r||1===r){s=0===r?0:255;for(var c=0;c<o;++c)a.putByte(s)}else for(;0<o;){for(var u=0,d=p.random.getBytes(o),c=0;c<o;++c)0===(s=d.charCodeAt(c))?++u:a.putByte(s);o=u}return a.putByte(0),a.putBytes(e),a}function C(e,t,r,a){var n=Math.ceil(t.n.bitLength()/8),i=p.util.createBuffer(e),s=i.getByte(),o=i.getByte();if(0!==s||r&&0!==o&&1!==o||!r&&2!=o||r&&0===o&&void 0===a)throw new Error("Encryption block is invalid.");var c=0;if(0===o){c=n-3-a;for(var u=0;u<c;++u)if(0!==i.getByte())throw new Error("Encryption block is invalid.")}else if(1===o)for(c=0;1<i.length();){if(255!==i.getByte()){--i.read;break}++c}else if(2===o)for(c=0;1<i.length();){if(0===i.getByte()){--i.read;break}++c}if(0!==i.getByte()||c!==n-3-i.length())throw new Error("Encryption block is invalid.");return i.getBytes()}function t(e){var t=e.toString(16);return"8"<=t[0]&&(t="00"+t),p.util.hexToBytes(t)}null!=p||"function"!=typeof dreamsecurity.chkIntegrity?(void 0===f&&(f=p.jsbn.BigInteger),y=p.asn1,p.pki=p.pki||{},p.pki.rsa=p.rsa=p.rsa||{},h=p.pki,g=[6,4,2,4,2,4,6,2],m={name:"RSAPrivateKey",tagClass:y.Class.UNIVERSAL,type:y.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},s={name:"RSAPublicKey",tagClass:y.Class.UNIVERSAL,type:y.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:y.Class.UNIVERSAL,type:y.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},u=function(e){var t;if(!(e.algorithm in h.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=h.oids[e.algorithm];var a=y.oidToDer(t).getBytes(),n=y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[]),i=y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[]);i.value.push(y.create(y.Class.UNIVERSAL,y.Type.OID,!1,a)),i.value.push(y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,""));var s=y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,e.digest().getBytes());return n.value.push(i),n.value.push(s),y.toDer(n).getBytes()},d=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var a;for(t.dP||(t.dP=t.d.mod(t.p.subtract(f.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(f.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));(a=new f(p.util.bytesToHex(p.random.getBytes(t.n.bitLength()/8)),16).mod(t.n)).equals(f.ZERO););for(var n=(e=e.multiply(a.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),i=e.mod(t.q).modPow(t.dQ,t.q);n.compareTo(i)<0;)n=n.add(t.p);return n.subtract(i).multiply(t.qInv).mod(t.p).multiply(t.q).add(i).multiply(a.modInverse(t.n)).mod(t.n)},h.rsa.encrypt=function(e,t,r){E();var a,n=r,i=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(n=2===r,a=l(e,t,r)):(a=p.util.createBuffer()).putBytes(e);for(var s=new f(a.toHex(),16),o=d(s,t,n).toString(16),c=p.util.createBuffer(),u=i-Math.ceil(o.length/2);0<u;)c.putByte(0),--u;return c.putBytes(p.util.hexToBytes(o)),c.getBytes()},h.rsa.decrypt=function(e,t,r,a){!p.gf&&p.vi.filter&&E();var n=Math.ceil(t.n.bitLength()/8);if(e.length!==n){var i=new Error("Encrypted message length is invalid.");throw i.length=e.length,i.expected=n,i}var s=new f(p.util.createBuffer(e).toHex(),16);if(0<=s.compareTo(t.n))throw new Error("Encrypted message is invalid.");for(var o=d(s,t,r).toString(16),c=p.util.createBuffer(),u=n-Math.ceil(o.length/2);0<u;)c.putByte(0),--u;return c.putBytes(p.util.hexToBytes(o)),!1!==a?C(c.getBytes(),t,r):c.getBytes()},h.rsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var a,n=(r=r||{}).prng||p.random,i={nextBytes:function(e){for(var t=n.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},s=r.algorithm||"PRIMEINC";if("PRIMEINC"!==s)throw new Error("Invalid key generation algorithm: "+s);return(a={algorithm:s,state:0,bits:e,rng:i,eInt:t||65537,e:new f(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(a.eInt),a},h.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new f(null);r.fromInt(30);function a(e,t){return e|t}for(var n,i,s,o,c,u=0,d=+new Date,l=0;null===e.keys&&(t<=0||l<t);){0===e.state?(s=(i=null===e.p?e.pBits:e.qBits)-1,0===e.pqState?(e.num=new f(i,e.rng),e.num.testBit(s)||e.num.bitwiseTo(f.ONE.shiftLeft(s),a,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),u=0,++e.pqState):1===e.pqState?e.num.bitLength()>i?e.pqState=0:e.num.isProbablePrime((c=e.num.bitLength())<=100?27:c<=150?18:c<=200?15:c<=250?12:c<=300?9:c<=350?8:c<=400?7:c<=500?6:c<=600?5:c<=800?4:c<=1250?3:2)?++e.pqState:e.num.dAddOffset(g[u++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(f.ONE).gcd(e.e).compareTo(f.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)):1===e.state?(e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state):2===e.state?(e.p1=e.p.subtract(f.ONE),e.q1=e.q.subtract(f.ONE),e.phi=e.p1.multiply(e.q1),++e.state):3===e.state?0===e.phi.gcd(e.e).compareTo(f.ONE)?++e.state:(e.p=null,e.q=null,e.state=0):4===e.state?(e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0)):5===e.state&&(o=e.e.modInverse(e.phi),e.keys={privateKey:h.rsa.setPrivateKey(e.n,e.e,o,e.p,e.q,o.mod(e.p1),o.mod(e.q1),e.q.modInverse(e.p)),publicKey:h.rsa.setPublicKey(e.n,e.e)}),l+=(n=+new Date)-d,d=n}return null!==e.keys},h.rsa.generateKeyPair=function(e,t,r,a){1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(a=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(a=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,a=t,t=e=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(a=r,r=void 0):(a=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537);var n=h.rsa.createKeyPairGenerationState(e,t,r);if(!a)return h.rsa.stepKeyPairGenerationState(n,0),n.keys;!function(n,e,i){"function"==typeof e&&(i=e,e={});var r={algorithm:{name:(e=e||{}).algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng);function s(){o(n.pBits,function(e,t){return e?i(e):(n.p=t,null!==n.q?c(e,n.q):void o(n.qBits,c))})}function o(e,t){p.prime.generateProbablePrime(e,r,t)}function c(e,t){if(e)return i(e);var r;if(n.q=t,n.p.compareTo(n.q)<0&&(r=n.p,n.p=n.q,n.q=r),0!==n.p.subtract(f.ONE).gcd(n.e).compareTo(f.ONE))return n.p=null,void s();if(0!==n.q.subtract(f.ONE).gcd(n.e).compareTo(f.ONE))return n.q=null,void o(n.qBits,c);if(n.p1=n.p.subtract(f.ONE),n.q1=n.q.subtract(f.ONE),n.phi=n.p1.multiply(n.q1),0!==n.phi.gcd(n.e).compareTo(f.ONE))return n.p=n.q=null,void s();if(n.n=n.p.multiply(n.q),n.n.bitLength()!==n.bits)return n.q=null,void o(n.qBits,c);var a=n.e.modInverse(n.phi);n.keys={privateKey:h.rsa.setPrivateKey(n.n,n.e,a,n.p,n.q,a.mod(n.p1),a.mod(n.q1),n.q.modInverse(n.p)),publicKey:h.rsa.setPublicKey(n.n,n.e)},i(null,n.keys)}s()}(n,r,a)},h.setRsaPublicKey=h.rsa.setPublicKey=function(e,t){var n={n:e,e:t,encrypt:function(e,t,r){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return l(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return p.pkcs1.encode_rsa_oaep(t,e,r)}};else if(-1!==p.util.arrayIndexOf(["RAW","NONE","NULL",null],t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var a=t.encode(e,n,!0);return h.rsa.encrypt(a,n,!0)},verify:function(e,t,r){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===r?r={verify:function(e,t){return t=C(t,n,!0),e===y.fromDer(t).value[1].value}}:"NONE"!==r&&"NULL"!==r&&null!==r||(r={verify:function(e,t){return e===(t=C(t,n,!0))}});var a=h.rsa.decrypt(t,n,!0,!1);return r.verify(e,a,n.n.bitLength())}};return n},h.setRsaPrivateKey=h.rsa.setPrivateKey=function(e,t,r,a,n,i,s,o){var c={n:e,e:t,d:r,p:a,q:n,dP:i,dQ:s,qInv:o,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var a=h.rsa.decrypt(e,c,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:C};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return p.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===p.util.arrayIndexOf(["RAW","NONE","NULL",null],t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(a,c,!1)},sign:function(e,t){var r=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:u},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var a=t.encode(e,c.n.bitLength());return h.rsa.encrypt(a,c,r)}};return c},h.wrapRsaPrivateKey=function(e){return y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(0).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.OID,!1,y.oidToDer(h.oids.rsaEncryption).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.NULL,!1,"")]),y.create(y.Class.UNIVERSAL,y.Type.OCTETSTRING,!1,y.toDer(e).getBytes())])},h.rsa.privateKeyFromAsn1=function(e){var t,r,a,n,i,s,o,c,u={},d=[];if(y.validate(e,m,u,d))return t=p.util.createBuffer(u.privateKeyModulus).toHex(),r=p.util.createBuffer(u.privateKeyPublicExponent).toHex(),a=p.util.createBuffer(u.privateKeyPrivateExponent).toHex(),n=p.util.createBuffer(u.privateKeyPrime1).toHex(),i=p.util.createBuffer(u.privateKeyPrime2).toHex(),s=p.util.createBuffer(u.privateKeyExponent1).toHex(),o=p.util.createBuffer(u.privateKeyExponent2).toHex(),c=p.util.createBuffer(u.privateKeyCoefficient).toHex(),h.setRsaPrivateKey(new f(t,16),new f(r,16),new f(a,16),new f(n,16),new f(i,16),new f(s,16),new f(o,16),new f(c,16));var l=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw l.errors=d,l.type=p.err.unsupported,l},h.privateKeyToAsn1=h.privateKeyToRSAPrivateKey=function(e){return y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,y.integerToDer(0).getBytes()),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.n)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.e)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.d)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.p)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.q)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.dP)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.dQ)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.qInv))])},h.rsa.publicKeyFromAsn1=function(e){var t={},r=[];if(!y.validate(e,s,t,r)){var a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=r,a}var n=p.util.createBuffer(t.publicKeyModulus).toHex(),i=p.util.createBuffer(t.publicKeyExponent).toHex();return h.setRsaPublicKey(new f(n,16),new f(i,16))},h.publicKeyToRSAPublicKey=function(e){return y.create(y.Class.UNIVERSAL,y.Type.SEQUENCE,!0,[y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.n)),y.create(y.Class.UNIVERSAL,y.Type.INTEGER,!1,t(e.e))])}):dreamsecurity.chkIntegrity(arguments.callee,"rsa")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),E(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(E);if((e=e||{}).defined=e.defined||{},e.defined.rsa)return e.rsa;e.defined.rsa=!0;for(var r=0;r<t.length;++r)t[r](e);return e.rsa}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function D(N){var B,k,f,y,s,o,R,n;function w(e){var t=e.toString(16);return"8"<=t[0]&&(t="00"+t),N.util.hexToBytes(t)}function w(e){var t=e.toString(16);return"8"<=t[0]&&(t="00"+t),N.util.hexToBytes(t)}null!=N||"function"!=typeof dreamsecurity.chkIntegrity?(void 0===B&&(B=N.jsbn.BigInteger),k=N.asn1,N.pki=N.pki||{},N.pki.kcdsa=N.kcdsa=N.kcdsa||{},f=N.pki,y=[6,4,2,4,2,4,6,2],s={name:"KCDSAPrivateKey.exponent",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"privateKeyExponent"},o={name:"KCDSAPublicKey.public",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"publicKey"},R={name:"KCDSASignature",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"KCDSASignature.R",tagClass:k.Class.UNIVERSAL,type:k.Type.BITSTRING,constructed:!1,capture:"r"},{name:"KCDSASignature.S",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"s"}]},n={name:"KCDSAParameters",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"P",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"p"},{name:"Q",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"q"},{name:"G",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"g"}]},f.kcdsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var a,n=(r=r||{}).prng||N.random,i={nextBytes:function(e){for(var t=n.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},s=r.algorithm||"PRIMEINC";if("PRIMEINC"!==s)throw new Error("Invalid key generation algorithm: "+s);return(a={algorithm:s,state:0,bits:e,rng:i,eInt:t||65537,e:new B(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(a.eInt),a},f.kcdsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new B(null);r.fromInt(30);function a(e,t){return e|t}for(var n,i,s,o,c,u=0,d=+new Date,l=0;null===e.keys&&(t<=0||l<t);){0===e.state?(s=(i=null===e.p?e.pBits:e.qBits)-1,0===e.pqState?(e.num=new B(i,e.rng),e.num.testBit(s)||e.num.bitwiseTo(B.ONE.shiftLeft(s),a,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),u=0,++e.pqState):1===e.pqState?e.num.bitLength()>i?e.pqState=0:e.num.isProbablePrime((c=e.num.bitLength())<=100?27:c<=150?18:c<=200?15:c<=250?12:c<=300?9:c<=350?8:c<=400?7:c<=500?6:c<=600?5:c<=800?4:c<=1250?3:2)?++e.pqState:e.num.dAddOffset(y[u++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(B.ONE).gcd(e.e).compareTo(B.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)):1===e.state?(e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state):2===e.state?(e.p1=e.p.subtract(B.ONE),e.q1=e.q.subtract(B.ONE),e.phi=e.p1.multiply(e.q1),++e.state):3===e.state?0===e.phi.gcd(e.e).compareTo(B.ONE)?++e.state:(e.p=null,e.q=null,e.state=0):4===e.state?(e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0)):5===e.state&&(o=e.e.modInverse(e.phi),e.keys={privateKey:f.kcdsa.setPrivateKey(e.n,e.e,o,e.p,e.q,o.mod(e.p1),o.mod(e.q1),e.q.modInverse(e.p)),publicKey:f.kcdsa.setPublicKey(e.n,e.e)}),l+=(n=+new Date)-d,d=n}return null!==e.keys},f.kcdsa.generateKeyPair=function(e,t,r,a){1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(a=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(a=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,a=t,t=e=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(a=r,r=void 0):(a=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537);var n=f.kcdsa.createKeyPairGenerationState(e,t,r);if(!a)return f.kcdsa.stepKeyPairGenerationState(n,0),n.keys;!function(n,e,i){"function"==typeof e&&(i=e,e={});var r={algorithm:{name:(e=e||{}).algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(r.prng=e.prng);function s(){o(n.pBits,function(e,t){return e?i(e):(n.p=t,null!==n.q?c(e,n.q):void o(n.qBits,c))})}function o(e,t){N.prime.generateProbablePrime(e,r,t)}function c(e,t){if(e)return i(e);var r;if(n.q=t,n.p.compareTo(n.q)<0&&(r=n.p,n.p=n.q,n.q=r),0!==n.p.subtract(B.ONE).gcd(n.e).compareTo(B.ONE))return n.p=null,void s();if(0!==n.q.subtract(B.ONE).gcd(n.e).compareTo(B.ONE))return n.q=null,void o(n.qBits,c);if(n.p1=n.p.subtract(B.ONE),n.q1=n.q.subtract(B.ONE),n.phi=n.p1.multiply(n.q1),0!==n.phi.gcd(n.e).compareTo(B.ONE))return n.p=n.q=null,void s();if(n.n=n.p.multiply(n.q),n.n.bitLength()!==n.bits)return n.q=null,void o(n.qBits,c);var a=n.e.modInverse(n.phi);n.keys={privateKey:f.kcdsa.setPrivateKey(n.n,n.e,a,n.p,n.q,a.mod(n.p1),a.mod(n.q1),n.q.modInverse(n.p)),publicKey:f.kcdsa.setPublicKey(n.n,n.e)},i(null,n.keys)}s()}(n,r,a)},f.setKcdsaPublicKey=f.kcdsa.setPublicKey=function(e,t,r,a){var b={p:e,q:t,g:r,y:a,verify:function(e,t,r,a){D();var n=(n=N.util.createBuffer(w(b.y)).toHex()).substr(n.length-128,128);n=N.util.hexToBytes(n);var s=N.md.algorithms[t].create();s.update(n),s.update(e);var o=k.fromDer(r),c={},u=[];if(!k.validate(o,R,c,u)){var d=new Error("Cannot read KCDSA Signature. ");throw d.errors=u,d}var l=N.util.createBuffer(c.r).toHex(),p=N.util.createBuffer(c.s).toHex(),f=new B(l,16),y=new B(p,16),h=s.digest(),g=new B(h.toHex(),16),m=(m=f.xor(g)).mod(b.q),C=b.y.modPow(y,b.p),E=b.g.modPow(m,b.p),v=C.multiply(E).mod(b.p),S=b.p.toByteArray().length;if(S%128==1&&--S,(C=N.util.createBuffer(w(v)).toHex()).length>2*S)C=C.substr(C.length-2*S,2*S);else if(C.length<2*S){var T="";for(i=0;i<2*S-C.length;i++)T+="0";C=T+C}C=N.util.hexToBytes(C);var I=N.md.algorithms[t].create();I.update(C);var A=I.digest();return f.equals(new B(A.toHex(),16))}};return b},f.setKcdsaPrivateKey=f.kcdsa.setPrivateKey=function(e,t,r,a,n){var I={p:e,q:t,g:r,x:a,y:n,sign:function(e,t,r){D();var a=(a=N.util.createBuffer(w(r)).toHex()).substr(a.length-128,128);a=N.util.hexToBytes(a);var n=N.md.algorithms[t].create();n.update(a),n.update(e);var s=N.random.getBytesSync(n.digestLength),o=(o=new B(N.util.createBuffer(s).toHex(),16)).mod(I.q),c=I.g.modPow(o,I.p),u=I.p.toByteArray().length;u%128==1&&--u;var d=N.util.createBuffer(w(c)).toHex();if(d.length>2*u)d=d.substr(d.length-2*u,2*u);else if(d.length<2*u){var l="";for(i=0;i<2*u-d.length;i++)l+="0";d=l+d}d=N.util.hexToBytes(d);var p=N.md.algorithms[t].create();p.update(d);var f=p.digest(),y=new B(f.toHex(),16),h=n.digest(),g=new B(h.toHex(),16),m=(m=y.xor(g)).mod(I.q),C=o.subtract(m);0!=C.s&&C.add(I.q);var E=(E=I.x.multiply(C)).mod(I.q),v=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[]),S=k.create(k.Class.UNIVERSAL,k.Type.BITSTRING,!1,String.fromCharCode(0)+f.getBytes()),T=k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(E));return v.value.push(S),v.value.push(T),k.toDer(v).getBytes()}};return I},f.kcdsa.domainParamFromAsn1=function(e){var t={},r=[];if(k.validate(e,n,t,r))return p=N.util.createBuffer(t.p).toHex(),q=N.util.createBuffer(t.q).toHex(),g=N.util.createBuffer(t.g).toHex(),{p:new B(p,16),q:new B(q,16),g:new B(g,16)};var a=new Error("Cannot read kcdsaParam.");throw a.errors=r,a.type=N.err.process,a},f.kcdsa.privateKeyFromAsn1=function(e,t){var r,a={},n=[];if(!k.validate(e,s,a,n)){var i=new Error("Cannot read kcdsaPrivateKey.");throw i.errors=n,i.type=N.err.process,i}r=N.util.createBuffer(a.privateKeyExponent).toHex();t=f.kcdsa.domainParamFromAsn1(t);return f.setKcdsaPrivateKey(t.p,t.q,t.g,new B(r,16))},f.privateKeyToKCDSAPrivateKey=function(e){return k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(e.x))},f.toKCDSAParam=function(e){return k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(e.p)),k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(e.q)),k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(e.g))])},f.kcdsa.publicKeyFromAsn1=function(e,t){var r,a={},n=[];if(!k.validate(e,o,a,n)){var i=new Error("Cannot read kcdsaPublicKey.");throw i.errors=n,i.type=N.err.process,i}r=N.util.createBuffer(a.publicKey).toHex();t=f.kcdsa.domainParamFromAsn1(t);return f.setKcdsaPublicKey(t.p,t.q,t.g,new B(r,16))},f.publicKeyToKCDSAPublicKey=function(e){return k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,w(e.y))])}):dreamsecurity.chkIntegrity(arguments.callee,"kcdsa")}var n,s="kcdsa";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),D(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(D);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){e.mgf=e.mgf||{},e.mgf.mgf1=e.mgf1}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./mgf1"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined.mgf)return e.mgf;e.defined.mgf=!0;for(var r=0;r<t.length;++r)t[r](e);return e.mgf}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function c(o){null!=o?(o.mgf=o.mgf||{},(o.mgf.mgf1=o.mgf1=o.mgf1||{}).create=function(s){return{generate:function(e,t){c();for(var r=new o.util.ByteBuffer,a=Math.ceil(t/s.digestLength),n=0;n<a;n++){var i=new o.util.ByteBuffer;i.putInt32(n),s.start(),s.update(e+i.getBytes()),r.putBuffer(s.digest())}return r.truncate(r.length()-t),r.getBytes()},name:"mgf1",md:s.algorithm}}):"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"mgf1")}var n,i="mgf1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),c(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(c);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function T(S){null!=S||"function"!=typeof dreamsecurity.chkIntegrity?(S.pss=S.pss||{}).create=function(e){T(),3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var h,g=e.md,m=e.mgf,C=g.digestLength,E=e.salt||null;if("string"==typeof E&&(E=S.util.createBuffer(E)),"saltLength"in e)h=e.saltLength;else{if(null===E)throw new Error("Salt length not specified or specific salt not given.");h=E.length()}if(null!==E&&E.length()!==h)throw new Error("Given salt length does not match length of given salt.");var v=e.prng||S.random,t={};return t.md=g.algorithm,t.mgf=m.name+"-"+m.md,t.saltLength=h,t.encode=function(e,t){T();var r,a=t-1,n=Math.ceil(a/8),i=e.digest().getBytes();if(n<C+h+2)throw new Error("Message is too long to encrypt.");r=null===E?v.getBytesSync(h):E.bytes();var s=new S.util.ByteBuffer;s.fillWithByte(0,8),s.putBytes(i),s.putBytes(r),g.start(),g.update(s.getBytes());var o=g.digest().getBytes(),c=new S.util.ByteBuffer;c.fillWithByte(0,n-h-C-2),c.putByte(1),c.putBytes(r);for(var u=c.getBytes(),d=n-C-1,l=m.generate(o,d),p="",f=0;f<d;f++)p+=String.fromCharCode(u.charCodeAt(f)^l.charCodeAt(f));var y=65280>>8*n-a&255;return(p=String.fromCharCode(p.charCodeAt(0)&~y)+p.substr(1))+o+String.fromCharCode(188)},t.verify=function(e,t,r){T();var a=r-1,n=Math.ceil(a/8);if(t=t.substr(t.length-n,n),n<C+h+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==t.charCodeAt(n-1))throw new Error("Encoded message does not end in 0xBC.");var i=n-C-1,s=t.substr(0,i),o=t.substr(i,C),c=65280>>8*n-a&255;if(0!=(s.charCodeAt(0)&c))throw new Error("Bits beyond keysize not zero as expected.");for(var u=m.generate(o,i),d="",l=0;l<i;l++)d+=String.fromCharCode(s.charCodeAt(l)^u.charCodeAt(l));d=String.fromCharCode(d.charCodeAt(0)&~c)+d.substr(1);var p=n-C-h-2;for(l=0;l<p;l++)if(0!==d.charCodeAt(l))throw new Error("Leftmost octets not zero as expected");if(1!==d.charCodeAt(p))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var f=d.substr(d.length-h,h),y=new S.util.ByteBuffer;return y.fillWithByte(0,8),y.putBytes(e),y.putBytes(f),g.start(),g.update(y.getBytes()),o===g.digest().getBytes()},t}:dreamsecurity.chkIntegrity(arguments.callee,"pss")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),T(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./random","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(T);if((e=e||{}).defined=e.defined||{},e.defined.pss)return e.pss;e.defined.pss=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pss}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function I(S){var e,t;function T(e,t,r){r=r||S.md.sha1.create();for(var a="",n=Math.ceil(t/r.digestLength),i=0;i<n;++i){var s=String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i);r.start(),r.update(e+s),a+=r.digest().getBytes()}return a.substring(0,t)}null!=S||"function"!=typeof dreamsecurity.chkIntegrity?(e=S.pkcs1=S.pkcs1||{},t=S.asn1,(S.pkcs1.asn1=S.pkcs1.asn1||{}).rsaoaepParamValidator={name:"RSAES_OAEP_params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.ctx0",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.hashAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"hashAlgorithm"}]},{name:"RSAES_OAEP_params.ctx1",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAES_OAEP_params.maskGenAlgorithm.mgf",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"mgf"},{name:"RSAES_OAEP_params.maskGenAlgorithm.param",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"mgfHashAlg"}]}]}]},e.encode_rsa_oaep=function(e,t,r){var a,n,i,s;I(),"string"==typeof r?(a=r,n=arguments[3]||void 0,i=arguments[4]||void 0):r&&(a=r.label||void 0,n=r.seed||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md)),i?i.start():i=S.md.sha1.create(),s=s||i;var o=Math.ceil(e.n.bitLength()/8),c=o-2*i.digestLength-2;if(t.length>c)throw(f=new Error("RSAES-OAEP input message length is too long.")).length=t.length,f.maxLength=c,f;a=a||"",i.update(a,"raw");for(var u=i.digest(),d="",l=c-t.length,p=0;p<l;p++)d+="\0";var f,y=u.getBytes()+d+S.util.hexToBytes("01")+t;if(n){if(n.length!==i.digestLength){throw(f=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=n.length,f.digestLength=i.digestLength,f}}else n=S.random.getBytes(i.digestLength);var h=T(n,o-i.digestLength-1,s),g=S.util.xorBytes(y,h,y.length),m=T(g,i.digestLength,s);return"\0"+S.util.xorBytes(n,m,n.length)+g},e.decode_rsa_oaep=function(e,t,r){var a,n,i;I(),"string"==typeof r?(a=r,n=arguments[3]||void 0):r&&(a=r.label||void 0,n=r.md||void 0,r.mgf1&&r.mgf1.md&&(i=r.mgf1.md));var s=Math.ceil(e.n.bitLength()/8);if(t.length!==s)throw(h=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,h.expectedLength=s,h;if(void 0===n?n=S.md.sha1.create():n.start(),i=i||n,s<2*n.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");a=a||"",n.update(a,"raw");for(var o=n.digest().getBytes(),c=t.charAt(0),u=t.substring(1,n.digestLength+1),d=t.substring(1+n.digestLength),l=T(d,n.digestLength,i),p=T(S.util.xorBytes(u,l,u.length),s-n.digestLength-1,i),f=S.util.xorBytes(d,p,d.length),y=f.substring(0,n.digestLength),h="\0"!==c,g=0;g<n.digestLength;++g)h|=o.charAt(g)!==y.charAt(g);for(var m=1,C=n.digestLength,E=n.digestLength;E<f.length;E++){var v=f.charCodeAt(E);h|=v&(m?65534:0),C+=m&=1&v^1}if(h||1!==f.charCodeAt(C))throw new Error("Invalid RSAES-OAEP padding.");return f.substring(C+1)}):dreamsecurity.chkIntegrity(arguments.callee,"pkcs1")}var n,i="pkcs1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),I(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util","./random","./sha1"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(I);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function s(o){var p,g,E,v,m,S,T;function e(e,t){o.cipher.registerAlgorithm(e,function(){return new o.aes.Algorithm(e,t)})}function a(){p=!0,m=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;E=new Array(256),v=new Array(256),S=new Array(4),T=new Array(4);for(t=0;t<4;++t)S[t]=new Array(256),T[t]=new Array(256);for(var r,a,n,i,s,o,c,u=0,d=0,t=0;t<256;++t){i=(i=d^d<<1^d<<2^d<<3^d<<4)>>8^255&i^99,E[u]=i,v[i]=u,o=(s=e[i])<<24^i<<16^i<<8^i^s,c=((r=e[u])^(a=e[r])^(n=e[a]))<<24^(u^n)<<16^(u^a^n)<<8^u^r^n;for(var l=0;l<4;++l)o=(S[l][u]=o)<<24|o>>>8,c=(T[l][i]=c)<<24|c>>>8;0===u?u=d=1:(u=r^e[e[e[r^n]]],d^=e[e[d]])}}function c(e,t){for(var r,a=e.slice(0),n=1,i=a.length,s=g*(i+6+1),o=i;o<s;++o)r=a[o-1],o%i==0?(r=E[r>>>16&255]<<24^E[r>>>8&255]<<16^E[255&r]<<8^E[r>>>24]^m[n]<<24,n++):6<i&&o%i==4&&(r=E[r>>>24]<<24^E[r>>>16&255]<<16^E[r>>>8&255]<<8^E[255&r]),a[o]=a[o-i]^r;if(t){for(var c,u=T[0],d=T[1],l=T[2],p=T[3],f=a.slice(0),o=0,y=(s=a.length)-g;o<s;o+=g,y-=g)if(0===o||o===s-g)f[o]=a[y],f[o+1]=a[y+3],f[o+2]=a[y+2],f[o+3]=a[y+1];else for(var h=0;h<g;++h)c=a[y+h],f[o+(3&-h)]=u[E[c>>>24]]^d[E[c>>>16&255]]^l[E[c>>>8&255]]^p[E[255&c]];a=f}return a}function n(e,t,r,a){for(var n,i,s,o,c,u,d,l=e.length/4-1,p=a?(n=T[0],i=T[1],s=T[2],o=T[3],v):(n=S[0],i=S[1],s=S[2],o=S[3],E),f=t[0]^e[0],y=t[a?3:1]^e[1],h=t[2]^e[2],g=t[a?1:3]^e[3],m=3,C=1;C<l;++C)c=n[f>>>24]^i[y>>>16&255]^s[h>>>8&255]^o[255&g]^e[++m],u=n[y>>>24]^i[h>>>16&255]^s[g>>>8&255]^o[255&f]^e[++m],d=n[h>>>24]^i[g>>>16&255]^s[f>>>8&255]^o[255&y]^e[++m],g=n[g>>>24]^i[f>>>16&255]^s[y>>>8&255]^o[255&h]^e[++m],f=c,y=u,h=d;r[0]=p[f>>>24]<<24^p[y>>>16&255]<<16^p[h>>>8&255]<<8^p[255&g]^e[++m],r[a?3:1]=p[y>>>24]<<24^p[h>>>16&255]<<16^p[g>>>8&255]<<8^p[255&f]^e[++m],r[2]=p[h>>>24]<<24^p[g>>>16&255]<<16^p[f>>>8&255]<<8^p[255&y]^e[++m],r[a?1:3]=p[g>>>24]<<24^p[f>>>16&255]<<16^p[y>>>8&255]<<8^p[255&h]^e[++m]}function i(e){var t="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?o.cipher.createDecipher(t,e.key):o.cipher.createCipher(t,e.key),n=a.start;return a.start=function(e,t){var r=null;t instanceof o.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,n.call(a,t)},a}null!=o?(o.aes=o.aes||{},o.aes.startEncrypting=function(e,t,r,a){var n=i({key:e,output:r,decrypt:!1,mode:a});return n.start(t),n},o.aes.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},o.aes.startDecrypting=function(e,t,r,a){var n=i({key:e,output:r,decrypt:!0,mode:a});return n.start(t),n},o.aes.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},o.aes.Algorithm=function(e,t){s(),p||a();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return n(r._w,e,t,!1)},decrypt:function(e,t){return n(r._w,e,t,!0)}}}),r._init=!1},o.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"==typeof r){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aes algorithm.");r=o.util.createBuffer(r)}else if(o.util.isArray(r)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aes algorithm.");t=r,r=o.util.createBuffer();for(var a=0;a<t.length;++a)r.putByte(t[a])}if(!o.util.isArray(r)){t=r,r=[];var n=t.length();if(16===n||24===n||32===n){n>>>=2;for(a=0;a<n;++a)r.push(t.getInt32())}}if(!o.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var i=this.mode.name,s=-1!==o.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],i);this._w=c(r,e.decrypt&&!s),this._init=!0}},o.aes._expandKey=function(e,t){return p||a(),c(e,t)},o.aes._updateBlock=n,e("AES-CBC",o.cipher.modes.cbc),e("AES-CFB",o.cipher.modes.cfb),e("AES-OFB",o.cipher.modes.ofb),e("AES-CTR",o.cipher.modes.ctr),e("AES-GCM",o.cipher.modes.gcm),p=!1,g=4):dreamsecurity.chkIntegrity&&"function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"aes")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),s(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(s);if((e=e||{}).defined=e.defined||{},e.defined.aes)return e.aes;e.defined.aes=!0;for(var r=0;r<t.length;++r)t[r](e);return e.aes}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(i){var d,l,p,f,y,T;function e(e,t){i.cipher.registerAlgorithm(e,function(){return new i.seed.Algorithm(e,t)})}function h(e){return 255&e}function g(e){return 255&e>>>8}function m(e){return 255&e>>>16}function C(e){return 255&e>>>24}function I(e){e[0]=e[0]>>>24|e[0]<<24|e[0]<<8&16711680|e[0]>>>8&65280}function I(e){return e>>>24|e<<24|e<<8&16711680|e>>>8&65280}function E(e,t,r,a,n,i){var s,o,c=t[0];t[0]=t[0]>>>8^r[0]<<24,r[0]=r[0]>>>8^c<<24,s=t[0]+a[0]-y[i],o=r[0]+y[i]-n[0],e[0]=d[h(s)]^l[g(s)]^p[m(s)]^f[C(s)],e[1]=d[h(o)]^l[g(o)]^p[m(o)]^f[C(o)]}function v(e,t,r,a,n,i){var s,o,c=a[0];a[0]=a[0]<<8^n[0]>>>24,n[0]=n[0]<<8^c>>>24,s=t[0]+a[0]-y[i],o=r[0]+y[i]-n[0],e[0]=d[h(s)]^l[g(s)]^p[m(s)]^f[C(s)],e[1]=d[h(o)]^l[g(o)]^p[m(o)]^f[C(o)]}function A(e,t,r,a,n){var i,s=r[0]^n[0],o=a[0]^n[1],c=s<0?2147483647&s|2147483648:s;o=d[h(o^=s)]^l[g(o)]^p[m(o)]^f[C(o)],c=(s=d[h(c+=i=o<0?2147483647&o|2147483648:o)]^l[g(c)]^p[m(c)]^f[C(c)])<0?2147483647&s|2147483648:s,c+=i=(o=d[h(i+=c)]^l[g(i)]^p[m(i)]^f[C(i)])<0?2147483647&o|2147483648:o,e[0]^=c,t[0]^=i}function a(e,t,r,a){var n,i,s,o,c,u,d,l,p,f,y,h,g,m,C=new Array(1),E=new Array(1),v=new Array(1),S=new Array(1);C[0]=t[0],E[0]=t[1],v[0]=t[2],S[0]=t[3],a?(n=e,i=C,s=E,o=v,c=S,u=new Array(2),d=31,T||(I(i),I(s),I(o),I(c)),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[d--],A(o,c,i,s,u),u[1]=n[d--],u[0]=n[d--],A(i,s,o,c,u),u[1]=n[d--],u[0]=n[0],A(o,c,i,s,u),T||(I(i),I(s),I(o),I(c))):(l=e,p=C,f=E,y=v,h=S,g=new Array(2),T||(I(p),I(f),I(y),I(h)),g[m=0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[m++],A(y,h,p,f,g),g[0]=l[m++],g[1]=l[m++],A(p,f,y,h,g),g[0]=l[m++],g[1]=l[31],A(y,h,p,f,g),T||(I(p),I(f),I(y),I(h))),r[0]=v[0],r[1]=S[0],r[2]=C[0],r[3]=E[0]}function s(e){var t="SEED-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?i.cipher.createDecipher(t,e.key):i.cipher.createCipher(t,e.key),n=a.start;return a.start=function(e,t){var r=null;t instanceof i.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,n.call(a,t)},a}null!=i||"function"!=typeof dreamsecurity.chkIntegrity?(i.seed=i.seed||{},i.seed.startEncrypting=function(e,t,r,a){var n=s({key:e,output:r,decrypt:!1,mode:a||(null===t?"ECB":"CBC")});return n.start(t),n},i.seed.createEncryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!1,mode:t})},i.seed.startDecrypting=function(e,t,r,a){var n=s({key:e,output:r,decrypt:!0,mode:a||(null===t?"ECB":"CBC")});return n.start(t),n},i.seed.createDecryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!0,mode:t})},i.seed.Algorithm=function(e,t){n();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(r._keys,e,t,!1)},decrypt:function(e,t){return a(r._keys,e,t,!0)}}}),r._init=!1},i.seed.Algorithm.prototype.initialize=function(e){if(!this._init){var t=i.util.createBuffer(e.key);if(0===this.name.indexOf("SEED")&&16!==t.length())throw new Error("Invalid SEED key size: "+8*t.length());this._keys=function(e){var t,r,a=new Array(1),n=new Array(1),i=new Array(1),s=new Array(1),o=new Array(2),c=2,u=[];a[0]=e.getInt32(),n[0]=e.getInt32(),i[0]=e.getInt32(),s[0]=e.getInt32(),T||(a[0]=I(a[0]),n[0]=I(n[0]),i[0]=I(i[0]),s[0]=I(s[0]));return t=a[0]+i[0]-y[0],r=n[0]-s[0]+y[0],u[0]=d[h(t)]^l[g(t)]^p[m(t)]^f[C(t)],u[1]=d[h(r)]^l[g(r)]^p[m(r)]^f[C(r)],E(o,a,n,i,s,1),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,2),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,3),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,4),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,5),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,6),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,7),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,8),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,9),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,10),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,11),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,12),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,13),u[c++]=o[0],u[c++]=o[1],v(o,a,n,i,s,14),u[c++]=o[0],u[c++]=o[1],E(o,a,n,i,s,15),u[c++]=o[0],u[31]=o[1],u}(t),this._init=!0}},e("SEED-CBC",i.cipher.modes.cbc),e("SEED-ECB",i.cipher.modes.ecb),d=[696885672,92635524,382128852,331600848,340021332,487395612,747413676,621093156,491606364,54739776,403181592,504238620,289493328,1020063996,181060296,591618912,671621160,71581764,536879136,495817116,549511392,583197408,147374280,386339604,629514660,261063564,50529024,994800504,999011256,318968592,314757840,785310444,809529456,210534540,1057960764,680042664,839004720,500027868,919007988,876900468,751624428,361075092,185271048,390550356,474763356,457921368,1032696252,16843008,604250148,470552604,860058480,411603096,268439568,214745292,851636976,432656856,738992172,667411428,843215472,58950528,462132120,297914832,109478532,164217288,541089888,272650320,595829664,734782440,218956044,914797236,512660124,256852812,931640244,441078360,113689284,944271480,646357668,302125584,797942700,365285844,557932896,63161280,881111220,21053760,306336336,1028485500,227377548,134742024,521081628,428446104,0,420024600,67371012,323179344,935850996,566354400,1036907004,910586484,789521196,654779172,813740208,193692552,235799052,730571688,578986656,776888940,327390096,223166796,692674920,1011642492,151585032,168428040,1066382268,802153452,868479984,96846276,126321540,335810580,1053750012,608460900,516870876,772678188,189481800,436867608,101057028,553722144,726360936,642146916,33686016,902164980,310547088,176849544,202113036,864269232,1045328508,281071824,977957496,122110788,377918100,633725412,637936164,8421504,764256684,533713884,562143648,805318704,923218740,781099692,906375732,352653588,570565152,940060728,885321972,663200676,88424772,206323788,25264512,701096424,75792516,394761108,889532724,197903304,248431308,1007431740,826372464,285282576,130532292,160006536,893743476,1003222008,449499864,952692984,344232084,424235352,42107520,80003268,1070593020,155795784,956903736,658989924,12632256,265274316,398971860,948482232,252642060,244220556,37896768,587408160,293704080,743202924,466342872,612671652,872689716,834793968,138952776,46318272,793731948,1024274748,755835180,4210752,1049539260,1041117756,1015853244,29475264,713728680,982168248,240009804,356864340,990589752,483184860,675831912,1062171516,478974108,415813848,172638792,373707348,927429492,545300640,768467436,105267780,897954228,722150184,625303908,986379e3,600040416,965325240,830583216,529503132,508449372,969535992,650568420,847426224,822161712,717939432,760045932,525292380,616882404,817950960,231588300,143163528,369496596,973746744,407392344,348442836,574775904,688464168,117900036,855847728,684253416,453710616,84214020,961114488,276861072,709517928,705307176,445289112],l=[943196208,3894986976,741149985,2753988258,3423588291,3693006546,2956166067,3090712752,2888798115,1612726368,1410680145,3288844227,1141130304,1815039843,1747667811,1478183763,3221472195,1612857954,808649523,3023406513,673777953,2686484640,3760374498,2754054051,3490956243,2417066385,269549841,67503618,471600144,3158084784,875955762,1208699715,3962556387,2282260608,1814842464,2821228704,337053459,3288646848,336987666,4097098992,3221406402,1141196097,3760308705,3558262482,1010765619,1010634033,2349764226,2551744656,673712160,1276005954,4097230578,1010699826,2753922465,4164536817,202181889,3693072339,3625502928,673909539,1680229986,2017086066,606537507,741281571,4029792753,1882342002,1073889858,3558130896,1073824065,3221274816,1882407795,1680295779,2888600736,2282457987,4097296371,2888666529,2147516544,471797523,3356150466,741084192,2821360290,875824176,3490890450,134941443,3962490594,3895052769,1545424209,2484372624,404228112,4164471024,1410811731,2888732322,134744064,3288712641,269681427,3423456705,2215020162,3090778545,4232040435,2084392305,3221340609,808517937,4097164785,2282392194,1747602018,2956034481,3490824657,538968096,3558328275,131586,539099682,67372032,1747470432,1882276209,67569411,3625700307,2619182481,2551810449,1612792161,3158216370,3827746530,1478052177,3692940753,1343308113,2417000592,3692874960,2551876242,2686682019,2821426083,3490758864,2147582337,202313475,1141327683,404359698,3760440291,3962359008,2349698433,3158282163,2484504210,2017151859,1545358416,2686616226,2686550433,1612923747,539165475,1275940161,3356018880,2619248274,2619116688,943327794,202116096,741215778,3090844338,1814974050,2619314067,1478117970,4029858546,2417132178,4029924339,1208568129,2016954480,3423390912,336921873,4164668403,1882210416,1949648241,2084523891,875889969,269484048,197379,1680098400,1814908257,3288778434,1949582448,3558196689,3023340720,3895118562,134809857,1949714034,404293905,4231974642,1073758272,269615634,3760242912,3158150577,67437825,4164602610,65793,4029726960,673843746,1545490002,2821294497,1410745938,1073955651,2214954369,336856080,2282326401,2551942035,2955968688,3827680737,1208502336,2017020273,2484570003,4231843056,471731730,2147648130,539033889,2349632640,404425491,1545555795,1949779827,1410614352,2956100274,471665937,606405921,1276071747,0,1141261890,3962424801,1477986384,1343373906,3895184355,2084458098,3625634514,3356084673,4231908849,808452144,2484438417,1680164193,1010568240,3023472306,3827614944,3090910131,2084326512,202247682,1343242320,943262001,606471714,808583730,2214888576,1747536225,2417197971,876021555,3827812323,606340128,2753856672,3356216259,1343439699,134875650,2215085955,3625568721,1275874368,2147713923,2349830019,3423522498,943393587,1208633922,3023538099],p=[2712152457,2172913029,3537114822,3553629123,1347687492,287055117,2695638156,556016901,1364991309,1128268611,270014472,303832590,1364201793,4043062476,3267889866,1667244867,539502600,1078199364,538976256,2442927501,3772784832,3806339778,3234334920,320083719,2711889285,2206994319,50332419,1937259339,3015195531,319820547,3536851650,3807129294,1886400576,2156661900,859586319,2695374984,842019330,3520863693,4076091078,1886663748,3773574348,2442401157,50858763,1398019911,1348213836,1398283083,2981903757,16777473,539239428,270277644,1936732995,2425886856,269488128,3234598092,4075827906,3520600521,539765772,3823380423,1919955522,2206204803,2476219275,3520074177,2189690502,3251112393,1616912448,1347424320,2745181059,3823643595,17566989,2998154886,2459704974,1129058127,3014932359,1381505610,3267626694,1886926920,2728666758,303043074,2745970575,3520337349,1633689921,3284140995,2964599940,1094713665,1380979266,1903967565,2173439373,526344,320610063,2442664329,0,286791945,263172,1397756739,4092868551,3789562305,4059839949,1920218694,590098191,589571847,2964336768,2206731147,34344462,2745707403,2728403586,1651256910,2475692931,1095503181,1634216265,1887190092,17303817,34081290,3015458703,3823906767,4092605379,3250849221,2206467975,269751300,4076617422,1617175620,3537641166,573320718,1128794955,303569418,33818118,555753729,1667771211,1650730566,33554946,4059313605,2458915458,2189953674,789516,3014669187,1920745038,3503296704,1920481866,1128531783,2459178630,3789825477,572794374,2155872384,2712415629,3554418639,2711626113,808464384,859059975,2729193102,842282502,286528773,572531202,808990728,4042536132,2745444231,1094976837,1078725708,2172649857,3790088649,2156135556,2475956103,825505029,3284667339,3268153038,809253900,1903178049,286265601,3284404167,2173176201,1903441221,4093131723,3537377994,4042799304,2425623684,1364728137,2189427330,3234071748,4093394895,1095240009,825768201,1667508039,3233808576,3284930511,3553892295,2964863112,51121935,2190216846,1111491138,589308675,2442137985,1617701964,3554155467,2695111812,808727556,4059050433,1078462536,3267363522,1668034383,826031373,556543245,1077936192,2998681230,842808846,2965126284,3250586049,2728929930,2998418058,1112280654,1364464965,859323147,3504086220,1617438792,1937522511,2426150028,3503823048,1112017482,1381242438,1936996167,2694848640,3790351821,1111754310,2981377413,589835019,1633953093,4076354250,3823117251,2981640585,2981114241,2476482447,1381768782,4059576777,3806602950,2997891714,825241857,3806866122,1634479437,1398546255,3773048004,4042272960,3251375565,2156398728,303306246,842545674,1347950664,3503559876,1650467394,556280073,50595591,858796803,3773311176,320346891,17040645,1903704393,2425360512,1650993738,573057546,2459441802],f=[137377848,3370182696,220277805,2258805798,3485715471,3469925406,2209591347,2293282872,2409868335,1080057888,1162957845,3351495687,1145062404,1331915823,1264805931,1263753243,3284385795,1113743394,53686323,2243015733,153167913,2158010400,3269648418,2275648551,3285438483,2173800465,17895441,100795398,202382364,2360392764,103953462,1262700555,3487820847,2290124808,1281387564,2292230184,118690839,3300967428,101848086,3304125492,3267543042,1161905157,3252805665,3335705622,255015999,221330493,2390920206,2291177496,136325160,1312967694,3337810998,238173246,2241963045,3388078137,218172429,3486768159,3369130008,186853419,1180853286,1249015866,119743527,253963311,3253858353,1114796082,1111638018,3302020116,1094795265,3233857536,1131638835,1197696039,2359340076,2340653067,3354653751,2376182829,2155905024,252910623,3401762826,203435052,2325915690,70267956,3268595730,184748043,3470978094,3387025449,1297177629,2224067604,135272472,3371235384,1196643351,2393025582,134219784,3317810181,51580947,3452029965,2256700422,2310125625,3488873535,1299283005,3250700289,20000817,3320968245,2323810314,1247963178,2175905841,3251752977,2105376,3352548375,33685506,35790882,67109892,1214277672,1097953329,117638151,3419658267,2375130141,2308020249,1096900641,2394078270,3336758310,1230067737,3453082653,1095847953,2156957712,3436239900,2324863002,2208538659,2342758443,3234910224,2172747777,251857935,1195590663,168957978,3286491171,3437292588,2374077453,2410921023,2257753110,1265858619,1280334876,2191695906,2174853153,1130586147,52633635,1296124941,3368077320,2391972894,2358287388,171063354,201329676,237120558,2326968378,1315073070,2408815647,1246910490,3270701106,2190643218,3287543859,1229015049,1215330360,3435187212,85005333,3421763643,1081110576,1165063221,1332968511,87110709,1052688,50528259,1147167780,1298230317,3334652934,1148220468,3318862869,2226172980,3403868202,151062537,1181905974,152115225,3472030782,1077952512,34738194,3235962912,2377235517,83952645,3404920890,16842753,3237015600,170010666,1314020382,2309072937,1179800598,1128480771,2239857669,68162580,2306967561,2341705755,2159063088,3319915557,1212172296,1232173113,2274595863,3438345276,236067870,2189590530,18948129,2357234700,185800731,1330863135,1198748727,1146115092,2192748594,219225117,86058021,1329810447,0,1178747910,3454135341,1213224984,1112690706,3420710955,1316125758,3402815514,3384920073,3455188029,3158064,2240910357,1164010533,204487740,2259858486,3303072804,2343811131,1282440252,235015182,1079005200,154220601,102900774,36843570,2223014916,1231120425,2207485971,120796215,3353601063,69215268,2225120292,3418605579,1129533459,167905290,2273543175,3385972761,1279282188,2206433283,2407762959,3468872718,187906107,1245857802,2276701239],y=[2654435769,1013904243,2027808486,4055616972,3816266649,3337566003,2380164711,465362127,930724254,1861448508,3722897016,3150826737,2006686179,4013372358,3731777421,3168587547],T=1):dreamsecurity.chkIntegrity(arguments.callee,"seed")}var i,s="seed";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(p){var T,I,f,y,h,g,A,b,N,B;function e(e,t){p.cipher.registerAlgorithm(e,function(){return new p.aria.Algorithm(e,t)})}function c(e){return 65793*(e>>>24&255)^16777473*(e>>>16&255)^16842753*(e>>>8&255)^16843008*(255&e)}function k(e){return e<<8&4278255360^e>>>8&16711935}function R(e){return e<<16&4294901760^e>>>16&65535}function w(e){return(255&e)<<24^(65280&e)<<8^(16711680&e)>>>8^(4278190080&e)>>>24}function D(e,t,r,a,n){var i=4-Math.floor(r/32),s=r%32,o=32-s;a[n]=e[0]^t[i%4]>>>s^t[(3+i)%4]<<o,a[n+1]=e[1]^t[(1+i)%4]>>>s^t[i%4]<<o,a[n+2]=e[2]^t[(2+i)%4]>>>s^t[(1+i)%4]<<o,a[n+3]=e[3]^t[(3+i)%4]>>>s^t[(2+i)%4]<<o}function U(e,t,r,a){var n=c(e[t]),i=c(e[t+1]),s=c(e[t+2]),o=c(e[t+3]);i^=s,s^=o,o^=i,i=k(i^=s^=n^=i),i^=s=R(s),s^=o=w(o),o^=i,i^=s^=n^=i,r[a]=n,r[a+1]=i,r[a+2]=s,r[a+3]=o}function o(e,t){var r=e.slice(0),a=32*e.length;T=8+e.length;var n,i,s,o,c,u,d,l,p,f=new Array(4*T),y=0,h=new Array(4),g=new Array(4),m=new Array(4),C=new Array(4);if(h[0]=r[0],h[1]=r[1],h[2]=r[2],h[3]=r[3],c=(a-128)/64,n=h[0]^I[c][0],i=h[1]^I[c][1],s=h[2]^I[c][2],o=h[3]^I[c][3],n=A[n>>>24&255]^b[n>>>16&255]^N[n>>>8&255]^B[255&n],i=A[i>>>24&255]^b[i>>>16&255]^N[i>>>8&255]^B[255&i],i^=s=A[s>>>24&255]^b[s>>>16&255]^N[s>>>8&255]^B[255&s],s^=o=A[o>>>24&255]^b[o>>>16&255]^N[o>>>8&255]^B[255&o],o^=i,i=k(i^=s^=n^=i),i^=s=R(s),s^=o=w(o),o^=i,i^=s^=n^=i,128<a?(g[0]=r[4],g[1]=r[5],192<a?(g[2]=r[6],g[3]=r[7]):g[2]=g[3]=0):g[0]=g[1]=g[2]=g[3]=0,g[0]^=n,g[1]^=i,g[2]^=s,g[3]^=o,n=g[0],i=g[1],s=g[2],o=g[3],n^=I[c=2==c?0:c+1][0],i^=I[c][1],s^=I[c][2],o^=I[c][3],n=N[n>>>24&255]^B[n>>>16&255]^A[n>>>8&255]^b[255&n],i=N[i>>>24&255]^B[i>>>16&255]^A[i>>>8&255]^b[255&i],i^=s=N[s>>>24&255]^B[s>>>16&255]^A[s>>>8&255]^b[255&s],s^=o=N[o>>>24&255]^B[o>>>16&255]^A[o>>>8&255]^b[255&o],s^=n^=i,o=k(o^=i),n=R(n),i=w(i^=s),i^=s,s^=o,o^=i,i^=s^=n^=i,n^=h[0],i^=h[1],s^=h[2],o^=h[3],m[0]=n,m[1]=i,m[2]=s,m[3]=o,n^=I[c=2==c?0:c+1][0],i^=I[c][1],s^=I[c][2],o^=I[c][3],n=A[n>>>24&255]^b[n>>>16&255]^N[n>>>8&255]^B[255&n],i=A[i>>>24&255]^b[i>>>16&255]^N[i>>>8&255]^B[255&i],i^=s=A[s>>>24&255]^b[s>>>16&255]^N[s>>>8&255]^B[255&s],s^=o=A[o>>>24&255]^b[o>>>16&255]^N[o>>>8&255]^B[255&o],o^=i,i=k(i^=s^=n^=i),i^=s=R(s),s^=o=w(o),o^=i,i^=s^=n^=i,C[0]=n^g[0],C[1]=i^g[1],C[2]=s^g[2],C[3]=o^g[3],D(h,g,19,f,y),D(g,m,19,f,y+=4),D(m,C,19,f,y+=4),D(C,h,19,f,y+=4),D(h,g,31,f,y+=4),D(g,m,31,f,y+=4),D(m,C,31,f,y+=4),D(C,h,31,f,y+=4),D(h,g,67,f,y+=4),D(g,m,67,f,y+=4),D(m,C,67,f,y+=4),D(C,h,67,f,y+=4),D(h,g,97,f,y+=4),y+=4,128<a&&(D(g,m,97,f,y),D(m,C,97,f,y+=4),y+=4),192<a&&(D(C,h,97,f,y),D(h,g,109,f,y+=4)),t){var E=0,v=new Array(4),S=32+a/8;for(function(e,t,r){for(var a,n=0;n<4;n++)a=e[t+n],e[t+n]=e[r+n],e[r+n]=a}(f,0,S),E+=4,S-=4;E<S;E+=4,S-=4)l=S,U(u=f,d=E,p=v,0),U(u,l,u,d),u[l]=p[0],u[l+1]=p[1],u[l+2]=p[2],u[l+3]=p[3];U(f,E,v,0),f[E]=v[0],f[E+1]=v[1],f[E+2]=v[2],f[E+3]=v[3]}return r=f}function a(e,t,r,a){for(var n=0,i=new Array(16),s=e.slice(0),o=t[0],c=t[1],u=t[2],d=t[3],l=1;l<T/2;l++)o^=s[n++],c^=s[n++],u^=s[n++],d^=s[n++],o=A[o>>>24&255]^b[o>>>16&255]^N[o>>>8&255]^B[255&o],c=A[c>>>24&255]^b[c>>>16&255]^N[c>>>8&255]^B[255&c],c^=u=A[u>>>24&255]^b[u>>>16&255]^N[u>>>8&255]^B[255&u],u^=d=A[d>>>24&255]^b[d>>>16&255]^N[d>>>8&255]^B[255&d],d^=c,c=k(c^=u^=o^=c),c^=u=R(u),u^=d=w(d),d^=c,c^=u^=o^=c,o^=s[n++],c^=s[n++],u^=s[n++],d^=s[n++],o=N[o>>>24&255]^B[o>>>16&255]^A[o>>>8&255]^b[255&o],c=N[c>>>24&255]^B[c>>>16&255]^A[c>>>8&255]^b[255&c],c^=u=N[u>>>24&255]^B[u>>>16&255]^A[u>>>8&255]^b[255&u],u^=d=N[d>>>24&255]^B[d>>>16&255]^A[d>>>8&255]^b[255&d],u^=o^=c,d=k(d^=c),o=R(o),c=w(c^=u),c^=u,u^=d,d^=c,c^=u^=o^=c;o^=s[n++],c^=s[n++],u^=s[n++],d^=s[n++],o=A[o>>>24&255]^b[o>>>16&255]^N[o>>>8&255]^B[255&o],c=A[c>>>24&255]^b[c>>>16&255]^N[c>>>8&255]^B[255&c],c^=u=A[u>>>24&255]^b[u>>>16&255]^N[u>>>8&255]^B[255&u],u^=d=A[d>>>24&255]^b[d>>>16&255]^N[d>>>8&255]^B[255&d],d^=c,c=k(c^=u^=o^=c),c^=u=R(u),u^=d=w(d),d^=c,c^=u^=o^=c,o^=s[n++],c^=s[n++],u^=s[n++],d^=s[n++],(i=p.util.createBuffer()).putByte(255&(h[255&o>>>24]^s[n]>>>24)),i.putByte(255&(g[255&o>>>16]^s[n]>>>16)),i.putByte(255&(f[255&o>>>8]^s[n]>>>8)),i.putByte(255&(y[255&o]^s[n])),i.putByte(255&(h[255&c>>>24]^s[n+1]>>>24)),i.putByte(255&(g[255&c>>>16]^s[n+1]>>>16)),i.putByte(255&(f[255&c>>>8]^s[n+1]>>>8)),i.putByte(255&(y[255&c]^s[n+1])),i.putByte(255&(h[255&u>>>24]^s[n+2]>>>24)),i.putByte(255&(g[255&u>>>16]^s[n+2]>>>16)),i.putByte(255&(f[255&u>>>8]^s[n+2]>>>8)),i.putByte(255&(y[255&u]^s[n+2])),i.putByte(255&(h[255&d>>>24]^s[n+3]>>>24)),i.putByte(255&(g[255&d>>>16]^s[n+3]>>>16)),i.putByte(255&(f[255&d>>>8]^s[n+3]>>>8)),i.putByte(255&(y[255&d]^s[n+3])),r[0]=i.getInt32(),r[1]=i.getInt32(),r[2]=i.getInt32(),r[3]=i.getInt32()}function i(e){var t="ARIA-"+((e=e||{}).mode||"CBC").toUpperCase(),a=e.decrypt?p.cipher.createDecipher(t,e.key):p.cipher.createCipher(t,e.key),n=a.start;return a.start=function(e,t){var r=null;t instanceof p.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,n.call(a,t)},a}null!=p||"function"!=typeof dreamsecurity.chkIntegrity?(p.aria=p.aria||{},p.aria.startEncrypting=function(e,t,r,a){var n=i({key:e,output:r,decrypt:!1,mode:a});return n.start(t),n},p.aria.createEncryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!1,mode:t})},p.aria.startDecrypting=function(e,t,r,a){var n=i({key:e,output:r,decrypt:!0,mode:a});return n.start(t),n},p.aria.createDecryptionCipher=function(e,t){return i({key:e,output:null,decrypt:!0,mode:t})},p.aria.Algorithm=function(e,t){n();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(r._w,e,t)},decrypt:function(e,t){return a(r._w,e,t)}}}),r._init=!1},p.aria.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"==typeof r){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aria algorithm.");r=p.util.createBuffer(r)}else if(p.util.isArray(r)){if(16!==r.length&&24!==r.length&&32!==r.length)throw new Error("The "+r.length+" bytes key length is not valid for aria algorithm.");t=r,r=p.util.createBuffer();for(var a=0;a<t.length;++a)r.putByte(t[a])}if(!p.util.isArray(r)){t=r,r=[];var n=t.length();if(16===n||24===n||32===n){n>>>=2;for(a=0;a<n;++a)r.push(t.getInt32())}}if(!p.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var i=this.mode.name,s=-1!==p.util.arrayIndexOf(["CFB","OFB","CTR","GCM"],i);this._w=o(r,e.decrypt&&!s),this._init=!0}},p.aria._expandKey=o,p.aria._updateBlock=a,e("ARIA-ECB",p.cipher.modes.ecb),e("ARIA-CBC",p.cipher.modes.cbc),I=[[1367130551,656542356,4262702056,4204424928],[1840335564,2653014048,4280857045,4015907504],[3683792669,556198256,52729717,82364686]],f=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],y=[226,78,84,252,148,194,74,204,98,13,106,70,60,77,139,209,94,250,100,203,180,151,190,43,188,119,46,3,211,25,89,193,29,6,65,107,85,240,153,105,234,156,24,174,99,223,231,187,0,115,102,251,150,76,133,228,58,9,69,170,15,238,16,235,45,127,244,41,172,207,173,145,141,120,200,149,249,47,206,205,8,122,136,56,92,131,42,40,71,219,184,199,147,164,18,83,255,135,14,49,54,33,88,72,1,142,55,116,50,202,233,177,183,171,12,215,196,86,66,38,7,152,96,217,182,185,17,64,236,32,140,189,160,201,132,4,73,35,241,79,80,31,19,220,216,192,158,87,227,195,123,101,59,2,143,62,232,37,146,229,21,221,253,23,169,191,212,154,126,197,57,103,254,118,157,67,167,225,208,245,104,242,27,52,112,5,163,138,213,121,134,168,48,198,81,75,30,166,39,246,53,210,110,36,22,130,95,218,230,117,162,239,44,178,28,159,93,111,128,10,114,68,155,108,144,11,91,51,125,90,82,243,97,161,247,176,214,63,124,109,237,20,224,165,61,34,179,248,137,222,113,26,175,186,181,129],h=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],g=[48,104,153,27,135,185,33,120,80,57,219,225,114,9,98,60,62,126,94,142,241,160,204,163,42,29,251,182,214,32,196,141,129,101,245,137,203,157,119,198,87,67,86,23,212,64,26,77,192,99,108,227,183,200,100,106,83,170,56,152,12,244,155,237,127,34,118,175,221,58,11,88,103,136,6,195,53,13,1,139,140,194,230,95,2,36,117,147,102,30,229,226,84,216,16,206,122,232,8,44,18,151,50,171,180,39,10,35,223,239,202,217,184,250,220,49,107,209,173,25,73,189,81,150,238,228,168,65,218,255,205,85,134,54,190,97,82,248,187,14,130,72,105,154,224,71,158,92,4,75,52,21,121,38,167,222,41,174,146,215,132,233,210,186,93,243,197,176,191,164,59,113,68,70,43,252,235,111,213,246,20,254,124,112,90,125,253,47,24,131,22,165,145,31,5,149,116,169,193,91,74,133,109,19,7,79,78,69,178,15,201,28,166,188,236,115,144,123,207,89,143,161,249,45,242,177,0,148,55,159,208,46,156,110,40,63,128,240,61,211,37,138,181,231,66,179,199,234,247,76,17,51,3,162,172,96],A=[6513507,8158332,7829367,8092539,15921906,7039851,7303023,12961221,3158064,65793,6776679,2829099,16711422,14145495,11250603,7763574,13290186,8553090,13224393,8224125,16448250,5855577,4671303,15790320,11382189,13948116,10658466,11513775,10263708,10790052,7500402,12632256,12040119,16645629,9671571,2500134,3552822,4144959,16250871,13421772,3421236,10855845,15066597,15856113,7434609,14211288,3223857,1381653,263172,13092807,2302755,12829635,1579032,9868950,328965,10132122,460551,1184274,8421504,14869218,15461355,2565927,11711154,7697781,592137,8618883,2894892,1710618,1776411,7237230,5921370,10526880,5395026,3881787,14079702,11776947,2697513,14935011,3092271,8684676,5460819,13750737,0,15592941,2105376,16579836,11645361,5987163,6974058,13355979,12500670,3750201,4868682,5000268,5789784,13619151,13684944,15724527,11184810,16514043,4408131,5066061,3355443,8750469,4539717,16382457,131586,8355711,5263440,3947580,10461087,11053224,5329233,10724259,4210752,9408399,9605778,10329501,3684408,16119285,12369084,11974326,14342874,2171169,1052688,16777215,15987699,13816530,13487565,789516,1250067,15527148,6250335,9934743,4473924,1513239,12895428,10987431,8289918,4013373,6579300,6118749,1644825,7566195,6316128,8487297,5197647,14474460,2236962,2763306,9474192,8947848,4605510,15658734,12105912,1315860,14606046,6184542,723723,14408667,14737632,3289650,3815994,657930,4802889,394758,2368548,6052956,12763842,13882323,11316396,6447714,9539985,9803157,15000804,7960953,15198183,13158600,3618615,7171437,9276813,14013909,5131854,11119017,7105644,5658198,16053492,15395562,6645093,8026746,11447982,526344,12237498,7895160,2434341,3026478,1842204,10921638,11842740,13027014,15263976,14540253,7631988,2039583,4934475,12434877,9145227,9079434,7368816,4079166,11908533,6710886,4737096,197379,16185078,921102,6381921,3487029,5723991,12171705,8816262,12698049,1907997,10395294,14803425,16316664,10000536,1118481,6908265,14277081,9342606,9737364,10197915,1973790,8882055,15329769,13553358,5592405,2631720,14671839,9211020,10592673,9013641,855309,12566463,15132390,4342338,6842472,4276545,10066329,2960685,986895,11579568,5526612,12303291,1447446],b=[3791708898,1308642894,1409307732,4227923196,2483066004,3254829762,1241533002,3422604492,1644192354,218107149,1778412138,1174423110,1006648380,1291865421,2332068747,3506491857,1577082462,4194368250,1677747300,3405827019,3019945140,2533398423,3187719870,721431339,3154164924,1996519287,771763758,50332419,3540046803,419436825,1493195097,3238052289,486546717,100664838,1090535745,1795189611,1426085205,4026593520,2566953369,1761634665,3925928682,2617285788,402659352,2919280302,1660969827,3741376479,3875596263,3137387451,0,1929409395,1711302246,4211145723,2516620950,1275087948,2231403909,3825263844,973093434,150997257,1157645637,2852170410,251662095,3993038574,268439568,3942706155,754986285,2130739071,4093703412,687876393,2885725356,3472936911,2902502829,2432733585,2365623693,2013296760,3355494600,2499843477,4177590777,788541231,3456159438,3439381965,134219784,2046851706,2281736328,939538488,1543527516,2197848963,704653866,671098920,1191200583,3674266587,3087055032,3338717127,2466288531,2751505572,301994514,1392530259,4278255615,2264958855,234884622,822096177,905983542,553656609,1476417624,1207978056,16777473,2382401166,922761015,1946186868,838873650,3389049546,3909151209,2969612721,3070277559,2868947883,201329676,3607156695,3288384708,1442862678,1107313218,637543974,117442311,2550175896,1610637408,3640711641,3053500086,3103832505,285217041,1073758272,3959483628,536879136,2348846220,3170942397,2684395680,3372272073,2214626436,67109892,1224755529,587211555,4043370993,1325420367,1342197840,520101663,318771987,3691044060,3623934168,3221274816,2650840734,1459640151,3808486371,3271607235,2063629179,1694524773,989870907,33554946,2399178639,1040203326,3892373736,620766501,2449511058,3842041317,352326933,3707821533,4244700669,385881879,2835392937,3204497343,3556824276,2583730842,2113961598,3305162181,956315961,1728079719,4261478142,1979741814,2634063261,1124090691,2801837991,3774931425,3489714384,4110480885,1744857192,4060148466,452991771,872428596,1879076976,83887365,2734728099,2315291274,3573601749,2030074233,2248181382,2818615464,805318704,3321939654,1358975313,1258310475,503324190,2785060518,654321447,4127258358,889206069,3523269330,1845522030,603989028,369104406,2181071490,1593859935,3657489114,3858818790,1962964341,2717950626,4009816047,738208812,2986390194,469769244,2667618207,1560304989,1862299503,2147516544,167774730,1912631922,1140868164,2600508315,1811967084,2415956112,184552203,1526750043,855651123,2097184125,1509972570,1375752786,4076925939,1627414881,2701173153,4144035831,2952835248,3590379222,1056980799,2080406652,1828744557,3976261101,335549460,3758153952,2768283045,1023425853,570434082,3003167667,4160813304,2298513801,3724599006,1895854449,436214298,2936057775,3120609978,3036722613,2164294017],N=[1381105746,151584777,1785331818,3587506389,808452144,909508662,2779054245,943194168,3216965823,1077936192,2745368739,2661154974,2172715137,4092788979,3621191895,4227531003,2088501372,3823304931,960036921,2189557890,2610626715,791609391,4294902015,2273771655,875823156,2391670926,1128464451,1145307204,3301179588,3739091166,3924361449,3419078859,1414791252,2071658619,2492727444,842137650,2795896998,3267494082,589496355,1027407933,4008575214,1280049228,2509570197,185270283,1111621698,4210688250,3284336835,1313734734,134742024,774766638,2711683233,1717960806,673710120,3654877401,606339108,2998010034,1987444854,1532690523,2728525986,1229520969,1835860077,2341142667,3520135377,623181861,1920073842,4177002744,4143317238,1684275300,2256928902,1751646312,2560098456,370540566,3570663636,2762211492,1549533276,3435921612,1566376029,1701118053,3065381046,2459041938,1819017324,1886388336,1212678216,1347420240,4261216509,3991732461,3115909305,3671720154,1583218782,353697813,1178992710,1465319511,2812739751,2374828173,2644312221,2223243396,2425356432,3638034648,2880110763,0,2357985420,3166437564,3553820883,168427530,4160159991,3840147684,1482162264,84213765,3099066552,3014852787,1162149957,101056518,3503292624,741081132,505282590,2408513679,3402236106,1061093439,252641295,33685506,3250651329,2947481775,3183280317,50528259,16842753,320012307,2324299914,1802174571,976879674,2442199185,286326801,1094778945,1330577487,1734803559,3705405660,3941204202,2543255703,4075946226,3486449871,3469607118,4042260720,3031695540,3873833190,1936916595,2526412950,2896953516,1953759348,572653602,3890675943,2913796269,892665909,2240086149,3806462178,4193845497,926351415,3907518696,471597084,1970602101,3755933919,1852702830,1195835463,4059103473,437911578,1903231089,488439837,690552873,3318022341,2307457161,1869545583,3082223799,1650589794,235798542,2863268010,404226072,3200123070,454754331,4244373756,1448476758,1044250686,1263206475,3334865094,3536978130,2037973113,538968096,2593783962,3688562907,3233808576,4278059262,2021130360,3452764365,1515847770,4109631732,522125343,3722248413,2829582504,858980403,2290614408,117899271,3351707847,825294897,2981167281,303169554,269484048,1499005017,656867367,2155872384,3974889708,1600061535,1616904288,1364262993,2139029631,2846425257,421068825,3048538293,1246363722,218955789,757923885,3856990437,2054815866,2677997727,2475884691,3385393353,2627469468,4025417967,2694840480,3772776672,993722427,1296891981,2930639022,707395626,4126474485,2964324528,3368550600,3958046955,3149594811,1010565180,2206400643,1397948499,2576941209,1633747041,387383319,724238379,67371012,2122186878,3132752058,2004287607,3604349142,640024614,3789619425,1768489065,336855060,1667432547,1431634005,555810849,202113036,2105344125],B=[808464384,1751672832,2576980224,454761216,2273806080,3115956480,555819264,2021160960,1347440640,960051456,3688618752,3789676800,1920102912,151587072,1650614784,1010580480,1044266496,2122219008,1583242752,2391707136,4059164928,2694881280,3435973632,2745410304,707406336,488447232,4227595008,3065427456,3604403712,538976256,3301229568,2374864128,2172748032,1701143808,4126536960,2307492096,3419130624,2644352256,2004317952,3334915584,1465341696,1128481536,1448498688,387389184,3570717696,1077952512,437918208,1296911616,3233857536,1667457792,1819044864,3823362816,3082270464,3368601600,1684300800,1785358848,1397969664,2863311360,943208448,2560137216,202116096,4109693952,2610666240,3991792896,2139062016,572662272,1987474944,2947526400,3722304768,976894464,185273088,1482184704,1734829824,2290649088,101058048,3284386560,892679424,218959104,16843008,2341178112,2358021120,3267543552,3873891840,1600085760,33686016,606348288,1970631936,2475922176,1717986816,505290240,3857048832,3806519808,1414812672,3638089728,269488128,3469659648,2054846976,3907577856,134744064,741092352,303174144,2543294208,842150400,2880154368,3031741440,656877312,168430080,589505280,3755990784,4025478912,3402287616,3654932736,3099113472,4210752e3,3705461760,825307392,1802201856,3520188672,2913840384,421075200,1229539584,3183328512,1364283648,2526451200,4008635904,3840205824,2829625344,1094795520,3671775744,4294967040,3452816640,1431655680,2256963072,909522432,3200171520,1633771776,1381126656,4177065984,3149642496,235802112,2189591040,1212696576,1768515840,2593823232,3772833792,1195853568,2661195264,1549556736,67372032,1263225600,875836416,353703168,2038003968,640034304,2812782336,3739147776,690563328,2930683392,2459079168,3621246720,2223277056,3924420864,3537031680,3132799488,1566399744,4092850944,3318072576,2964369408,3217014528,2762253312,993737472,1903259904,1145324544,1179010560,724249344,4244438016,3958106880,1869573888,3587560704,4143379968,336860160,4278124032,2088532992,1886416896,1515870720,2105376e3,4261281024,791621376,404232192,2206434048,370546176,2779096320,2442236160,522133248,84215040,2509608192,1953788928,2846468352,3250700544,1532713728,1246382592,2240120064,1835887872,320017152,117901056,1330597632,1313754624,1162167552,2998055424,252645120,3385444608,471604224,2795939328,3166485504,3974949888,1936945920,2425393152,2071689984,3486502656,1499027712,2408550144,2711724288,4193908992,757935360,4076007936,2981212416,0,2492765184,926365440,2678038272,3503345664,774778368,2627509248,1852730880,673720320,1061109504,2155905024,4042321920,1027423488,3553874688,623191296,2324335104,3048584448,3890734848,1111638528,3014898432,3351758592,3941263872,4160222976,1280068608,286331136,858993408,50529024,2728567296,2896997376,1616928768]):dreamsecurity.chkIntegrity(arguments.callee,"aria")}var i,s="aria";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(i){var h,g,m,C,E,v,S,T;function e(e,t){i.cipher.registerAlgorithm(e,function(){return new i.des.Algorithm(e,t)})}function a(e,t,r,a){var n=32===e.length?3:9,i=3==n?a?[30,-2,-2]:[0,32,2]:a?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2],s=t[0];s^=(f=252645135&(s>>>4^(y=t[1])))<<4,s^=(f=65535&(s>>>16^(y^=f)))<<16,s^=f=858993459&((y^=f)>>>2^s),s^=f=16711935&((y^=f<<2)>>>8^s),s=(s^=(f=1431655765&(s>>>1^(y^=f<<8)))<<1)<<1|s>>>31,y=(y^=f)<<1|y>>>31;for(var o=0;o<n;o+=3){for(var c=i[o+1],u=i[o+2],d=i[o];d!=c;d+=u)var l=y^e[d],p=(y>>>4|y<<28)^e[d+1],f=s,s=y,y=f^(g[l>>>24&63]|C[l>>>16&63]|v[l>>>8&63]|T[63&l]|h[p>>>24&63]|m[p>>>16&63]|E[p>>>8&63]|S[63&p]);f=s,s=y,y=f}y=y>>>1|y<<31,y^=f=1431655765&((s=s>>>1|s<<31)>>>1^y),y^=(f=16711935&(y>>>8^(s^=f<<1)))<<8,y^=(f=858993459&(y>>>2^(s^=f)))<<2,y^=f=65535&((s^=f)>>>16^y),y^=f=252645135&((s^=f<<16)>>>4^y),s^=f<<4,r[0]=s,r[1]=y}function s(e){var a,t=((e=e||{}).mode||"CBC").toUpperCase(),r=24==e.key.length?"3DES-":"DES-";r+=t;var n=(a=e.decrypt?i.cipher.createDecipher(r,e.key):i.cipher.createCipher(r,e.key)).start;return a.start=function(e,t){var r=null;t instanceof i.util.ByteBuffer&&(r=t,t={}),(t=t||{}).output=r,t.iv=e,n.call(a,t)},a}null!=i||"function"!=typeof dreamsecurity.chkIntegrity?(i.des=i.des||{},i.des.startEncrypting=function(e,t,r,a){var n=s({key:e,output:r,decrypt:!1,mode:a||(null===t?"ECB":"CBC")});return n.start(t),n},i.des.createEncryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!1,mode:t})},i.des.startDecrypting=function(e,t,r,a){var n=s({key:e,output:r,decrypt:!0,mode:a||(null===t?"ECB":"CBC")});return n.start(t),n},i.des.createDecryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!0,mode:t})},i.des.Algorithm=function(e,t){n();var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return a(r._keys,e,t,!1)},decrypt:function(e,t){return a(r._keys,e,t,!0)}}}),r._init=!1},i.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=i.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],a=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],u=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],d=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],p=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],y=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],h=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=8<e.length()?3:1,m=[],C=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],E=0,v=0;v<g;v++){var S=e.getInt32(),T=e.getInt32();S^=(t=252645135&(S>>>4^T))<<4,S^=t=65535&((T^=t)>>>-16^S),S^=(t=858993459&(S>>>2^(T^=t<<-16)))<<2,S^=t=65535&((T^=t)>>>-16^S),S^=(t=1431655765&(S>>>1^(T^=t<<-16)))<<1,S^=t=16711935&((T^=t)>>>8^S),t=(S^=(t=1431655765&(S>>>1^(T^=t<<8)))<<1)<<8|(T^=t)>>>20&240,S=T<<24|T<<8&16711680|T>>>8&65280|T>>>24&240,T=t;for(var I=0;I<C.length;++I){T=C[I]?(S=S<<2|S>>>26,T<<2|T>>>26):(S=S<<1|S>>>27,T<<1|T>>>27);var A=r[(S&=-15)>>>28]|a[S>>>24&15]|n[S>>>20&15]|i[S>>>16&15]|s[S>>>12&15]|o[S>>>8&15]|c[S>>>4&15],b=u[(T&=-15)>>>28]|d[T>>>24&15]|l[T>>>20&15]|p[T>>>16&15]|f[T>>>12&15]|y[T>>>8&15]|h[T>>>4&15];t=65535&(b>>>16^A),m[E++]=A^t,m[E++]=b^t<<16}}return m}(t),this._init=!0}},e("DES-ECB",i.cipher.modes.ecb),e("DES-CBC",i.cipher.modes.cbc),e("DES-CFB",i.cipher.modes.cfb),e("DES-OFB",i.cipher.modes.ofb),e("DES-CTR",i.cipher.modes.ctr),e("3DES-ECB",i.cipher.modes.ecb),e("3DES-CBC",i.cipher.modes.cbc),e("3DES-CFB",i.cipher.modes.cfb),e("3DES-OFB",i.cipher.modes.ofb),e("3DES-CTR",i.cipher.modes.ctr),h=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],g=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],m=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],C=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],E=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],v=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],S=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],T=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]):dreamsecurity.chkIntegrity(arguments.callee,"des")}var i;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./cipher","./cipherModes","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined.des)return e.des;e.defined.des=!0;for(var r=0;r<t.length;++r)t[r](e);return e.des}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function h(f){var c,y,r;null!=f||"function"!=typeof dreamsecurity.chkIntegrity?(c=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],y=[1,2,3,5],f.rc2=f.rc2||{},f.rc2.expandKey=function(e,t){"string"==typeof e&&(e=f.util.createBuffer(e)),t=t||128;for(var r=e,a=e.length(),n=t,i=Math.ceil(n/8),s=255>>(7&n),o=a;o<128;o++)r.putByte(c[r.at(o-1)+r.at(o-a)&255]);for(r.setAt(128-i,c[r.at(128-i)&s]),o=127-i;0<=o;o--)r.setAt(o,c[r.at(o+1)^r.at(o+i)]);return r},r=function(e,t,i){h();var r,a,s,o,c=!1,u=null,d=null,l=null,n=[];for(e=f.rc2.expandKey(e,t),s=0;s<64;s++)n.push(e.getInt16Le());a=i?(r=function(e){for(s=0;s<4;s++)e[s]+=n[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),e[s]=(t=e[s])<<(r=y[s])&65535|(65535&t)>>16-r,o++;var t,r},function(e){for(s=0;s<4;s++)e[s]+=n[63&e[(s+3)%4]]}):(r=function(e){for(s=3;0<=s;s--)e[s]=(65535&(t=e[s]))>>(r=y[s])|t<<16-r&65535,e[s]-=n[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),o--;var t,r},function(e){for(s=3;0<=s;s--)e[s]-=n[63&e[(s+3)%4]]});var p=null;return p={start:function(e,t){e&&"string"==typeof e&&(e=f.util.createBuffer(e)),c=!1,u=f.util.createBuffer(),d=t||new f.util.createBuffer,l=e,p.output=d},update:function(e){for(c||u.putBuffer(e);8<=u.length();)!function(e){var t=[];for(s=0;s<4;s++){var r=u.getInt16Le();null!==l&&(i?r^=l.getInt16Le():l.putInt16Le(r)),t.push(65535&r)}o=i?0:63;for(var a=0;a<e.length;a++)for(var n=0;n<e[a][0];n++)e[a][1](t);for(s=0;s<4;s++)null!==l&&(i?l.putInt16Le(t[s]):t[s]^=l.getInt16Le()),d.putInt16Le(t[s])}([[5,r],[1,a],[6,r],[1,a],[5,r]])},finish:function(e){var t,r,a,n=!0;return i&&(e?n=e(8,u,!i):(t=8===u.length()?8:8-u.length(),u.fillWithByte(t,t))),n&&(c=!0,p.update()),i||(n=0===u.length())&&(e?n=e(8,d,!i):(r=d.length())<(a=d.at(r-1))?n=!1:d.truncate(a)),n}}},f.rc2.startEncrypting=function(e,t,r){var a=f.rc2.createEncryptionCipher(e,128);return a.start(t,r),a},f.rc2.createEncryptionCipher=function(e,t){return r(e,t,!0)},f.rc2.startDecrypting=function(e,t,r){var a=f.rc2.createDecryptionCipher(e,128);return a.start(t,r),a},f.rc2.createDecryptionCipher=function(e,t){return r(e,t,!1)}):dreamsecurity.chkIntegrity(arguments.callee,"rc2")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),h(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(h);if((e=e||{}).defined=e.defined||{},e.defined.rc2)return e.rc2;e.defined.rc2=!0;for(var r=0;r<t.length;++r)t[r](e);return e.rc2}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function p(k){var R,u,d,w,e,l,s;null!=k||"function"!=typeof dreamsecurity.chkIntegrity?(k.chkIntegrity=function(e,t){var r=k.vi;r.na=new Date(1626939711585);var a=null;a=(a=e.toString()).replace(/ |\t|\r\n|;/gm,"");var n=dreamsecurity.util.bytesToHex(k.intg.create(a));try{!function(e,t,r){{if(!e.gf){if(!e.filter){if(!e.s)throw Error("2");var a=parseInt(e.s.substr(0,2),16),n=20*a+2+20;if(e.s.length!=n)throw Error("3");for(var i=2,s="",o=[],c=0;c<a;c++)o.push(e.s.substr(i,20)),i+=20;var s=e.s.substr(0,i),u=e.s.substr(i,20);i+=20;var d=dreamsecurity.util.bytesToHex(k.intg.create(s));if(u!=d.substr(0,20))throw Error("4");e.s="",e.filter=o;var l=function(e){var t,r={msg:"",result:!1};{if(void 0===e)return r.msg="input value is null.",r;var a=null,n=null;try{var i=k.util.decode64(e);if("0"==i[0]){var s=dreamsecurity.asn1.fromDer(i),o={};if(!R.validate(s,w,o,[]))return r.msg="Cannot read the license (1).",r;var c=R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,o.tbsLicense.value),u=R.toDer(c).getBytes(),d=(o.licVersion.charCodeAt(0),k.util.createBuffer(o.licSignatureValue));++d.read;var l=d.getBytes();t=64!==l.length?"00DB1BC49C5DE286E2A3564F8162AD722DD09FD06C6417955A1815BC10E608CF1009752F5A2502A82BC900429736BBD843108562B5675BA4C6CB2BFC5ABF84C1A8B6641F4FD22CF4B2BE5AD2E7E8F198CD2CA38ABDDF96940F775E32401ACCA88864D55018ABFBEEE9F22A03E4433FF96E67809E5BB89E5CF6070DF18301C13E25":"00A2FA2AA05648620471761E734E77FE85ADA1B91F7D6FAEADFE5D5D5256D8071E4027C757A77B6B53C5A489E322703EA0E2117C46A7C0CC61477B49504840BD59";var p,f,y,h,g=k.md.sha1.create();if(g.start(),g.update(u),!(m=k.pki.setRsaPublicKey(new dreamsecurity.jsbn.BigInteger(t,16),new dreamsecurity.jsbn.BigInteger("010001",16))).verify(g.digest().getBytes(),l,"RSASSA-PKCS1-V1_5"))return r.msg="Invalid licenses",r;if("GPKIAPI"!=o.licSoftwareName)return r.msg="Not GPKIAPI License.",r;n=null!=o.licValidity4GeneralizedTime&&null!=o.licValidity4GeneralizedTime&&""!=o.licValidity4GeneralizedTime?(a="T0",p=o.licValidity4GeneralizedTime,f=p.substr(0,4),y=p.substr(4,2),h=p.substr(6,2),new Date(f,y-1,h).toISOString().substring(0,10)):(a="R0",o.licDomain)}else{var m=k.pki.setRsaPublicKey(new k.jsbn.BigInteger("00c4665976b561cd82d1971e6512a4bddf65d82c035b81486f3b4756258dbd6d95a433db2d7d0daec20f3ddef14af5f504b52e72efc261e88bc5c867890acf52c5f9b96a2d2adc07091c3355415cb4141de608db0633adbb6b8019a03b8fdda447bc484e98b71dd2c1f570d4a3537ea87961c28436bac8393f5ffa11270a1adbea400f3b209a6b8b288d7069fa3623f9cd9c7b1fd8c52cc363587677f6ba82bc3a5d2fa44e78b605a57040e0317fd2f20c70775dcf61d2361832583a13fb6f778bf3271ab5aa605e84cbe5675fc55a49f5891ed17f4e3db1c920f9f46a87aa5cdb06f9cb8c39118c7f03d0466c0f8b60ccab62e35a0b8d947992c0dd1acd5bbebb",16),new k.jsbn.BigInteger("010001",16)),s=k.pki.rsa.decrypt(i,m,!0,!0);a=s.substr(0,2),n=s.substr(2,s.length-2)}if("R0"==a){for(var C=n.split(","),E=0;E<C.length;E++){var v=function(e){var t;t=-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0];return t=t.split(":")[0]}(location.href);if(C[E]==v)return r.result=!0,r;var S=v.split("."),T=C[E].split(".");if(S.length==T.length)for(var I=!0,A=0;A<S.length;A++)if("*"!==T[A]&&S[A]!=T[A]){I=!1;break}}return I?r.result=!0:r.msg="The license is not for this domain!",r}if("T0"!=a)return r.msg="Error(100100)",r;var b=n.substr(0,14),N=new Date(b),B=new Date;if(N<B)return r.msg="The license expired!",r}catch(e){return console.log("license error : "+e),r.msg="Error(110110).",r.result=!1,r}}return r.result=!0,r}(e.l);if(1!=l.result)throw e.filter=[],new Error(l.msg)}for(var p=r.substr(0,20),c=0;c<e.filter.length;c++)if(e.filter[c]==p)return;throw new Error("5")}if(new Date>k.vi.na)throw Error("1");e.list||(e.list={},e.tbi={}),e.list[t]=r}}(r,t,n)}catch(e){var i=new Error("It does not allow the use GPKIJS. ("+e.message+")");throw i.type=k.err.license,i}},R=k.asn1,u=k.pki=k.pki||{},d=u.oids,R.Class.UNIVERSAL,R.Type.SEQUENCE,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.SEQUENCE,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.SEQUENCE,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.UNIVERSAL,R.Type.BITSTRING,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.BITSTRING,R.Class.CONTEXT_SPECIFIC,R.Class.UNIVERSAL,R.Type.OCTETSTRING,w={name:"GPKILicense",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"GPKILicense.TBSLicense",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsLicense",value:[{name:"GPKILicense.TBSLicense.version",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"licVersion"},{name:"GPKILicense.TBSLicense.softwareName",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"licSoftwareName"},{name:"GPKILicense.TBSLicense.organization",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"licOrganization"},{name:"GPKILicense.TBSLicense.serialNumber",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,captureAsn1:"licSerialNumber"},{name:"GPKILicense.TBSLicense.ipInformation",tagClass:R.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"ipInformation"},{name:"GPKILicense.TBSLicense.hostIDInformation",tagClass:R.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"hostIDInformation"},{name:"GPKILicense.TBSLicense.macInformation",tagClass:R.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,capture:"macInformation"},{name:"GPKILicense.TBSLicense.validity_cs",tagClass:R.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,optional:!0,value:[{name:"GPKILicense.TBSLicense.validity",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"GPKILicense.TBSLicense.validity.notBefore (utc)",tagClass:R.Class.UNIVERSAL,type:R.Type.UTCTIME,constructed:!1,optional:!0,capture:"licValidity1UTCTime"},{name:"GPKILicense.TBSLicense.validity.notBefore (generalized)",tagClass:R.Class.UNIVERSAL,type:R.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"licValidity2GeneralizedTime"},{name:"GPKILicense.TBSLicense.validity.notAfter (utc)",tagClass:R.Class.UNIVERSAL,type:R.Type.UTCTIME,constructed:!1,optional:!0,capture:"licValidity3UTCTime"},{name:"GPKILicense.TBSLicense.validity.notAfter (generalized)",tagClass:R.Class.UNIVERSAL,type:R.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"licValidity4GeneralizedTime"}]}]},{name:"GPKILicense.TBSLicense.domain",tagClass:R.Class.CONTEXT_SPECIFIC,type:4,constructed:!0,optional:!0,value:[{name:"GPKILicense.TBSLicense.domain.domain",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"licDomain"}]}]},{name:"GPKILicense.signatureAlgorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"GPKILicense.signatureAlgorithm.algorithm",tagClass:R.Class.UNIVERSAL,type:R.Type.OID,constructed:!1,capture:"licSignatureOid"},{name:"GPKILicense.signatureAlgorithm.parameters",tagClass:R.Class.UNIVERSAL,optional:!0,captureAsn1:"licSignatureParams"}]},{name:"GPKILicense.signatureValue",tagClass:R.Class.UNIVERSAL,type:R.Type.BITSTRING,constructed:!1,capture:"licSignatureValue"}]},u.pemToDer=function(e){var t=k.pem.decode(e)[0];if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PEM to DER; PEM is encrypted.");return k.util.createBuffer(t.body)},e=k.pki.algIdValidator=function(e,t,r,a,n){return{name:e,tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:t,tagClass:R.Class.UNIVERSAL,type:R.Type.OID,constructed:!1,capture:r},{name:a,tagClass:R.Class.UNIVERSAL,optional:!0,captureAsn1:n}]}},l={name:"PrivateKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:R.Class.UNIVERSAL,type:R.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},e("PrivateKeyInfo.privateKeyAlgorithm","AlgorithmIdentifier.algorithm","privateKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"PrivateKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.OCTETSTRING,constructed:!1,capture:"privateKey"},{name:"PrivateKeyInfo.attributes",tagClass:R.Class.CONTEXT_SPECIFIC,type:0,capture:"priKeyAttributes",optional:!0}]},s=k.pki.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:R.Class.UNIVERSAL,type:R.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[e("SubjectPublicKeyInfo.AlgorithmIdentifier","AlgorithmIdentifier.algorithm","publicKeyOid","AlgorithmIdentifier.parameter","parameters"),{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:R.Class.UNIVERSAL,type:R.Type.BITSTRING,constructed:!1,capture:"publicKey"}]},u.privateKeyFromPem=function(e){var t=k.pem.decode(e)[0];if("PRIVATE KEY"!==t.type&&"RSA PRIVATE KEY"!==t.type&&"KCDSA PRIVATE KEY"!==t.type){var r=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY" or "KCDSA PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert private key from PEM; PEM is encrypted.");var a=R.fromDer(t.body,!0,!1);return u.privateKeyFromAsn1(a)},u.privateKeyFromAsn1=function(e){p();var t={},r=[];if(!R.validate(e,l,t,r))throw(a=new Error("Cannot read private key.")).errors=r,a;e=R.fromDer(k.util.createBuffer(t.privateKey));var a,n=R.derToOid(t.privateKeyOid),i=null;n===d.rsaEncryption?(i=u.rsa.privateKeyFromAsn1(e)).algName="rsa":n===d.kcdsa1?(i=u.kcdsa.privateKeyFromAsn1(e,t.parameters)).algName="kcdsa":(a=new Error("Not supported key.key oid="+n)).errors=r,i.randomNum=null;var s=t.priKeyAttributes;if(null!=s&&null!=s)for(var o=0;o<s.length;++o){var c=k.pkcs7.attrFromAsn1(s[o]);if(c.oid===d.randomNum){if("string"!=typeof c.values[0].value){i.randomNum="";for(o=0;o<c.values[0].value.length;++o)i.randomNum+=R.toDer(c.values[0].value[o]).getBytes()}else i.randomNum=c.values[0].value.slice(1,c.values[0].value.length);break}}return i},u.publicKeyFromAsn1=function(e){p();var t={},r=[];if(!R.validate(e,s,t,r))throw(a=new Error("Cannot read public key.")).errors=r,a;e=t.publicKey[0];var a,n=R.derToOid(t.publicKeyOid),i=null;return n===d.rsaEncryption?(i=u.rsa.publicKeyFromAsn1(e)).algName="rsa":n===d.kcdsa1?(i=u.kcdsa.publicKeyFromAsn1(e,t.parameters)).algName="kcdsa":(a=new Error("Not supported key.key oid="+n)).errors=r,i},u.priKeyToPriKeyInfo=function(e){p();var t=null,r=null,a=null;"rsa"==e.algName?(t=k.pki.privateKeyToRSAPrivateKey(e),a=u.oids.rsaEncryption,r=R.create(R.Class.UNIVERSAL,R.Type.NULL,!1,"")):"kcdsa"==e.algName?(t=k.pki.privateKeyToKCDSAPrivateKey(e),a=u.oids.kcdsa1,r=k.pki.toKCDSAParam(e)):new Error("Not supported key. ("+e.algName+")").errors=errors;var n,i=R.create(R.Class.UNIVERSAL,R.Type.INTEGER,!1,R.integerToDer(0).getBytes()),s=R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.OID,!1,R.oidToDer(a).getBytes()),r]),o=R.create(R.Class.UNIVERSAL,R.Type.OCTETSTRING,!1,R.toDer(t).getBytes());return null!=e.randomNum&&null!=e.randomNum?(n=R.create(R.Class.CONTEXT_SPECIFIC,0,!0,[R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.OID,!1,R.oidToDer(u.oids.randomNum).getBytes()),R.create(R.Class.UNIVERSAL,R.Type.SET,!0,[R.create(R.Class.UNIVERSAL,R.Type.BITSTRING,!1,String.fromCharCode(0)+e.randomNum)])])]),R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[i,s,o,n])):R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[i,s,o])},u.publicKeyToAsn1=u.publicKeyToSubjectPublicKeyInfo=function(e){p();var t=null,r=null,a=null;return"rsa"==e.algName?(t=k.pki.publicKeyToRSAPublicKey(e),a=u.oids.rsaEncryption,r=R.create(R.Class.UNIVERSAL,R.Type.NULL,!1,"")):"kcdsa"==e.algName?(t=k.pki.publicKeyToKCDSAPublicKey(e),a=u.oids.kcdsa1,r=k.pki.toKCDSAParam(e)):new Error("Not supported key. ("+e.algName+")").errors=errors,R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.SEQUENCE,!0,[R.create(R.Class.UNIVERSAL,R.Type.OID,!1,R.oidToDer(a).getBytes()),r]),R.create(R.Class.UNIVERSAL,R.Type.BITSTRING,!1,[t])])},u.privateKeyToPem=function(e,t){var r={type:"RSA PRIVATE KEY",body:R.toDer(u.privateKeyToAsn1(e)).getBytes()};return k.pem.encode(r,{maxline:t})},u.privateKeyInfoToPem=function(e,t){var r={type:"PRIVATE KEY",body:R.toDer(e).getBytes()};return k.pem.encode(r,{maxline:t})}):dreamsecurity.chkIntegrity(arguments.callee,"pki")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),p(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(p);if((e=e||{}).defined=e.defined||{},e.defined.pki)return e.pki;e.defined.pki=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pki}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function v(E){var e;null!=E||"function"!=typeof dreamsecurity.chkIntegrity?(e=E.pkcs5=E.pkcs5||{},E.pbkdf1=e.pbkdf1=function(e,t,r,a,n){v();var i=0;if(null==n&&(n=E.md.sha1.create()),a>n.digestLength)throw new Error("Derived key is too long.");n.start(),n.update(e),n.update(t);for(var s=n.digest(),i=1;i<r;i++)n.start(),n.update(s.getBytes()),s=n.digest();return s.getBytes(a)},E.pbkdf2=e.pbkdf2=function(e,t,r,a,n,i){v(),"function"==typeof n&&(i=n,n=null),null==n&&(n=E.md.sha1.create());var s=n.digestLength;if(4294967295*s<a){var o=new Error("Derived key is too long.");if(i)return i(o);throw o}var c=Math.ceil(a/s),u=a-(c-1)*s,d=E.hmac.create();d.start(n,e);var l,p,f,y="";if(!i){for(var h=1;h<=c;++h){d.start(null,null),d.update(t),d.update(E.util.int32ToBytes(h)),l=f=d.digest().getBytes();for(var g=2;g<=r;++g)d.start(null,null),d.update(f),p=d.digest().getBytes(),l=E.util.xorBytes(l,p,s),f=p;y+=h<c?l:l.substr(0,u)}return y}h=1;function m(){if(c<h)return i(null,y);d.start(null,null),d.update(t),d.update(E.util.int32ToBytes(h)),l=f=d.digest().getBytes(),g=2,C()}function C(){if(g<=r)return d.start(null,null),d.update(f),p=d.digest().getBytes(),l=E.util.xorBytes(l,p,s),f=p,++g,E.util.setImmediate(C);y+=h<c?l:l.substr(0,u),++h,m()}m()}):dreamsecurity.chkIntegrity(arguments.callee,"pbkdf2")}var n,i="pbkdf2";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),v(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./hmac","./md","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(v);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function d(R){var g,m,h,p,f,C;function o(e,t){return e.start().update(t).digest().getBytes()}null!=R||"function"!=typeof dreamsecurity.chkIntegrity?(R.jsbn.BigInteger,g=R.asn1,(m=R.pki=R.pki||{}).pbe=R.pbe=R.pbe||{},h=m.oids,p={name:"EncryptedPrivateKeyInfo",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:g.Class.UNIVERSAL,type:g.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},m.pbe.encryptedPrivateKeyValidator=p,f={name:"PBES2Algorithms",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:g.Class.UNIVERSAL,type:g.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:g.Class.UNIVERSAL,type:g.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},C={name:"pkcs-12PbeParams",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:g.Class.UNIVERSAL,type:g.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"iterations"}]},m.pbe.getEncPriKeyInfoForPBES2=function(e,t,r){var a,n,i,s,o,c=R.random.getBytesSync(r.saltSize),u=r.count,d=g.integerToDer(u);switch(r.algorithm){case"aes128":n=a=16,s=h["aes128-CBC"],o=R.aes.createEncryptionCipher;break;case"aes192":a=24,n=16,s=h["aes192-CBC"],o=R.aes.createEncryptionCipher;break;case"aes256":a=32,n=16,s=h["aes256-CBC"],o=R.aes.createEncryptionCipher;break;case"des":n=a=8,s=h.desCBC,o=R.des.createEncryptionCipher;break;case"seed":n=a=16,s=h.seedCBC,o=R.seed.createEncryptionCipher;break;case"aria":case"aria128":n=a=16,s=h.ariaCBC,o=R.aria.createEncryptionCipher;break;case"aria192":a=24,n=16,s=h["aria192-CBC"],o=R.aria.createEncryptionCipher;break;case"aria256":a=32,n=16,s=h["aria256-CBC"],o=R.aria.createEncryptionCipher;break;case"des-EDE3":case"3des":a=24,n=8,s=h["des-EDE3-CBC"],o=R.des.createEncryptionCipher;break;default:var l=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe2 encryption algorithm. : "+r.algorithm);throw l.type=R.err.unsupported,l.algorithm=r.algorithm,l}var p=R.pkcs5.pbkdf2(t,c,u,a),f=R.random.getBytesSync(n),y=o(p);return y.start(f),y.update(e),y.finish(),i=y.output.getBytes(),encryptionAlgorithm=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(h.pkcs5PBES2).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(h.pkcs5PBKDF2).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,c),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,d.getBytes())])]),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(s).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,f)])])]),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[encryptionAlgorithm,g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,i)])},m.pbe.getEncPriKeyInfoForPBES1=function(e,t,r){var a,n,i,s,o,c=R.random.getBytesSync(r.saltSize),u=r.count,d=g.integerToDer(u);if("seed"!==r.algorithm){var l=new Error("Cannot encrypt private key. Unsupported PKCS5 pbe encryption algorithm. : "+r.algorithm);throw l.type=R.err.unsupported,l.algorithm=r.algorithm,l}a=16,s=r.fixedIv?(n=0,m.oids.seedCBC):(n=16,m.oids.seedCBCWithSHA1),o=R.seed.createEncryptionCipher,md=R.md.sha1.create();var p="",f=null,y=null;y=a+n<=md.digestLength?(f=(p=R.pkcs5.pbkdf1(t,c,u,a+n,md)).substr(0,a),0<n?p.substr(a,n):"0123456789012345"):(f=(p=R.pkcs5.pbkdf1(t,c,u,md.digestLength,md)).substr(0,a),md.start(),md.update(p.substr(a,md.digestLength-n)),md.digest().getBytes(n));var h=o(f);return h.start(y),h.update(e),h.finish(),i=h.output.getBytes(),encryptionAlgorithm=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(s).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,c),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,d.getBytes())])]),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[encryptionAlgorithm,g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,i)])},_encryptForPKCS12PBE=function(e,t,r,a){if("3des"!==a.algorithm&&"des-EDE3"!==a.algorithm){var n=new Error("Cannot encrypt private key. Unsupported PKCS12 pbe algorithm. : "+a.algorithm);throw n.type=R.err.unsupported,n}var i=a.count,s=new R.util.ByteBuffer(r),o=m.pbe.generatePkcs12Key(t,s,1,i,24),c=m.pbe.generatePkcs12Key(t,s,2,i,8),u=R.des.createEncryptionCipher(o);return u.start(c),u.update(e),u.finish(),u.output.getBytes()},_pkcs12PbeAlgToASN1=function(e,t){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(h["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,e),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(t).getBytes())])])},m.pbe.getEncDataForPKCS12PBE=function(e,t,r){var a=R.random.getBytesSync(r.saltSize),n=_encryptForPKCS12PBE(e,t,a,r),i=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(m.oids.data).getBytes()),_pkcs12PbeAlgToASN1(a,r.count),g.create(g.Class.CONTEXT_SPECIFIC,0,!1,n)]);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(m.oids.encryptedData).getBytes()),g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(0).getBytes()),i])])])},m.pbe.getEncPriKeyInfoForPKCS12PBE=function(e,t,r){var a=R.random.getBytesSync(r.saltSize),n=_encryptForPKCS12PBE(e,t,a,r);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[_pkcs12PbeAlgToASN1(a,r.count),g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,n)])},m.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).version=r.version||20,r.saltSize=r.saltSize||8,r.count=r.count||20==r.version?2048:1024,r.algorithm=r.algorithm||"aes128";return void 0!==r.usePkcs12&&r.usePkcs12?m.pbe.getEncPriKeyInfoForPKCS12PBE(g.toDer(e),t,r):20==r.version?m.pbe.getEncPriKeyInfoForPBES2(g.toDer(e),t,r):m.pbe.getEncPriKeyInfoForPBES1(g.toDer(e),t,r)},m.encryptDataWithPBE=function(e,t,r){return r.saltSize=r.saltSize||8,r.count=r.count||20==r.version?2048:1024,r.algorithm=r.algorithm||"aes128",m.pbe.getEncDataForPKCS12PBE(g.toDer(e),t,r)},m.decryptPrivateKeyInfo=function(e,t,r){var a=null,n={},i=[];if(!g.validate(e,p,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s.type=R.err.decode,s}var o=null,c=!1,u=g.derToOid(n.encryptionOid);u==m.oids.pkcs5PBES2?o=20:(o=15,u==m.oids.seedCBC&&(c=!0));var d=m.pbe.getCipher(u,n.encryptionParams,t),l=R.util.createBuffer(n.encryptedData);if(d.update(l),d.finish())try{a=g.fromDer(d.output,!0,!1)}catch(e){throw e.type=R.err.wrongPasswd,e.message="Confirm password.",e}return null!=r&&1==r&&(a={privateKey:a,pbeAlg:"",pkcs5Version:o,fixedIv:c},"AES-CBC"==d.algorithm.name?a.pbeAlg="AES"+8*d.keySize+"-CBC":"ARIA-CBC"==d.algorithm.name?a.pbeAlg="ARIA"+8*d.keySize+"-CBC":a.pbeAlg=d.algorithm.name),a},m.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:g.toDer(e).getBytes()};return R.pem.encode(r,{maxline:t})},m.encryptedPrivateKeyFromPem=function(e){var t=R.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return g.fromDer(t.body)},m.encryptPrivateKey=function(e,t,r){if(d(),!(r=r||{}).legacy)return rval=m.encryptPrivateKeyInfo(e,t,r),g.toDer(rval);var a,n,i,s;switch(r.algorithm){case"aes128":a="AES-128-CBC",i=16,n=R.random.getBytesSync(16),s=R.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",i=24,n=R.random.getBytesSync(16),s=R.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",i=32,n=R.random.getBytesSync(16),s=R.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",i=24,n=R.random.getBytesSync(8),s=R.des.createEncryptionCipher;break;case"des":a="DES-CBC",i=8,n=R.random.getBytesSync(8),s=R.des.createEncryptionCipher;break;default:var o=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw o.algorithm=r.algorithm,o}var c=s(R.pbe.opensslDeriveBytes(t,n.substr(0,8),i));c.start(n),c.update(g.toDer(m.privateKeyToAsn1(e))),c.finish();var u={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:R.util.bytesToHex(n).toUpperCase()},body:c.output.getBytes()};return R.pem.encode(u)},m.decryptRsaPrivateKey=function(e,t){d();var r,a,n,i=null,s=R.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==s.type&&"PRIVATE KEY"!==s.type&&"RSA PRIVATE KEY"!==s.type)throw(n=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=n;if(s.procType&&"ENCRYPTED"===s.procType.type){switch(s.dekInfo.algorithm){case"DES-CBC":r=8,a=R.des.createDecryptionCipher;break;case"DES-EDE3-CBC":r=24,a=R.des.createDecryptionCipher;break;case"AES-128-CBC":r=16,a=R.aes.createDecryptionCipher;break;case"AES-192-CBC":r=24,a=R.aes.createDecryptionCipher;break;case"AES-256-CBC":r=32,a=R.aes.createDecryptionCipher;break;case"RC2-40-CBC":r=5,a=function(e){return R.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":r=8,a=function(e){return R.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":r=16,a=function(e){return R.rc2.createDecryptionCipher(e,128)};break;default:throw(n=new Error('Could not decrypt private key; unsupported encryption algorithm "'+s.dekInfo.algorithm+'".')).algorithm=s.dekInfo.algorithm,n}var o=R.util.hexToBytes(s.dekInfo.parameters),c=a(R.pbe.opensslDeriveBytes(t,o.substr(0,8),r));if(c.start(o),c.update(R.util.createBuffer(s.body)),!c.finish())return i;i=c.output.getBytes()}else i=s.body;return null!==(i="ENCRYPTED PRIVATE KEY"===s.type?m.decryptPrivateKeyInfo(g.fromDer(i),t):g.fromDer(i))&&(i=m.privateKeyFromAsn1(i)),i},m.pbe.generatePkcs12Key=function(e,t,r,a,n,i){null==i&&(i=R.md.sha1.create());var s=i.digestLength,o=i.blockLength,c=new R.util.ByteBuffer,u=new R.util.ByteBuffer;if(null!=e){if("string"!=typeof e)throw new Error("The password is not a string type.");for(k=0;k<e.length;k++)u.putInt16(e.charCodeAt(k));u.putInt16(0)}var d=u.length(),l=t.length(),p=new R.util.ByteBuffer;p.fillWithByte(r,o);var f=o*Math.ceil(l/o),y=new R.util.ByteBuffer;for(k=0;k<f;k++)y.putByte(t.at(k%l));var h=o*Math.ceil(d/o),g=new R.util.ByteBuffer;for(k=0;k<h;k++)g.putByte(u.at(k%d));var m=y;m.putBuffer(g);for(var C=Math.ceil(n/s),E=1;E<=C;E++){var v=new R.util.ByteBuffer;v.putBytes(p.bytes()),v.putBytes(m.bytes());for(var S=0;S<a;S++)i.start(),i.update(v.getBytes()),v=i.digest();var T=new R.util.ByteBuffer;for(k=0;k<o;k++)T.putByte(v.at(k%s));for(var I=Math.ceil(l/o)+Math.ceil(d/o),A=new R.util.ByteBuffer,b=0;b<I;b++){for(var N=new R.util.ByteBuffer(m.getBytes(o)),B=511,k=T.length()-1;0<=k;k--)B>>=8,B+=T.at(k)+N.at(k),N.setAt(k,255&B);A.putBuffer(N)}m=A,c.putBuffer(v)}return c.truncate(c.length()-n),c},m.pbe.getCipher=function(e,t,r){switch(e){case m.oids.pkcs5PBES2:return m.pbe.getDecCipherForPBES2(e,t,r);case m.oids.seedCBCWithSHA1:case m.oids.seedCBC:case m.oids.pbeWithSHA1AndARIA_CBC:return m.pbe.getDecCipherForPBES1(e,t,r);case m.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case m.oids["pbewithSHAAnd40BitRC2-CBC"]:return m.pbe.getDecCipherForPKCS12PBE(e,t,r);default:var a=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw a.oid=e,a.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","seedCBCWithSHA1","pbewithSHAAnd40BitRC2-CBC"],a}},m.pbe.getDecCipherForPBES2=function(e,t,r){var a,n={},i=[];if(!g.validate(t,f,n,i))throw(a=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,a;if((e=g.derToOid(n.kdfOid))!==m.oids.pkcs5PBKDF2)throw(a=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,a.supportedOids=["pkcs5PBKDF2"],a;e=g.derToOid(n.encOid);var s,o,c=n.kdfSalt,u=(u=R.util.createBuffer(n.kdfIterationCount)).getInt(u.length()<<3);switch(m.oids[e]){case"aes128-CBC":s=16,o=R.aes.createDecryptionCipher;break;case"aes192-CBC":s=24,o=R.aes.createDecryptionCipher;break;case"aes256-CBC":s=32,o=R.aes.createDecryptionCipher;break;case"des-EDE3-CBC":s=24,o=R.des.createDecryptionCipher;break;case"desCBC":s=8,o=R.des.createDecryptionCipher;break;case"seedCBC":s=16,o=R.seed.createDecryptionCipher;break;case"ariaCBC":case"aria128-CBC":s=16,o=R.aria.createDecryptionCipher;break;case"aria192-CBC":s=24,o=R.aria.createDecryptionCipher;break;case"aria256-CBC":s=32,o=R.aria.createDecryptionCipher;break;default:throw new Error("Cannot read encrypted private key. Unsupported encryption scheme OID. : "+e)}var d=R.pkcs5.pbkdf2(r,c,u,s),l=n.encIv,p=o(d);return p.start(l),p.keySize=s,p},m.pbe.getDecCipherForPBES1=function(e,t,r){var a={},n=[];if(!g.validate(t,C,a,n))throw(c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=n,c;var i,s,o,c,u=a.salt,d=(d=R.util.createBuffer(a.iterations)).getInt(d.length()<<3),l=null;switch(e){case m.oids.seedCBCWithSHA1:s=i=16,o=R.seed.startDecrypting,l=R.md.sha1.create();break;case m.oids.seedCBC:i=16,s=0,o=R.seed.startDecrypting,l=R.md.sha1.create();break;case m.oids.pbeWithSHA1AndARIA_CBC:s=i=16,o=R.aria.startDecrypting,l=R.md.sha1.create();break;default:throw(c=new Error("Cannot read PBES1 data block. Unsupported OID.")).oid=e,c}var p="",f=null,y=null;return y=i+s<=l.digestLength?(f=(p=R.pkcs5.pbkdf1(r,u,d,i+s,l)).substr(0,i),0<s?p.substr(i,s):"0123456789012345"):(f=(p=R.pkcs5.pbkdf1(r,u,d,l.digestLength,l)).substr(0,i),l.start(),l.update(p.substr(i,l.digestLength-i)),l.digest().getBytes(s)),o(f,y)},m.pbe.getDecCipherForPKCS12PBE=function(e,t,r){var a={},n=[];if(!g.validate(t,C,a,n))throw(c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=n,c;var i,s,o,c,u=R.util.createBuffer(a.salt),d=(d=R.util.createBuffer(a.iterations)).getInt(d.length()<<3);switch(e){case m.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:i=24,s=8,o=R.des.startDecrypting;break;case m.oids.seedCBCWithSHA1:case m.oids.pbeWithSHA1AndARIA_CBC:s=i=16,o=R.seed.startDecrypting;break;case m.oids["pbewithSHAAnd40BitRC2-CBC"]:i=5,s=8,o=function(e,t){var r=R.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:throw(c=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,c}return o(m.pbe.generatePkcs12Key(r,u,1,d,i),m.pbe.generatePkcs12Key(r,u,2,d,s))},m.pbe.opensslDeriveBytes=function(e,t,r,a){null==a&&(a=R.md.md5.create()),null===t&&(t="");for(var n=[o(a,e+t)],i=16,s=1;i<r;++s,i+=16)n.push(o(a,n[s-1]+e+t));return n.join("").substr(0,r)}):dreamsecurity.chkIntegrity(arguments.callee,"pbe")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),d(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(d);if((e=e||{}).defined=e.defined||{},e.defined.pbe)return e.pbe;e.defined.pbe=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pbe}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function A(S){var g,T,m,u,e,t,h,d,o,r,p;function C(e,t){"string"==typeof t&&(t={shortName:t});for(var r,a=null,n=0;null===a&&n<e.attributes.length;++n)r=e.attributes[n],(t.type&&t.type===r.type||t.name&&t.name===r.name||t.shortName&&t.shortName===r.shortName)&&(a=r);return a}function E(e){var t;e.altNames=[];for(var r=g.fromDer(e.value),a=0;a<r.value.length;++a){var n={type:(t=r.value[a]).type,value:t.value};e.altNames.push(n),T.processGeneralName(t,n)}}function v(e){for(var t=g.fromDer(e.value),r=0;r<t.value.length;++r)switch(t.value[r].type){case 0:e.keyIdentifier=t.value[r].value;break;case 1:e.authorityCertIssuer={};var a=S.md.sha1.create();e.authorityCertIssuer.attributes=S.pki.RDNAttributesAsArray(t.value[r].value[0].value[0],a);break;case 2:e.authorityCertSerialNumber=t.value[r].value}}function n(e){for(var t,r,a=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),n=e.attributes,i=0;i<n.length;++i){var s=(t=n[i]).value,o=g.Type.PRINTABLESTRING;"valueTagClass"in t&&(o=t.valueTagClass)===g.Type.UTF8&&(s=S.util.encodeUtf8(s)),r=g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(t.type).getBytes()),g.create(g.Class.UNIVERSAL,o,!1,s)])]),a.value.push(r)}return a}function I(e){for(var t,r,a=0;a<e.length;++a){if(void 0===(t=e[a]).name&&(t.type&&t.type in T.oids?t.name=T.oids[t.type]:t.shortName&&t.shortName in u&&(t.name=T.oids[u[t.shortName]])),void 0===t.type){if(!(t.name&&t.name in T.oids))throw(r=new Error("Attribute type not specified.")).attribute=t,r;t.type=T.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in u&&(t.shortName=u[t.name]),t.type===m.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=g.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(T.certificateExtensionToAsn1(i(t.extensions[n])))}if(void 0===t.value)throw(r=new Error("Attribute value not specified.")).attribute=t,r}}function i(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in T.oids&&(e.name=T.oids[e.id]),void 0===e.id){if(!(e.name&&e.name in T.oids))throw(l=new Error("Extension ID not specified.")).extension=e,l;e.id=T.oids[e.name]}if(void 0===e.value){if("keyUsage"===e.name){var r=0,a=0,n=0;e.digitalSignature&&(a|=128,r=7),e.nonRepudiation&&(a|=64,r=6),e.keyEncipherment&&(a|=32,r=5),e.dataEncipherment&&(a|=16,r=4),e.keyAgreement&&(a|=8,r=3),e.keyCertSign&&(a|=4,r=2),e.cRLSign&&(a|=2,r=1),e.encipherOnly&&(a|=1,r=0),e.decipherOnly&&(n|=128,r=7);var i=String.fromCharCode(r);0!==n?i+=String.fromCharCode(a)+String.fromCharCode(n):0!==a&&(i+=String.fromCharCode(a)),e.value=g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,i)}else if("basicConstraints"===e.name)e.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(g.create(g.Class.UNIVERSAL,g.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);var s,o=e.value.value;for(s in e)!0===e[s]&&(s in m?o.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(m[s]).getBytes())):-1!==s.indexOf(".")&&o.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(s).getBytes())))}else if("nsCertType"===e.name){r=0,a=0;e.client&&(a|=128,r=7),e.server&&(a|=64,r=6),e.email&&(a|=32,r=5),e.objsign&&(a|=16,r=4),e.reserved&&(a|=8,r=3),e.sslCA&&(a|=4,r=2),e.emailCA&&(a|=2,r=1),e.objCA&&(a|=1,r=0);i=String.fromCharCode(r);0!==a&&(i+=String.fromCharCode(a)),e.value=g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,i)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){var c;e.value=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);for(var u=0;u<e.altNames.length;++u){i=(c=e.altNames[u]).value;if(7===c.type&&c.ip){if(null===(i=S.util.bytesFromIP(c.ip)))throw(l=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,l}else 8===c.type&&(i=c.oid?g.oidToDer(g.oidToDer(c.oid)):g.oidToDer(i));e.value.value.push(g.create(g.Class.CONTEXT_SPECIFIC,c.type,!1,i))}}else{var d;"subjectKeyIdentifier"===e.name&&t.cert&&(d=t.cert.generateSubjectKeyIdentifier(),e.subjectKeyIdentifier=d.toHex(),e.value=g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,d.getBytes()))}if(void 0!==e.value)return e;var l;throw(l=new Error("Extension value not specified.")).extension=e,l}}null!=S||"function"!=typeof dreamsecurity.chkIntegrity?(g=S.asn1,T=S.pki=S.pki||{},m=T.oids,(u={}).CN=m.commonName,u.commonName="CN",u.C=m.countryName,u.countryName="C",u.L=m.localityName,u.localityName="L",u.ST=m.stateOrProvinceName,u.stateOrProvinceName="ST",u.O=m.organizationName,u.organizationName="O",u.OU=m.organizationalUnitName,u.organizationalUnitName="OU",u.E=m.emailAddress,u.emailAddress="E",e=S.pki.publicKeyValidator,t=S.pki.algIdValidator,h={name:"Certificate",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},t("Certificate.TBSCertificate.signature","Certificate.TBSCertificate.signature.algorithm","certinfoSignatureOid","Certificate.TBSCertificate.signature.parameters","certinfoSignatureParams"),{name:"Certificate.TBSCertificate.issuer",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},e,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:g.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:g.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:g.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},t("Certificate.signatureAlgorithm","Certificate.signatureAlgorithm.algorithm","certSignatureOid","Certificate.TBSCertificate.signature.parameters","certSignatureParams"),{name:"Certificate.signatureValue",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},d={name:"CertificateList",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.TBSCertList",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertList",value:[{name:"CertificateList.TBSCertList.version",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"crlVersion"},t("CertificateList.TBSCertList.signature","CertificateList.TBSCertList.signature.algorithm","crlSignatureOid","CertificateList.TBSCertList.signature.parameters","crlSignatureParams"),{name:"CertificateList.TBSCertList.issuer",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"crlIssuer"},{name:"CertificateList.TBSCertList.thisTime (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"thisUpdate_utcTime"},{name:"CertificateList.TBSCertList.thisTime (generalizedTime)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"thisUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.nextTime (utc)",tagClass:g.Class.UNIVERSAL,type:g.Type.UTCTIME,constructed:!1,optional:!0,capture:"nextUpdate_utcTime"},{name:"CertificateList.TBSCertList.nextTime (generalizedTime)",tagClass:g.Class.UNIVERSAL,type:g.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"nextUpdate_generalizedTime"},{name:"CertificateList.TBSCertList.revokedCertificates",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"revokedCertificates"},{name:"CertificateList.TBSCertList.extensions",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"crlExtensions"}]},{name:"CertificateList.signatureAlgorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateList.signatureAlgorithm.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"crlSignatureOid"},{name:"CertificateList.signatureAlgorithm.parameters",tagClass:g.Class.UNIVERSAL,optional:!0,captureAsn1:"crlSignatureParams"}]},{name:"CertificateList.signatureValue",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"signatureValue"}]},o={name:"rsapss",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:g.Class.UNIVERSAL,type:g.Class.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:g.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:g.Class.UNIVERSAL,type:g.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:g.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:g.Class.UNIVERSAL,type:g.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:g.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:g.Class.UNIVERSAL,type:g.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},r={name:"CertificationRequestInfo",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:g.Class.UNIVERSAL,type:g.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},e,{name:"CertificationRequestInfo.attributes",tagClass:g.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:g.Class.UNIVERSAL,type:g.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:g.Class.UNIVERSAL,type:g.Type.SET,constructed:!0}]}]}]},p={name:"CertificationRequest",tagClass:g.Class.UNIVERSAL,type:g.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[r,t("CertificationRequest.signatureAlgorithm","CertificationRequest.signatureAlgorithm.algorithm","csrSignatureOid","CertificationRequest.signatureAlgorithm.parameters","csrSignatureParams"),{name:"CertificationRequest.signature",tagClass:g.Class.UNIVERSAL,type:g.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]},T.RDNAttributesAsArray=function(e,t){for(var r,a,n,i=[],s=0;s<e.value.length;++s){r=e.value[s];for(var o=0;o<r.value.length;++o)n={},a=r.value[o],n.type=g.derToOid(a.value[0].value),n.value=a.value[1].value,n.valueTagClass=a.value[1].type,n.type in m&&(n.name=m[n.type],n.name in u&&(n.shortName=u[n.name])),t&&(t.update(n.type),t.update(n.value)),i.push(n)}return i},T.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var a=e[r],n=g.derToOid(a.value[0].value),i=a.value[1].value,s=0;s<i.length;++s){var o={};if(o.type=n,o.value=i[s].value,o.valueTagClass=i[s].type,o.type in m&&(o.name=m[o.type],o.name in u&&(o.shortName=u[o.name])),o.type===m.extensionRequest){o.extensions=[];for(var c=0;c<o.value.length;++c)o.extensions.push(T.certificateExtensionFromAsn1(o.value[c]))}t.push(o)}return t},T.processGeneralName=function(e,t){switch(e.type){case 0:if(g.derToOid(e.value[0].value)==S.pki.oids.kisa_identifyData){t.otherName={};var r=e.value[1].value[0].value;if(t.otherName.realName=S.util.decodeUtf8(r[0].value),2==r.length)for(var a=0;a<r[1].value.length;a++){var n,i,s=r[1].value[a].value;g.derToOid(s[0].value)==S.pki.oids.VID?(n=s[1].value,t.otherName.vid={},t.otherName.vid.hashAlg=S.pki.oids[g.derToOid(n[0].value[0].value)],t.otherName.vid.value=S.util.createBuffer(n[1].value[0].value)):g.derToOid(s[0].value)==S.pki.oids.kiec_hashedIDNInfo&&(i=s[1].value,t.otherName.hashedIdn={},t.otherName.hashedIdn.hashAlg=S.pki.oids[g.derToOid(i[0].value[0].value)],t.otherName.hashedIdn.value=S.util.createBuffer(i[1].value))}}break;case 1:case 2:break;case 4:var o=S.md.sha1.create();t.dn={},t.dn.attributes=T.RDNAttributesAsArray(e.value[0],o),t.dn.hash=o.digest().toHex();break;case 6:t.uri=e.value;break;case 7:t.ip=S.util.bytesToIP(e.value);break;case 8:t.oid=g.derToOid(e.value)}},T.processCertPolicies=function(e){for(var t=[],r=0;r<e.value.length;++r){var a={},n=e.value[r].value;if(a.policyIdentifier=g.derToOid(n[0].value),2==n.length){a.policyQualifiers={};for(var i=n[1].value,s=0;s<i.length;s++){var o,c,u,d,l=i[s].value,p=g.derToOid(l[0].value);p===S.pki.oids.cps?a.cps=l[1].value:p===S.pki.oids.unotice&&(a.unotice={},(c=0)<(o=l[1].value.length)&&l[1].value[c].type===g.Type.SEQUENCE&&((u=l[1].value[c].value)[0].type===g.Type.UTF8?a.unotice.organization=S.util.decodeUtf8(u[0].value):a.unotice.organization=u[0].value,u.length,o--,c++),0<o&&((d=l[1].value[c]).type===g.Type.UTF8?a.unotice.explicitText=S.util.decodeUtf8(d.value):a.unotice.explicitText=d.value))}}return t.push(a),t}},T.readSignatureParameters=function(e,t,r){var a={},n={},i=[];if(e===m.RSASSA_PSS){if(r&&(a={hash:{algorithmOid:m.sha1},mgf:{algorithmOid:m.mgf1,hash:{algorithmOid:m.sha1}},saltLength:20}),!g.validate(t,o,n,i)){var s=new Error("Cannot read RSASSA-PSS parameter block.");throw s.errors=i,s}void 0!==n.hashOid&&(a.hash=a.hash||{},a.hash.algorithmOid=g.derToOid(n.hashOid)),void 0!==n.maskGenOid&&(a.mgf=a.mgf||{},a.mgf.algorithmOid=g.derToOid(n.maskGenOid),a.mgf.hash=a.mgf.hash||{},a.mgf.hash.algorithmOid=g.derToOid(n.maskGenHashOid)),void 0!==n.saltLength&&(a.saltLength=n.saltLength.charCodeAt(0))}else e==m.kcdsa1&&(a.domainParam=T.kcdsa.domainParamFromAsn1(t));return a},T.verifySignature=function(e,t,r,a,n,i){var s;switch(e){case m.RSASSA_PSS:var o,c,u,d=m[t.mgf.hash.algorithmOid];if(void 0===d||void 0===S.md[d])throw(u=new Error("Unsupported MGF hash function.")).oid=t.mgf.hash.algorithmOid,u.name=d,u;if(void 0===(o=m[t.mgf.algorithmOid])||void 0===S.mgf[o])throw(u=new Error("Unsupported MGF function.")).oid=t.mgf.algorithmOid,u.name=o,u;if(o=S.mgf[o].create(S.md[d].create()),void 0===(d=m[t.hash.algorithmOid])||void 0===S.md[d])throw(u=new Error("Unsupported RSASSA-PSS hash function.")).oid=t.hash.algorithmOid,u.name=d,u;d=S.md[d].create(),20===(c=t.saltLength)&&(c=d.digestLength),s=S.pss.create(d,o,c);break;case m.sha1WithRSAEncryption:case m.sha256WithRSAEncryption:case m.sha384WithRSAEncryption:case m.sha512WithRSAEncryption:case m.rsaEncryption:case m.kcdsa1:case m.kcdsa1WithSHA1:case m.kcdsa1WithSHA256:break;default:throw(u=new Error("Unsupported signature algorithm.")).oid=e,u}return"rsa"==a.algName?(r.start(),r.update(n),a.verify(r.digest().getBytes(),i,s)):"kcdsa"==a.algName?a.verify(n,r.algorithm,i):void 0},T.certificateFromPem=function(e,t,r){var a=S.pem.decode(e)[0];if("CERTIFICATE"!==a.type&&"X509 CERTIFICATE"!==a.type&&"TRUSTED CERTIFICATE"!==a.type){var n=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw n.headerType=a.type,n}if(a.procType&&"ENCRYPTED"===a.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var i=g.fromDer(a.body,r);return T.certificateFromAsn1(i,t)},T.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:g.toDer(T.certificateToAsn1(e)).getBytes()};return S.pem.encode(r,{maxline:t})},T.publicKeyFromPem=function(e){var t=S.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var a=g.fromDer(t.body);return T.publicKeyFromAsn1(a)},T.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:g.toDer(T.publicKeyToAsn1(e)).getBytes()};return S.pem.encode(r,{maxline:t})},T.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:g.toDer(T.publicKeyToRSAPublicKey(e)).getBytes()};return S.pem.encode(r,{maxline:t})},T.getPublicKeyFingerprint=function(e,t){var r,a=(t=t||{}).md||S.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=g.toDer(T.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=g.toDer(T.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}a.start(),a.update(r);var n=a.digest();if("hex"===t.encoding){var i=n.toHex();return t.delimiter?i.match(/.{2}/g).join(t.delimiter):i}if("binary"===t.encoding)return n.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return n},T.certificationRequestFromPem=function(e,t,r){var a=S.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==a.type){var n=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw n.headerType=a.type,n}if(a.procType&&"ENCRYPTED"===a.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var i=g.fromDer(a.body,r);return T.certificationRequestFromAsn1(i,t)},T.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:g.toDer(T.certificationRequestToAsn1(e)).getBytes()};return S.pem.encode(r,{maxline:t})},T.createCertificate=function(){var o={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return o.siginfo.algorithmOid=null,o.validity={},o.validity.notBefore=new Date,o.validity.notAfter=new Date,o.issuer={},o.issuer.getField=function(e){return C(o.issuer,e)},o.issuer.addField=function(e){I([e]),o.issuer.attributes.push(e)},o.issuer.attributes=[],o.issuer.hash=null,o.subject={},o.subject.getField=function(e){return C(o.subject,e)},o.subject.addField=function(e){I([e]),o.subject.attributes.push(e)},o.subject.attributes=[],o.subject.hash=null,o.extensions=[],o.publicKey=null,o.md=null,o.setSubject=function(e,t){I(e),o.subject.attributes=e,delete o.subject.uniqueId,t&&(o.subject.uniqueId=t),o.subject.hash=null},o.setIssuer=function(e,t){I(e),o.issuer.attributes=e,delete o.issuer.uniqueId,t&&(o.issuer.uniqueId=t),o.issuer.hash=null},o.setExtensions=function(e){for(var t=0;t<e.length;++t)i(e[t],{cert:o});o.extensions=e},o.getExtension=function(e){"string"==typeof e&&(e={name:e});for(var t,r=null,a=0;null===r&&a<o.extensions.length;++a)t=o.extensions[a],(e.id&&t.id===e.id||e.name&&t.name===e.name)&&(r=t);return r},o.sign=function(e,t){o.md=t||S.md.sha1.create();var r=m[o.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw a.algorithm=o.md.algorithm,a}o.signatureOid=o.siginfo.algorithmOid=r,o.tbsCertificate=T.getTBSCertificate(o);var n=g.toDer(o.tbsCertificate);o.md.update(n.getBytes()),o.signature=e.sign(o.md)},o.verify=function(e){var t=!1;if(!o.issued(e)){var r=e.issuer,a=o.subject;throw(n=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=r.attributes,n.actualIssuer=a.attributes,n}var n,i=e.md;if(null===i){if(e.signatureOid in m)switch(m[e.signatureOid]){case"sha1WithRSAEncryption":i=S.md.sha1.create();break;case"md5WithRSAEncryption":i=S.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":i=S.md.sha256.create()}if(null===i)throw(n=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=e.signatureOid,n;var s=e.tbsCertificate||T.getTBSCertificate(e)}return null!==i&&(t=T.verifySignature(e.signatureOid,e.signatureParameters,i,o.publicKey,g.toDer(s).getBytes(),e.signature)),t},o.isIssuer=function(e){var t=!1,r=o.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length)for(var n,i,t=!0,s=0;t&&s<r.attributes.length;++s)n=r.attributes[s],i=a.attributes[s],n.type===i.type&&n.value===i.value||(t=!1);return t},o.issued=function(e){return e.isIssuer(o)},o.generateSubjectKeyIdentifier=function(){return T.getPublicKeyFingerprint(o.publicKey,{type:"RSAPublicKey"})},o.verifySubjectKeyIdentifier=function(){for(var e=m.subjectKeyIdentifier,t=0;t<o.extensions.length;++t){var r=o.extensions[t];if(r.id===e){var a=o.generateSubjectKeyIdentifier().getBytes();return S.util.hexToBytes(r.subjectKeyIdentifier)===a}}return!1},o},T.certificateFromAsn1=function(e,t){A();var r={},a=[];if(!g.validate(e,h,r,a))throw(d=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=a,d;if("string"!=typeof r.certSignature){for(var n="\0",i=0;i<r.certSignature.length;++i)n+=g.toDer(r.certSignature[i]).getBytes();r.certSignature=n}var s=g.derToOid(r.publicKeyOid);if(s!==T.oids.rsaEncryption&&s!==T.oids.kcdsa1)throw new Error("Cannot read public key. OID is unknown.");var o=T.createCertificate();o.version=r.certVersion?r.certVersion.charCodeAt(0):0;var c=S.util.createBuffer(r.certSerialNumber);o.serialNumber=c.toHex(),o.signatureOid=S.asn1.derToOid(r.certSignatureOid),o.signatureParameters=S.pki.readSignatureParameters(o.signatureOid,r.certSignatureParams,!0),o.siginfo.algorithmOid=S.asn1.derToOid(r.certinfoSignatureOid),o.siginfo.parameters=S.pki.readSignatureParameters(o.siginfo.algorithmOid,r.certinfoSignatureParams,!1);var u=S.util.createBuffer(r.certSignature);++u.read,o.signature=u.getBytes();var d,l=[];if(void 0!==r.certValidity1UTCTime&&l.push(g.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&l.push(g.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&l.push(g.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&l.push(g.generalizedTimeToDate(r.certValidity4GeneralizedTime)),2<l.length)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(l.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(o.validity.notBefore=l[0],o.validity.notAfter=l[1],o.tbsCertificate=r.tbsCertificate,t){if(o.md=null,o.signatureOid in m)switch(s=m[o.signatureOid]){case"sha1WithRSAEncryption":o.md=S.md.sha1.create();break;case"md5WithRSAEncryption":o.md=S.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":o.md=S.md.sha256.create()}if(null===o.md)throw(d=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=o.signatureOid,d;var p=g.toDer(o.tbsCertificate);o.md.update(p.getBytes())}var f=S.md.sha1.create();o.issuer.getField=function(e){return C(o.issuer,e)},o.issuer.addField=function(e){I([e]),o.issuer.attributes.push(e)},o.issuer.attributes=T.RDNAttributesAsArray(r.certIssuer,f),r.certIssuerUniqueId&&(o.issuer.uniqueId=r.certIssuerUniqueId),o.issuer.hash=f.digest().toHex();var y=S.md.sha1.create();return o.subject.getField=function(e){return C(o.subject,e)},o.subject.addField=function(e){I([e]),o.subject.attributes.push(e)},o.subject.attributes=T.RDNAttributesAsArray(r.certSubject,y),r.certSubjectUniqueId&&(o.subject.uniqueId=r.certSubjectUniqueId),o.subject.hash=y.digest().toHex(),r.certExtensions?o.extensions=T.certificateExtensionsFromAsn1(r.certExtensions):o.extensions=[],o.publicKey=T.publicKeyFromAsn1(r.subjectPublicKeyInfo),o},T.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var a=e.value[r],n=0;n<a.value.length;++n)t.push(T.certificateExtensionFromAsn1(a.value[n]));return t},T.certificateExtensionFromAsn1=function(e){var t={};if(t.id=g.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===g.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in m)if(t.name=m[t.id],"keyUsage"===t.name){var r=0,a=0;1<(i=g.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1),a=2<i.value.length?i.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&a)}else if("basicConstraints"===t.name){0<(i=g.fromDer(t.value)).value.length&&i.value[0].type===g.Type.BOOLEAN?t.cA=0!==i.value[0].value.charCodeAt(0):t.cA=!1;var n=null;0<i.value.length&&i.value[0].type===g.Type.INTEGER?n=i.value[0].value:1<i.value.length&&(n=i.value[1].value),null!==n&&(t.pathLenConstraint=g.derToInteger(n))}else if("extKeyUsage"===t.name)for(var i=g.fromDer(t.value),s=0;s<i.value.length;++s){var o=g.derToOid(i.value[s].value);o in m?t[m[o]]=!0:t[o]=!0}else if("nsCertType"===t.name){r=0;1<(i=g.fromDer(t.value)).value.length&&(r=i.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r)}else if("subjectAltName"===t.name||"issuerAltName"===t.name)E(t);else if("subjectKeyIdentifier"===t.name){i=g.fromDer(t.value);t.subjectKeyIdentifier=S.util.bytesToHex(i.value)}else if("authorityKeyIdentifier"===t.name)v(t);else if("certificatePolicies"===t.name)t.certificatePolicies=T.processCertPolicies(g.fromDer(t.value));else if("policyConstraints"===t.name){i=g.fromDer(t.value);t.policyConstraints={};for(var c=0;c<i.value.length;++c)switch(i.value[c].type){case 0:t.policyConstraints.requireExplicitPolicy=g.derToInteger(i.value[c].value);break;case 1:t.policyConstraints.inhibitPolicyMapping=g.derToInteger(i.value[c].value)}}else if("cRLDistributionPoints"===t.name){i=g.fromDer(t.value);t.cRLDistributionPoints=[];for(var u={},c=0;c<i.value.length;++c){for(var d,l,p=i.value[c].value,f=0;f<p.length;f++){0===p[f].type&&(u.distributionPoint=[],0==(d=p[f].value[0]).type&&(l={},T.processGeneralName(d.value[0],l),u.distributionPoint.push(l)))}t.cRLDistributionPoints.push(u)}}else if("authorityInfoAccess"===t.name){i=g.fromDer(t.value);t.authorityInfoAccess={};for(c=0;c<i.value.length;++c){var y=i.value[c],h=g.derToOid(y.value[0].value);h==S.pki.oids.ad_ocsp?(t.authorityInfoAccess.ocsp={},T.processGeneralName(y.value[1],t.authorityInfoAccess.ocsp)):h==S.pki.oids.ad_caIssuers&&(t.authorityInfoAccess.caIssuers={},T.processGeneralName(y.value[1],t.authorityInfoAccess.caIssuers))}}return t},T.certificateRevocationListFromPem=function(e,t){var r=S.pem.decode(e)[0];if("X509 CRL"!==r.type){var a=new Error('Could not convert certificate revocation list from PEM; PEM header type is not "X509 CRL".');throw a.headerType=r.type,a}if(r.procType&&"ENCRYPTED"===r.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var n=g.fromDer(r.body);return T.certificateRevocationListFromAsn1(n,t)},T.createCertificateRevocationList=function(){var o={version:1,signatureOid:null,signatureParam:null,signature:null,thisUpdate:null,nextUpdate:null,issuer:{}};return o.issuer.attributes=[],o.issuer.hash=null,o.extensions=[],o.verify=function(e){var t;if(!o.isIssuer(e)){var r=o.issuer,a=e.subject;throw(n=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=r.attributes,n.actualIssuer=a.attributes,n}md=function(e){switch(e){case m.sha1WithRSAEncryption:return S.md.sha1.create();case m.md5WithRSAEncryption:return S.md.md5.create();case m.sha256WithRSAEncryption:case m.RSASSA_PSS:return S.md.sha256.create()}var t=new Error("Unknown signature oid("+e+")");throw t.signatureOid=e,t}(o.signatureOid),t=S.pki.verifySignature(o.signatureOid,o.signatureParam,md,e.publicKey,g.toDer(o.tbsCertList).getBytes(),o.signature);var n,i=new Date;if(i>o.nextUpdate)throw(n=new Error("The crl has expired. current : "+i+", expiredDate : "+o.nextUpdate)).type=S.err.expired,n;if(i<o.thisUpdate)throw new Error("The crl is not valid yet. cuurent : "+i+", validDate : "+o.thisUpdate);return t},o.isRevoked=function(e){for(var t,r=0;r<o.revokedCertsAsn1.value.length;r++)if(null!==(t=T.revokedCertFromAsn1(o.revokedCertsAsn1.value[r],e.toLowerCase()))){for(r=0;r<t.exts.length;r++)if(void 0!==t.exts[r].cRLReason)return{revocationDate:t.revocationDate,reasonCode:t.exts[r].cRLReason};return{revocationDate:t.revocationDate,reasonCode:0}}return null},o.isIssuer=function(e){var t=!1,r=o.issuer,a=e.subject;if(r.hash&&a.hash)t=r.hash===a.hash;else if(r.attributes.length===a.attributes.length)for(var n,i,t=!0,s=0;t&&s<r.attributes.length;++s)n=r.attributes[s],i=a.attributes[s],n.type===i.type&&n.value===i.value||(t=!1);return t},o},T.certificateRevocationListFromAsn1=function(e,t){A();var r={},a=[];if(!g.validate(e,d,r,a)){var n=new Error("Cannot read X.509 certificate revocation list. ASN.1 object is not an X509v2 Certificate Revocation List.");throw n.errors=a,n}if("string"!=typeof r.signatureValue){for(var i="\0",s=0;s<r.signatureValue.length;++s)i+=g.toDer(r.signatureValue[s]).getBytes();r.signatureValue=i}var o=T.createCertificateRevocationList();o.version=r.crlVersion?r.crlVersion.charCodeAt(0):0,o.signatureOid=S.asn1.derToOid(r.crlSignatureOid),o.signatureParam=S.pki.readSignatureParameters(o.signatureOid,r.crlSignatureParams,!0);var c=S.util.createBuffer(r.signatureValue);++c.read,o.signature=c.getBytes();var u=S.md.sha1.create();return o.issuer.attributes=T.RDNAttributesAsArray(r.crlIssuer,u),o.issuer.hash=u.digest().toHex(),void 0!==r.thisUpdate_utcTime&&(o.thisUpdate=g.utcTimeToDate(r.thisUpdate_utcTime)),void 0!==r.thisUpdate_generalizedTime&&(o.thisUpdate=g.generalizedTimeToDate(r.thisUpdate_generalizedTime)),void 0!==r.nextUpdate_utcTime&&(o.nextUpdate=g.utcTimeToDate(r.nextUpdate_utcTime)),void 0!==r.nextUpdate_generalizedTime&&(o.nextUpdate=g.generalizedTimeToDate(r.nextUpdate_generalizedTime)),o.tbsCertList=r.tbsCertList,o.revokedCertsAsn1=r.revokedCertificates,r.crlExtensions?o.extensions=T.crlExtensionsFromAsn1(r.crlExtensions):o.extensions=[],o},T.crlExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var a=e.value[r],n=0;n<a.value.length;++n)t.push(T.crlExtensionFromAsn1(a.value[n]));return t},T.revokedCertificatesFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;r++)t.push(T.revokedCertFromAsn1(e.value[r]));return t},T.revokedCertFromAsn1=function(e,t){var r={},a=e.value[0];if(a.type!=g.Type.INTEGER)throw new Error("Wrong revoked certificates in CRL.");if(r.userCertificate=S.util.createBuffer(a.value).toHex(),null!=t&&r.userCertificate!==t)return null;var n=e.value[1];if(n.type==g.Type.UTCTIME)r.revocationDate=g.utcTimeToDate(n.value);else{if(n.type!=g.Type.GENERALIZEDTIME)throw new Error("Wrong revoked certificates in CRL.");r.revocationDate=g.generalizedTimeToDate(n.value)}if(r.exts=[],3===e.value.length)for(var i=e.value[2],s=0;s<i.value.length;s++)r.exts.push(T.crlExtensionFromAsn1(i.value[s]));return r},T.crlExtensionFromAsn1=function(e){var t,r={};return r.id=g.derToOid(e.value[0].value),r.critical=!1,e.value[1].type===g.Type.BOOLEAN?(r.critical=0!==e.value[1].value.charCodeAt(0),r.value=e.value[2].value):r.value=e.value[1].value,r.id in m&&(r.name=m[r.id],"authorityKeyIdentifier"===r.name?v(r):"issuerAltName"===r.name?E(r):"cRLNumber"===r.name?(t=g.fromDer(r.value),r.cRLNumber=g.derToInteger(t.value)):"issuingDistributionPoint"===r.name?function(e){var t=g.fromDer(e.value);e.onlyContainsUserCerts=!1,e.onlyContainsCACerts=!1,e.indirectCRL=!1,e.onlyContainsAttributeCerts=!1;for(var r=0;r<t.value.length;++r)switch(t.value[r].type){case 0:e.distributionPoint=[];var a,n=t.value[r].value[0];0==n.type&&(a={},T.processGeneralName(n.value[0],a),e.distributionPoint.push(a));break;case 1:e.onlyContainsUserCerts=0!==t.value[r].value.charCodeAt(0);break;case 2:e.onlyContainsCACerts=0!==t.value[r].value.charCodeAt(0);break;case 3:break;case 4:e.indirectCRL=0!==t.value[r].value.charCodeAt(0);break;case 5:e.onlyContainsAttributeCerts=0!==t.value[r].value.charCodeAt(0)}}(r):"cRLReason"===r.name?(t=g.fromDer(r.value),r.cRLReason=g.derToInteger(t.value)):"invalidityDate"===r.name&&(t=g.fromDer(r.value),r.invalidityDate=g.generalizedTimeToDate(t.value))),r},T.certificationRequestFromAsn1=function(e,t){A();var r={},a=[];if(!g.validate(e,p,r,a))throw(c=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=a,c;if("string"!=typeof r.csrSignature){for(var n="\0",i=0;i<r.csrSignature.length;++i)n+=g.toDer(r.csrSignature[i]).getBytes();r.csrSignature=n}var s=g.derToOid(r.publicKeyOid);if(s!==T.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var o=T.createCertificationRequest();o.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,o.signatureOid=S.asn1.derToOid(r.csrSignatureOid),o.signatureParameters=S.pki.readSignatureParameters(o.signatureOid,r.csrSignatureParams,!0),o.siginfo.algorithmOid=S.asn1.derToOid(r.csrSignatureOid),o.siginfo.parameters=S.pki.readSignatureParameters(o.siginfo.algorithmOid,r.csrSignatureParams,!1);var c,u=S.util.createBuffer(r.csrSignature);if(++u.read,o.signature=u.getBytes(),o.certificationRequestInfo=r.certificationRequestInfo,t){if(o.md=null,o.signatureOid in m)switch(s=m[o.signatureOid]){case"sha1WithRSAEncryption":o.md=S.md.sha1.create();break;case"md5WithRSAEncryption":o.md=S.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":o.md=S.md.sha256.create()}if(null===o.md)throw(c=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=o.signatureOid,c;var d=g.toDer(o.certificationRequestInfo);o.md.update(d.getBytes())}var l=S.md.sha1.create();return o.subject.getField=function(e){return C(o.subject,e)},o.subject.addField=function(e){I([e]),o.subject.attributes.push(e)},o.subject.attributes=T.RDNAttributesAsArray(r.certificationRequestInfoSubject,l),o.subject.hash=l.digest().toHex(),o.publicKey=T.publicKeyFromAsn1(r.subjectPublicKeyInfo),o.getAttribute=function(e){return C(o,e)},o.addAttribute=function(e){I([e]),o.attributes.push(e)},o.attributes=T.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),o},T.createCertificationRequest=function(){var i={version:0,signatureOid:null,signature:null,siginfo:{}};return i.siginfo.algorithmOid=null,i.subject={},i.subject.getField=function(e){return C(i.subject,e)},i.subject.addField=function(e){I([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.publicKey=null,i.attributes=[],i.getAttribute=function(e){return C(i,e)},i.addAttribute=function(e){I([e]),i.attributes.push(e)},i.md=null,i.setSubject=function(e){I(e),i.subject.attributes=e,i.subject.hash=null},i.setAttributes=function(e){I(e),i.attributes=e},i.sign=function(e,t){i.md=t||S.md.sha1.create();var r=m[i.md.algorithm+"WithRSAEncryption"];if(!r){var a=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw a.algorithm=i.md.algorithm,a}i.signatureOid=i.siginfo.algorithmOid=r,i.certificationRequestInfo=T.getCertificationRequestInfo(i);var n=g.toDer(i.certificationRequestInfo);i.md.update(n.getBytes()),i.signature=e.sign(i.md)},i.verify=function(){var e=!1,t=i.md;if(null===t){if(i.signatureOid in m)switch(m[i.signatureOid]){case"sha1WithRSAEncryption":t=S.md.sha1.create();break;case"md5WithRSAEncryption":t=S.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA_PSS":t=S.md.sha256.create()}if(null===t){var r=new Error("Could not compute certification request digest. Unknown signature OID.");throw r.signatureOid=i.signatureOid,r}var a=i.certificationRequestInfo||T.getCertificationRequestInfo(i)}return null!==t&&(e=T.verifySignature(i.signatureOid,i.signatureParameters,t,i.publicKey,g.toDer(a).getBytes(),i.signature)),e},i},T.signatureParametersToAsn1=function(e,t){switch(e){case m.RSASSA_PSS:var r=[];return void 0!==t.hash.algorithmOid&&t.hash.algorithmOid!==m.sha1&&r.push(g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(t.hash.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")])])),void 0===t.mgf.algorithmOid||t.mgf.algorithmOid===m.mgf1&&t.mgf.hash.algorithmOid===m.sha1||r.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(t.mgf.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(t.mgf.hash.algorithmOid).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&20!==t.saltLength&&r.push(g.create(g.Class.CONTEXT_SPECIFIC,2,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(t.saltLength).getBytes())])),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,r);case m.kcdsa1:return T.toKCDSAParam(t.domainParam);default:return g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")}},T.getTBSCertificate=function(e){var t=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(e.version).getBytes())]),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,S.util.hexToBytes(e.serialNumber)),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(e.siginfo.algorithmOid).getBytes()),T.signatureParametersToAsn1(e.siginfo.algorithmOid,e.siginfo.parameters)]),n(e.issuer),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.UTCTIME,!1,g.dateToUtcTime(e.validity.notBefore)),g.create(g.Class.UNIVERSAL,g.Type.UTCTIME,!1,g.dateToUtcTime(e.validity.notAfter))]),n(e.subject),T.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&t.value.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,[g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&t.value.push(g.create(g.Class.CONTEXT_SPECIFIC,2,!0,[g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),0<e.extensions.length&&t.value.push(T.certificateExtensionsToAsn1(e.extensions)),t},T.getCertificationRequestInfo=function(e){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(e.version).getBytes()),n(e.subject),T.publicKeyToAsn1(e.publicKey),function(e){var t=g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,a=0;a<r.length;++a){var n=r[a],i=n.value,s=g.Type.UTF8;"valueTagClass"in n&&(s=n.valueTagClass),s===g.Type.UTF8&&(i=S.util.encodeUtf8(i));var o=!1;"valueConstructed"in n&&(o=n.valueConstructed);var c=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(n.type).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[g.create(g.Class.UNIVERSAL,s,o,i)])]);t.value.push(c)}return t}(e)])},T.distinguishedNameToAsn1=n,T.certificateToAsn1=function(e){var t=e.tbsCertificate||T.getTBSCertificate(e);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[t,g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(e.signatureOid).getBytes()),T.signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},T.certificateExtensionsToAsn1=function(e){var t=g.create(g.Class.CONTEXT_SPECIFIC,3,!0,[]),r=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);t.value.push(r);for(var a=0;a<e.length;++a)r.value.push(T.certificateExtensionToAsn1(e[a]));return t},T.certificateExtensionToAsn1=function(e){var t=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[]);t.value.push(g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(e.id).getBytes())),e.critical&&t.value.push(g.create(g.Class.UNIVERSAL,g.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=g.toDer(r).getBytes()),t.value.push(g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,r)),t},T.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||T.getCertificationRequestInfo(e);return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[t,g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(e.signatureOid).getBytes()),T.signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),g.create(g.Class.UNIVERSAL,g.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},T.createCaStore=function(e){var a={certs:{},getIssuer:function(e){var t,r=null;if(e.issuer.hash||(t=S.md.sha1.create(),e.issuer.attributes=T.RDNAttributesAsArray(n(e.issuer),t),e.issuer.hash=t.digest().toHex()),e.issuer.hash in a.certs&&(r=a.certs[e.issuer.hash],S.util.isArray(r)))throw new Error("Resolving multiple issuer matches not implemented yet.");return r},addCertificate:function(e){var t,r;"string"==typeof e&&(e=S.pki.certificateFromPem(e)),e.subject.hash||(t=S.md.sha1.create(),e.subject.attributes=T.RDNAttributesAsArray(n(e.subject),t),e.subject.hash=t.digest().toHex()),e.subject.hash in a.certs?(r=a.certs[e.subject.hash],S.util.isArray(r)||(r=[r]),r.push(e)):a.certs[e.subject.hash]=e}};if(e)for(var t=0;t<e.length;++t){var r=e[t];a.addCertificate(r)}return a},T.certificateError={bad_certificate:"dreamsecurity.pki.BadCertificate",unsupported_certificate:"dreamsecurity.pki.UnsupportedCertificate",certificate_revoked:"dreamsecurity.pki.CertificateRevoked",certificate_expired:"dreamsecurity.pki.CertificateExpired",certificate_unknown:"dreamsecurity.pki.CertificateUnknown",unknown_ca:"dreamsecurity.pki.UnknownCertificateAuthority"},T.verifyCertificateChain=function(e,t,r){A();var a=(t=t.slice(0)).slice(0),n=new Date,i=!0,s=null,o=0,c=null;do{var u=t.shift();if(n<u.validity.notBefore||n>u.validity.notAfter)s={error:T.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:n},n>u.validity.notAfter?(s.type=S.err.expired,s.message="Certificate has expired. current : "+n+", expiredDate : "+u.validity.notAfter):s.message="Certificate is not valid yet. cuurent : "+n+", validDate : "+u.validity.notBefore;else{var d=!1;if(0<t.length){c=t[0];try{d=c.verify(u)}catch(e){}}else{var l=e.getIssuer(u);if(null===l)s={message:"Certificate is not trusted.",error:T.certificateError.unknown_ca};else for(S.util.isArray(l)||(l=[l]);!d&&0<l.length;){c=l.shift();try{d=c.verify(u)}catch(e){}}}null!==s||d||(s={message:"Certificate signature is invalid.",error:T.certificateError.bad_certificate})}if(null!==s||u.isIssuer(c)||(s={message:"Certificate issuer is invalid.",error:T.certificateError.bad_certificate}),null===s)for(var p={keyUsage:!0,basicConstraints:!0,certificatePolicies:!0,policyConstraints:!0},f=0;null===s&&f<u.extensions.length;++f){var y=u.extensions[f];!y.critical||y.name in p||(s={message:"Certificate has an unsupported critical extension.",error:T.certificateError.unsupported_certificate})}if(null===s&&(!i||0===t.length&&!c)){var h=u.getExtension("basicConstraints"),g=u.getExtension("keyUsage");if(null!==g&&(g.keyCertSign&&null!==h||(s={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:T.certificateError.bad_certificate})),null!==s||null===h||h.cA||(s={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:T.certificateError.bad_certificate}),null===s&&null!==g&&"pathLenConstraint"in h){for(var m=0,f=1;f<t.length-1;++f)t[f].isIssuer(t[f])&&++m;var C=h.pathLenConstraint+1;t.length-m>C&&(s={message:"Certificate basicConstraints pathLenConstraint violated.",error:T.certificateError.bad_certificate})}}var E=null===s||s.error,v=r?r(E,o,a):E;if(!0!==v)throw!0===E&&(s={message:"The application rejected the certificate.",error:T.certificateError.bad_certificate}),!v&&0!==v||("object"!=typeof v||S.util.isArray(v)?"string"==typeof v&&(s.error=v):(v.message&&(s.message=v.message),v.error&&(s.error=v.error))),s;s=null,i=!1,++o}while(0<t.length);return!0}):dreamsecurity.chkIntegrity(arguments.callee,"x509")}var n,i="x509";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),A(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(A);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e.pki}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function n(e){var t,r,a,n,i;null!=e||"function"!=typeof dreamsecurity.chkIntegrity?(t=e.asn1,r=e.pkcs7asn1=e.pkcs7asn1||{},e.pkcs7=e.pkcs7||{},e.pkcs7.asn1=r,a=e.pki.algIdValidator,n={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]},r.contentInfoValidator=n,i={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},a("EncryptedContentInfo.contentEncryptionAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.algorithm","encAlgorithm","EncryptedContentInfo.contentEncryptionAlgorithm.parameter","encParameter"),{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]},r.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},r.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)},r.attributeValidator={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},r.signerValidator={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.DigestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"digestAlgorithm"},{name:"SignerInfo.AuthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"digestEncAlgorithm"},{name:"SignerInfo.EncryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]},r.tbsDataSignedAttributes={name:"authenticatedAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"authenticatedAttributes"},r.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},n,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]},r.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,capture:"keyEncryptionAlgorithm"},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]},r.signedAndEnvelopedDataValidator={name:"SignedAndEnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedAndEnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedAndEnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"},{name:"SignedAndEnvelopedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},i,{name:"SignedAndEnvelopedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedAndEnvelopedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedAndEnvelopedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",constructed:!0,optional:!0}]}):dreamsecurity.chkIntegrity(arguments.callee,"pkc7asn1")}var i,s="pkcs7asn1";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),n(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./util"],function(){(function(a,e){e.exports=function(e){var t=i.map(function(e){return a(e)}).concat(n);if((e=e||{}).defined=e.defined||{},e.defined[s])return e[s];e.defined[s]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[s]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function C(I){var S,A,n,r,a,i,s,T,o,c,u,d,l,p,f,y,h,b,g,m;null!=I||"function"!=typeof dreamsecurity.chkIntegrity?(S=I.asn1,(A=I.pkcs7=I.pkcs7||{}).messageFromPem=function(e){var t=I.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var a=S.fromDer(t.body);return A.messageFromAsn1(a)},A.messageToPem=function(e,t){var r={type:"PKCS7",body:S.toDer(e.toAsn1()).getBytes()};return I.pem.encode(r,{maxline:t})},A.messageFromAsn1=function(e){var t={},r=[];if(!S.validate(e,A.asn1.contentInfoValidator,t,r)){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw a.errors=r,a}var n,i=S.derToOid(t.contentType);switch(i){case I.pki.oids.envelopedData:n=A.createEnvelopedData();break;case I.pki.oids.encryptedData:n=A.createEncryptedData();break;case I.pki.oids.signedData:n=A.createSignedData();break;case I.pki.oids.signedAndEnvelopedData:n=A.createSignedAndEnvelopedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+i+" is not (yet) supported.")}return n.fromAsn1(t.content.value[0]),n},n=function(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(!S.validate(e,A.asn1.recipientInfoValidator,t,r))throw(i=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.")).errors=r,i;var a=S.derToOid(t.keyEncryptionAlgorithm[0].value),n=null;if(a===I.pki.oids.RSAES_OAEP){var i,s={};if(!S.validate(t.keyEncryptionAlgorithm[1],I.pkcs1.asn1.rsaoaepParamValidator,s,r))throw(i=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.")).errors=r,i;var o,c="sha1";void 0!==s.hashAlgorithm&&(o=S.derToOid(s.hashAlgorithm[0].value),c=I.pki.oids[o].toLowerCase()),n={md:I.md.algorithms[c].create()}}return{version:t.version.charCodeAt(0),issuer:I.pki.RDNAttributesAsArray(t.issuer),serialNumber:I.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:a,parameter:n,content:t.encKey}}}(e[r]));return t},r=function(e){for(var t,r=[],a=0;a<e.length;a++)r.push((t=e[a],S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(t.version).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[I.pki.distinguishedNameToAsn1({attributes:t.issuer}),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,I.util.hexToBytes(t.serialNumber))]),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(t.encryptedContent.algorithm).getBytes()),f(t.encryptedContent.parameter)]),S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return r},a=function(e){return[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.data).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(e.algorithm).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,e.parameter.getBytes())]),S.create(S.Class.CONTEXT_SPECIFIC,0,!1,e.content.getBytes())]},i=function(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(S.validate(e,I.pki.algIdValidator("mdAlg","mdOid","mdOid","mdParam","mdParam"),t,r))return S.derToOid(t.mdOid);var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not an MessageDigestAlgorithm.");throw a.errors=r,a}(e[r]));return t},s=function(e){for(var t=[],r=0;r<e.length;r++)t.push(S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(e[r]).getBytes())]));return t},T=function(e){var t,r={};if(e.authenticatedAttributes.length)for(var a=0;a<e.authenticatedAttributes.length;a++)(t=o(e.authenticatedAttributes[a])).oid===I.pki.oids.contentType?r.vContentType=S.derToOid(t.values[0].value):t.oid===I.pki.oids.messageDigest?r.vMmessageDigest=t.values[0].value:t.oid===I.pki.oids.signingTime?r.vSigningTime=S.utcTimeToDate(t.values[0].value):t.oid!==I.pki.oids.signingCertificate&&t.oid!==I.pki.oids.signingCertificateV2||(r.vSigningCert={},r.vSigningCert.oid=t.oid,r.vSigningCert.value=t.values[0].value);return r},A.attrFromAsn1=function(e){return o(e)},o=function(e){var t={},r=[];if(S.validate(e,A.asn1.attributeValidator,t,r))return{oid:S.derToOid(t.oid),values:[t.values[0]]};var a=new Error("There is a invalid attribute in SignedAttributes.");throw a.errors=r,a},c=function(e){var t=I.pki.oids[e];return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(t).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.NULL,!1,"")])},u=function(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t={},r=[];if(!S.validate(e,A.asn1.signerValidator,t,r)){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 SignedData.");throw a.errors=r,a}var n,i=null;null!=t.authenticatedAttributes&&null!=t.authenticatedAttributes&&(n=T(t),i={derEncoded:t.authenticatedAttributes,contentType:n.vContentType,messageDigest:n.vMmessageDigest,signingTime:n.vSigningTime,signingCert:n.vSigningCert});var s=S.derToOid(t.digestEncAlgorithm[0].value),o=I.pki.readSignatureParameters(s,t.digestEncAlgorithm[1],!0);return{version:t.version.charCodeAt(0),issuer:I.pki.RDNAttributesAsArray(t.issuer),serialNumber:I.util.createBuffer(t.serial).toHex(),signedAttrs:i,signature:{algorithm:s,parameter:o,digestAlgorithm:S.derToOid(t.digestAlgorithm[0].value),content:t.signature},certificate:null}}(e[r]));return t},d=function(e){for(var t=[],r=0;r<e.length;r++)t.push(function(e){var t=S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(e.version).getBytes()),r=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[I.pki.distinguishedNameToAsn1({attributes:e.issuer}),S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,I.util.hexToBytes(e.serialNumber))]),a=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(e.signature.digestAlgorithm).getBytes())]),n=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(e.signature.algorithm).getBytes()),I.pki.signatureParametersToAsn1(e.signature.algorithm,e.signature.parameter)]),i=S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,e.signature.content);if(null==e.signedAttrs||null==e.signedAttrs)return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[t,r,a,n,i]);var s=null,s=e.signedAttrs.derEncoded?S.create(S.Class.CONTEXT_SPECIFIC,0,!0,e.signedAttrs.derEncoded):S.create(S.Class.CONTEXT_SPECIFIC,0,!0,b(e.signedAttrs.contentType,e.signedAttrs.signingTime,e.signedAttrs.messageDigest,e.signedAttrs.signingCert));return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[t,r,a,s,n,i])}(e[r]));return t},l=function(e,t,r){if(e.length!==t.length)return!1;for(var a=0;a<t.length;++a)if(r){if(e[a].value!==t[a].value)return!1}else if(e[a].type!==t[a].type||e[a].value!==t[a].value)return!1;return!0},p=function(e,t){for(var r=0;r<t.length;++r){var a=t[r];if(e.serialNumber===a.serialNumber){if(l(a.issuer.attributes,e.issuer,!1))return r;if(l(a.subject.attributes,e.issuer,!0))return r}}throw new Error("The signer certificate is not exist.")},f=function(e){if(null==e)return S.create(S.Class.UNIVERSAL,S.Type.NULL,!1,"");var t=[];return"sha1"!==e.md.algorithm&&(t.push(S.create(S.Class.CONTEXT_SPECIFIC,0,!0,[c(e.md.algorithm)])),t.push(S.create(S.Class.CONTEXT_SPECIFIC,1,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.mgf1).getBytes()),c(e.md.algorithm)])]))),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,t)},y=function(e,t,r){var a={};if(!S.validate(t,r,a,[])){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw n.errors=n}if(e.contentType=S.derToOid(a.contentType),a.encryptedContent){var i="";if(I.util.isArray(a.encryptedContent))for(var s=0;s<a.encryptedContent.length;++s){if(a.encryptedContent[s].type!==S.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");i+=a.encryptedContent[s].value}else i=a.encryptedContent;e.encryptedContent={algorithm:S.derToOid(a.encAlgorithm),parameter:I.util.createBuffer(a.encParameter.value),content:I.util.createBuffer(i)}}if(a.content){i="";if(I.util.isArray(a.content))for(s=0;s<a.content.length;++s){if(a.content[s].type!==S.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");i+=a.content[s].value}else i=a.content;e.content=I.util.createBuffer(i)}return e.version=a.version.charCodeAt(0),e.rawCapture=a},h=function(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content||null==e.content){var t;switch(e.encryptedContent.algorithm){case I.pki.oids["aes128-CBC"]:case I.pki.oids["aes192-CBC"]:case I.pki.oids["aes256-CBC"]:t=I.aes.createDecryptionCipher(e.encryptedContent.key);break;case I.pki.oids.desCBC:case I.pki.oids["des-EDE3-CBC"]:t=I.des.createDecryptionCipher(e.encryptedContent.key);break;case I.pki.oids.seedCBC:t=I.seed.createDecryptionCipher(e.encryptedContent.key);break;case I.pki.oids.ariaCBC:case I.pki.oids["aria128-CBC"]:case I.pki.oids["aria192-CBC"]:case I.pki.oids["aria256-CBC"]:t=I.aria.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}},b=function(e,t,r,a){var n=[];return n.push(S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.contentType).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(e).getBytes())])])),t&&n.push(S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.signingTime).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,[S.create(S.Class.UNIVERSAL,S.Type.UTCTIME,!1,S.dateToUtcTime(t))])])),n.push(S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.messageDigest).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,[S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,r)])])),a&&n.push(S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(a.oid).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,a.value)])])),g(n)},g=function(e){for(var t,r=[],a=[],n=0,i=0,n=0;n<e.length;++n)r[n]={idx:n,bytes:S.toDer(e[n]).getBytes()};for(n=r.length-1;0<n;n--)for(i=0;i<n;i++){0<m(r[i].bytes,r[i+1].bytes)&&(t={idx:r[i].idx,bytes:r[i].bytes},r[i].idx=r[i+1].idx,r[i].bytes=r[i+1].bytes,r[i+1].idx=t.idx,r[i+1].bytes=t.bytes)}for(n=0;n<r.length;n++)a.push(e[r[n].idx]);return a},m=function(e,t){for(var r=0,r=e.length>t.length?t.length:e.length,a=0;a<r;a++)if(e[a]!=t[a])return e[a]>t[a]?1:-1;return e.length==t.length?0:e.length>t.length?1:-1},A.createSignedData=function(){C();var v=null;return v={type:I.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(e){y(v,e,A.asn1.signedDataValidator),v.certificates=[],v.crls=[],v.digestAlgorithmIdentifiers=[],v.contentInfo=null,v.signerInfos=[];for(var t=v.rawCapture,r=t.certificates.value,a=0;a<r.length;++a)16==r[a].type&&v.certificates.push(I.pki.certificateFromAsn1(r[a]));null!=t.content?v.content=t.content.value[0].value:v.content=null,v.digestAlgorithmIdentifiers=i(t.digestAlgorithms.value),t.signerInfos&&(v.signerInfos=u(t.signerInfos))},toAsn1:function(){v.contentInfo||v.sign();for(var e=[],t=0;t<v.certificates.length;++t)e.push(I.pki.certificateToAsn1(v.certificates[t]));return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(v.type).getBytes()),S.create(S.Class.CONTEXT_SPECIFIC,0,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(v.version).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,s(v.digestAlgorithmIdentifiers)),v.contentInfo,S.create(S.Class.CONTEXT_SPECIFIC,0,!0,e),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,d(v.signerInfos))])])])},sign:function(e,t,r,a,n,i){if("object"!=typeof v.content&&(v.contentInfo=S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(I.pki.oids.data).getBytes())]),2&n||"content"in v&&v.contentInfo.value.push(S.create(S.Class.CONTEXT_SPECIFIC,0,!0,[S.create(S.Class.UNIVERSAL,S.Type.OCTETSTRING,!1,v.content)]))),(void 0===i||void 0===i.setContent||!0!==i.setContent)&&null!=e){for(var s=0,o=!1,s=0;s<v.digestAlgorithmIdentifiers.length;s++)if(v.digestAlgorithmIdentifiers[s]==I.pki.oids[r.algorithm]){o=!0;break}o||v.digestAlgorithmIdentifiers.push(I.pki.oids[r.algorithm]);var c=null,u=null,d=null;if(32&n||4&n){if(16&n)throw new Error("The SignGateFormat and messageDigestContent is not supported.");d=v.content}else if(void 0!==i&&void 0!==i.composeSignedData&&1==i.composeSignedData){if(void 0===i.tbsData)throw new Error("The TBSData(SignedAttributes) is required to compose SignedData.");var l=function(e){var t={},r=[],a=dreamsecurity.asn1.fromDer(e);if(S.validate(a,A.asn1.tbsDataSignedAttributes,t,r))return T(t);var n=new Error("The SignedAttributes is not a exptected format.");throw n.errors=r,n}(d=i.tbsData),c=l.vSigningTime,u=l.vMmessageDigest}else{if(u=16&n?v.content:(r.update(v.content),r.digest().getBytes()),i&&i.signingTime){if(!(i.signingTime instanceof Date))throw new Error("The signingTime is not an instance of Date.");c=i.signingTime}else c=new Date;var p=b(I.pki.oids.data,c,u,null),f=S.create(S.Class.UNIVERSAL,S.Type.SET,!0,p);if(void 0!==i&&void 0!==i.makeSignedAttributes&&!0===i.makeSignedAttributes)return S.toDer(f);d=S.toDer(f).getBytes()}var y,h="",g={},m=null;if(void 0!==i&&void 0!==i.composeSignedData&&1==i.composeSignedData){if(void 0===i.signature)throw new Error("The signature is required to compose SignedData.");m=i.signature}if("rsa"===e.publicKey.algName){"string"==typeof a?h=I.pki.oids.rsaEncryption:(h=I.pki.oids.RSASSA_PSS,y=a.mgf.split("-"),g={hash:{algorithmOid:I.pki.oids[a.md]},mgf:{algorithmOid:I.pki.oids[y[0]],hash:{algorithmOid:I.pki.oids[y[1]]}},saltLength:a.saltLength}),m||(r.start(),r.update(d),m=t.sign(r,a))}else{if("kcdsa"!==e.publicKey.algName)throw new Error("The algorithm("+t.algName+") is not supported.");h=I.pki.oids.kcdsa1,g={domainParam:e.publicKey},m=m||t.sign(d,r.algorithm,e.publicKey.y)}var C={algorithm:h,parameter:g,digestAlgorithm:I.pki.oids[r.algorithm],content:m},E=null,E=4&n?{version:1,issuer:e.subject.attributes,serialNumber:e.serialNumber,signature:C}:32&n?{version:1,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signature:C}:{version:1,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signedAttrs:{contentType:I.pki.oids.data,signingTime:c,messageDigest:u},signature:C};v.signerInfos.push(E),v.certificates.push(e)}},verify:function(){for(var e=0;e<v.signerInfos.length;e++){var t=v.signerInfos[e],r=t.signedAttrs,a=null;t.certIndex=p(t,v.certificates);var n=I.oids[t.signature.digestAlgorithm];if(!n)throw new Error("The digest algorithm("+t.signature.digestAlgorithm+") is not supported.");a=I.md.algorithms[n].create();var i=null;if(null==r)i=v.content;else{if(a.update(v.content),a.digest().toHex()!==I.util.bytesToHex(r.messageDigest))throw new Error("The data integrity is damaged.");i=S.toDer(S.create(S.Class.UNIVERSAL,S.Type.SET,!0,r.derEncoded)).getBytes()}if(!I.pki.verifySignature(t.signature.algorithm,t.signature.parameter,a,v.certificates[t.certIndex].publicKey,i,t.signature.content))return!1}return!0},getSignerInfos:function(){for(var e=0,t=[],e=0;e<v.signerInfos.length;e++){var r=v.signerInfos[e].signedAttrs;t.push({certIndex:v.signerInfos[e].certIndex,signingTime:null!=r?r.signingTime:null})}return t},addCertificate:function(e){"string"==typeof e&&(e=I.pki.certificateFromPem(e)),v.certificates.push(e)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},A.createEncryptedData=function(){C();var t=null;return t={type:I.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:I.pki.oids["aes256-CBC"]},fromAsn1:function(e){y(t,e,A.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encryptedContent.key=e),h(t)}}},A.createEnvelopedData=function(){C();var c=null;return c={type:I.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:I.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=y(c,e,A.asn1.envelopedDataValidator);c.recipients=n(t.recipientInfos.value)},toAsn1:function(){return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(c.type).getBytes()),S.create(S.Class.CONTEXT_SPECIFIC,0,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(c.version).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,r(c.recipients)),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,a(c.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<c.recipients.length;++r){var a=c.recipients[r],n=a.issuer;if(a.serialNumber===e.serialNumber&&n.length===t.length){for(var i=!0,s=0;s<t.length;++s)if(n[s].type!==t[s].type||n[s].value!==t[s].value){i=!1;break}if(i)return a}}return null},decrypt:function(e,t){if(void 0===c.encryptedContent.key&&void 0!==e&&void 0!==t)switch(e.encryptedContent.algorithm){case I.pki.oids.rsaEncryption:case I.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);c.encryptedContent.key=I.util.createBuffer(r);break;case I.pki.oids.RSAES_OAEP:r=t.decrypt(e.encryptedContent.content,"RSA-OAEP",e.encryptedContent.parameter);c.encryptedContent.key=I.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}h(c)},addRecipient:function(e,t,r){var a=null,n=void 0;null==t||"RSAES-PKCS1-V1_5"===t?a=I.pki.oids.rsaEncryption:(a=I.pki.oids.RSAES_OAEP,n=r),c.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:a,parameter:n,key:e.publicKey}})},encrypt:function(e,t){if(void 0===c.encryptedContent.content){var r,a,n;switch(t=t||c.encryptedContent.algorithm,e=e||c.encryptedContent.key,t){case I.pki.oids["aes128-CBC"]:a=r=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["aes192-CBC"]:r=24,a=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["aes256-CBC"]:r=32,a=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["des-EDE3-CBC"]:r=24,a=8,n=I.des.createEncryptionCipher;break;case I.pki.oids.seedCBC:a=r=16,n=I.seed.createEncryptionCipher;break;case I.pki.oids.ariaCBC:case I.pki.oids["aria128-CBC"]:a=r=16,n=I.aria.createEncryptionCipher;break;case I.pki.oids["aria192-CBC"]:r=24,a=16,n=I.aria.createEncryptionCipher;break;case I.pki.oids["aria256-CBC"]:r=32,a=16,n=I.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(void 0===e)e=I.util.createBuffer(I.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");c.encryptedContent.algorithm=t,c.encryptedContent.key=e,c.encryptedContent.parameter=I.util.createBuffer(I.random.getBytes(a));var i=n(e);if(i.start(c.encryptedContent.parameter.copy()),i.update(c.content),!i.finish())throw new Error("Symmetric encryption failed.");c.encryptedContent.content=i.output}for(var s=0;s<c.recipients.length;s++){var o=c.recipients[s];if(void 0===o.encryptedContent.content)switch(o.encryptedContent.algorithm){case I.pki.oids.rsaEncryption:o.encryptedContent.content=o.encryptedContent.key.encrypt(c.encryptedContent.key.data);break;case I.pki.oids.RSAES_OAEP:o.encryptedContent.content=o.encryptedContent.key.encrypt(c.encryptedContent.key.data,"RSA-OAEP",o.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+o.encryptedContent.algorithm)}}}}},A.createSignedAndEnvelopedData=function(){C();var T=null;return T={type:I.pki.oids.signedAndEnvelopedData,version:1,recipients:[],digestAlgorithmIdentifiers:[],encryptedContent:{algorithm:I.pki.oids["aes256-CBC"]},certificates:[],crls:[],signerInfos:[],fromAsn1:function(e){var t=y(T,e,A.asn1.signedAndEnvelopedDataValidator);T.recipients=n(t.recipientInfos.value),T.digestAlgorithmIdentifiers=[],T.certificates=[],T.crls=[],T.signerInfos=[];for(var r=T.rawCapture.certificates.value,a=0;a<r.length;++a)T.certificates.push(I.pki.certificateFromAsn1(r[a]));null!=T.rawCapture.content?T.content=T.rawCapture.content.value[0].value:T.content=null,T.rawCapture.signerInfos&&(T.signerInfos=u(T.rawCapture.signerInfos))},toAsn1:function(){for(var e=[],t=0;t<T.certificates.length;++t)e.push(I.pki.certificateToAsn1(T.certificates[t]));return S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.OID,!1,S.oidToDer(T.type).getBytes()),S.create(S.Class.CONTEXT_SPECIFIC,0,!0,[S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,[S.create(S.Class.UNIVERSAL,S.Type.INTEGER,!1,S.integerToDer(T.version).getBytes()),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,r(T.recipients)),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,s(T.digestAlgorithmIdentifiers)),S.create(S.Class.UNIVERSAL,S.Type.SEQUENCE,!0,a(T.encryptedContent)),S.create(S.Class.CONTEXT_SPECIFIC,0,!0,e),S.create(S.Class.UNIVERSAL,S.Type.SET,!0,d(T.signerInfos))])])])},signAndEnv:function(e,t,r,a,n,i,s){T.digestAlgorithmIdentifiers.push(I.pki.oids[r.algorithm]);var o,c=T.content.getBytes(),u="",d={},l=null;if("rsa"==t.algName){"string"==typeof a?u=I.pki.oids.rsaEncryption:(u=I.pki.oids.RSASSA_PSS,o=a.mgf.split("-"),d={hash:{algorithmOid:I.pki.oids[a.md]},mgf:{algorithmOid:I.pki.oids[o[0]],hash:{algorithmOid:I.pki.oids[o[1]]}},saltLength:a.saltLength}),r.start(),r.update(c),l=t.sign(r,a)}else{if("kcdsa"!=t.algName)throw new Error("The algorithm("+t.algName+") is not supported.");u=I.pki.oids.kcdsa1,d={domainParam:e.publicKey},l=t.sign(c,r.algorithm,e.publicKey.y)}var p,f,y,h=null,g=null;if(void 0===T.encryptedContent.content){switch(s=s||T.encryptedContent.algorithm,i=i||T.encryptedContent.key,s){case I.pki.oids["aes128-CBC"]:f=p=16,y=I.aes.createEncryptionCipher;break;case I.pki.oids["aes192-CBC"]:p=24,f=16,y=I.aes.createEncryptionCipher;break;case I.pki.oids["aes256-CBC"]:p=32,f=16,y=I.aes.createEncryptionCipher;break;case I.pki.oids["des-EDE3-CBC"]:p=24,f=8,y=I.des.createEncryptionCipher;break;case I.pki.oids.seedCBC:f=p=16,y=I.seed.createEncryptionCipher;break;case I.pki.oids.ariaCBC:case I.pki.oids["aria128-CBC"]:f=p=16,y=I.aria.createEncryptionCipher;break;case I.pki.oids["aria192-CBC"]:p=24,f=16,y=I.aria.createEncryptionCipher;break;case I.pki.oids["aria256-CBC"]:p=32,f=16,y=I.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+s)}if(void 0===i)i=I.util.createBuffer(I.random.getBytes(p));else if(i.length()!=p)throw new Error("Symmetric key has wrong length; got "+i.length()+" bytes, expected "+p+".");T.encryptedContent.algorithm=s,T.encryptedContent.key=i,T.encryptedContent.parameter=I.util.createBuffer(I.random.getBytes(f));var m=y(i);if(m.start(T.encryptedContent.parameter.copy()),m.update(I.util.createBuffer(c)),!m.finish())throw new Error("Symmetric encryption failed.");if(g=m.output,m.start(T.encryptedContent.parameter.copy()),m.update(I.util.createBuffer(l)),!m.finish())throw new Error("Symmetric encryption failed.");h=m.output}for(var C=0;C<T.recipients.length;C++){var E=T.recipients[C];if(void 0===E.encryptedContent.content)switch(E.encryptedContent.algorithm){case I.pki.oids.rsaEncryption:E.encryptedContent.content=E.encryptedContent.key.encrypt(T.encryptedContent.key.data);break;case I.pki.oids.RSAES_OAEP:E.encryptedContent.content=E.encryptedContent.key.encrypt(T.encryptedContent.key.data,"RSA-OAEP",E.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+E.encryptedContent.algorithm)}}var v={algorithm:u,parameter:d,digestAlgorithm:I.pki.oids[r.algorithm],content:h.getBytes()},S={version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,signature:v};T.signerInfos.push(S),T.certificates.push(e),T.encryptedContent.content=g},verifyAndDec:function(e,t){if(void 0===T.encryptedContent.key&&void 0!==e&&void 0!==t)switch(e.encryptedContent.algorithm){case I.pki.oids.rsaEncryption:case I.pki.oids.desCBC:var r=t.decrypt(e.encryptedContent.content);T.encryptedContent.key=I.util.createBuffer(r);break;case I.pki.oids.RSAES_OAEP:r=t.decrypt(e.encryptedContent.content,"RSA-OAEP",e.encryptedContent.parameter);T.encryptedContent.key=I.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}if(void 0===T.encryptedContent.key)throw new Error("Symmetric key not available.");var a=null;if(void 0===T.content||null==T.content){switch(T.encryptedContent.algorithm){case I.pki.oids["aes128-CBC"]:case I.pki.oids["aes192-CBC"]:case I.pki.oids["aes256-CBC"]:a=I.aes.createDecryptionCipher(T.encryptedContent.key);break;case I.pki.oids.desCBC:case I.pki.oids["des-EDE3-CBC"]:a=I.des.createDecryptionCipher(T.encryptedContent.key);break;case I.pki.oids.seedCBC:a=I.seed.createDecryptionCipher(T.encryptedContent.key);break;case I.pki.oids.ariaCBC:case I.pki.oids["aria128-CBC"]:case I.pki.oids["aria192-CBC"]:case I.pki.oids["aria256-CBC"]:a=I.aria.createDecryptionCipher(T.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+T.encryptedContent.algorithm)}if(a.start(T.encryptedContent.parameter.copy()),a.update(T.encryptedContent.content),!a.finish())throw new Error("Symmetric decryption failed.");T.content=a.output}for(var n=0;n<T.signerInfos.length;n++){var i=T.signerInfos[n],s=null;if(i.certIndex=p(i,T.certificates),i.signature.digestAlgorithm===I.pki.oids.sha1)s=I.md.sha1.create();else{if(i.signature.digestAlgorithm!==I.pki.oids.sha256)throw new Error("The digest algorithm("+i.signature.digestAlgorithm+") is not supported.");s=I.md.sha256.create()}var o=T.content.copy();if(a.start(T.encryptedContent.parameter.copy()),a.update(I.util.createBuffer(i.signature.content)),!a.finish())throw new Error("Symmetric decryption failed.");var c=a.output;if(!I.pki.verifySignature(i.signature.algorithm,i.signature.parameter,s,T.certificates[i.certIndex].publicKey,o.getBytes(),c.getBytes()))return!1}return!0},getSignerInfos:function(){for(var e=0,t=[],e=0;e<T.signerInfos.length;e++){var r=T.signerInfos[e].signedAttrs;t.push({certIndex:T.signerInfos[e].certIndex,signingTime:null!=r?r.signingTime:null})}return t},addCertificate:function(e){"string"==typeof e&&(e=I.pki.certificateFromPem(e)),T.certificates.push(e)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")},findRecipient:function(e){for(var t=e.issuer.attributes,r=0;r<T.recipients.length;++r){var a=T.recipients[r],n=a.issuer;if(a.serialNumber===e.serialNumber&&n.length===t.length){for(var i=!0,s=0;s<t.length;++s)if(n[s].type!==t[s].type||n[s].value!==t[s].value){i=!1;break}if(i)return a}}return null},addRecipient:function(e,t,r){var a=null,n=void 0;null==t||"RSAES-PKCS1-V1_5"===t?a=I.pki.oids.rsaEncryption:(a=I.pki.oids.RSAES_OAEP,n=r),T.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:a,parameter:n,key:e.publicKey}})},encrypt:function(e,t){if(void 0===T.encryptedContent.content){var r,a,n;switch(t=t||T.encryptedContent.algorithm,e=e||T.encryptedContent.key,t){case I.pki.oids["aes128-CBC"]:a=r=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["aes192-CBC"]:r=24,a=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["aes256-CBC"]:r=32,a=16,n=I.aes.createEncryptionCipher;break;case I.pki.oids["des-EDE3-CBC"]:r=24,a=8,n=I.des.createEncryptionCipher;break;case I.pki.oids.seedCBC:a=r=16,n=I.seed.createEncryptionCipher;break;case I.pki.oids.ariaCBC:case I.pki.oids["aria128-CBC"]:a=r=16,n=I.aria.createEncryptionCipher;break;case I.pki.oids["aria192-CBC"]:r=24,a=16,n=I.aria.createEncryptionCipher;break;case I.pki.oids["aria256-CBC"]:r=32,a=16,n=I.aria.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+t)}if(void 0===e)e=I.util.createBuffer(I.random.getBytes(r));else if(e.length()!=r)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+r+".");T.encryptedContent.algorithm=t,T.encryptedContent.key=e,T.encryptedContent.parameter=I.util.createBuffer(I.random.getBytes(a));var i=n(e);if(i.start(T.encryptedContent.parameter.copy()),i.update(T.content),!i.finish())throw new Error("Symmetric encryption failed.");T.encryptedContent.content=i.output}for(var s=0;s<T.recipients.length;s++){var o=T.recipients[s];if(void 0===o.encryptedContent.content)switch(o.encryptedContent.algorithm){case I.pki.oids.rsaEncryption:o.encryptedContent.content=o.encryptedContent.key.encrypt(T.encryptedContent.key.data);break;case I.pki.oids.RSAES_OAEP:o.encryptedContent.content=o.encryptedContent.key.encrypt(T.encryptedContent.key.data,"RSA-OAEP",o.encryptedContent.parameter);break;default:throw new Error("Unsupported asymmetric cipher, OID "+o.encryptedContent.algorithm)}}}}}):dreamsecurity.chkIntegrity(arguments.callee,"pkcs7")}var n,i="pkcs7";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),C(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(C);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function P(w){var D,U,L,g,m,C,E,v;function S(e,t,r,a){for(var n=[],i=0;i<e.length;i++)for(var s=0;s<e[i].safeBags.length;s++){var o=e[i].safeBags[s];void 0!==a&&o.type!==a||(null===t||void 0!==o.attributes[t]&&0<=o.attributes[t].indexOf(r))&&n.push(o)}return n}function T(e){if(e.composed||e.constructed){for(var t=w.util.createBuffer(),r=0;r<e.value.length;++r)t.putBytes(e.value[r].value);e.composed=e.constructed=!1,e.value=t.getBytes()}return e}null!=w||"function"!=typeof dreamsecurity.chkIntegrity?(D=w.asn1,U=w.pki,L=w.pkcs12=w.pkcs12||{},g={name:"ContentInfo",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:D.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},m={name:"PFX",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:D.Class.UNIVERSAL,type:D.Type.INTEGER,constructed:!1,capture:"version"},g,{name:"PFX.macData",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:D.Class.UNIVERSAL,optional:!0,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:D.Class.UNIVERSAL,type:D.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:D.Class.UNIVERSAL,type:D.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:D.Class.UNIVERSAL,type:D.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},C={name:"SafeBag",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:D.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:D.Class.UNIVERSAL,type:D.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},E={name:"Attribute",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:D.Class.UNIVERSAL,type:D.Type.SET,constructed:!0,capture:"values"}]},v={name:"CertBag",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:D.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:D.Class.UNIVERSAL,type:D.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]},L.pkcs12FromAsn1=function(e,t,r,a){P(),"string"==typeof t?(r=t,t=!0):void 0===t&&(t=!0);var n={},i=[];if(!D.validate(e,m,n,i))throw(l=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.")).errors=i,l;var s={version:n.version.charCodeAt(0),safeContents:[],getBags:function(e){var t,r={};return"localKeyId"in e?t=e.localKeyId:"localKeyIdHex"in e&&(t=w.util.hexToBytes(e.localKeyIdHex)),void 0===t&&!("friendlyName"in e)&&"bagType"in e&&(r[e.bagType]=S(s.safeContents,null,null,e.bagType)),void 0!==t&&(r.localKeyId=S(s.safeContents,"localKeyId",t,e.bagType)),"friendlyName"in e&&(r.friendlyName=S(s.safeContents,"friendlyName",e.friendlyName,e.bagType)),r},getBagsByFriendlyName:function(e,t){return S(s.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return S(s.safeContents,"localKeyId",e,t)}};if(3!==n.version.charCodeAt(0))throw(l=new Error("PKCS#12 PFX of version other than 3 not supported.")).version=n.version.charCodeAt(0),l;if(D.derToOid(n.contentType)!==U.oids.data)throw(l=new Error("Only PKCS#12 PFX in password integrity mode supported.")).oid=D.derToOid(n.contentType),l;var o=n.content.value[0];if(o.tagClass!==D.Class.UNIVERSAL||o.type!==D.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(o=T(o),n.mac){var c=null,u=0,d=D.derToOid(n.macAlgorithm);switch(d){case U.oids.sha1:c=w.md.sha1.create(),u=20;break;case U.oids.sha256:c=w.md.sha256.create(),u=32}if(null===c)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+d);var l,p=new w.util.ByteBuffer(n.macSalt),f="macIterations"in n?parseInt(w.util.bytesToHex(n.macIterations),16):1,y=L.generateKey(r,p,3,f,u,c),h=w.hmac.create();if(h.start(c,y),h.update(o.value),h.getMac().getBytes()!==n.macDigest)throw(l=new Error("Confirm pfx password.")).type=w.err.wrongPasswd,l}return function(e,t,r,a,n){if((t=D.fromDer(t,r)).tagClass!==D.Class.UNIVERSAL||t.type!==D.Type.SEQUENCE||!0!==t.constructed)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var i=0;i<t.value.length;i++){var s=t.value[i],o={},c=[];if(!D.validate(s,g,o,c))throw(u=new Error("Cannot read ContentInfo.")).errors=c,u;var u,d={encrypted:!1},l=null,p=o.content.value[0];switch(D.derToOid(o.contentType)){case U.oids.data:if(p.tagClass!==D.Class.UNIVERSAL||p.type!==D.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");l=T(p).value;break;case U.oids.encryptedData:l=function(e,t){var r={},a=[];if(!D.validate(e,w.pkcs7.asn1.encryptedDataValidator,r,a)){throw(i=new Error("Cannot read EncryptedContentInfo.")).errors=a,i}var n=D.derToOid(r.contentType);if(n!==U.oids.data){var i;throw(i=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.")).oid=n,i}n=D.derToOid(r.encAlgorithm);var s=U.pbe.getCipher(n,r.encParameter,t),o=T(r.encryptedContentAsn1),c=w.util.createBuffer(o.value);if(s.update(c),s.finish())return s.output.getBytes();throw new Error("Failed to decrypt PKCS#12 SafeContents.")}(p,a),d.encrypted=!0;break;default:throw(u=new Error("Unsupported PKCS#12 contentType.")).contentType=D.derToOid(o.contentType),u}d.safeBags=function(e,t,r,a){if(!t&&0===e.length)return[];if((e=D.fromDer(e,t)).tagClass!==D.Class.UNIVERSAL||e.type!==D.Type.SEQUENCE||!0!==e.constructed)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var n,i,s=[],o=0;o<e.value.length;o++){var c=e.value[o],u={},d=[];if(!D.validate(c,C,u,d))throw(p=new Error("Cannot read SafeBag.")).errors=d,p;var l={type:D.derToOid(u.bagId),attributes:function(e){var t={};if(void 0!==e)for(var r=0;r<e.length;++r){var a={},n=[];if(!D.validate(e[r],E,a,n)){var i=new Error("Cannot read PKCS#12 BagAttribute.");throw i.errors=n,i}var s=D.derToOid(a.oid);if(void 0!==U.oids[s]){t[U.oids[s]]=[];for(var o=0;o<a.values.length;++o)t[U.oids[s]].push(a.values[o].value)}}return t}(u.bagAttributes)};s.push(l);var p,f=u.bagValue.value[0];switch(l.type){case U.oids.pkcs8ShroudedKeyBag:if(!(a&&a.format&&1&a.format)&&null===(f=U.decryptPrivateKeyInfo(f,r)))throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case U.oids.keyBag:a&&a.format&&1&a.format?l.key=f:l.key=U.privateKeyFromAsn1(f);continue;case U.oids.certBag:n=v,i=function(){if(D.derToOid(u.certId)!==U.oids.x509Certificate){var e=new Error("Unsupported certificate type, only X.509 supported.");throw e.oid=D.derToOid(u.certId),e}l.cert=U.certificateFromAsn1(D.fromDer(u.cert,t),!0)};break;default:throw(p=new Error("Unsupported PKCS#12 SafeBag type.")).oid=l.type,p}if(void 0!==n&&!D.validate(f,n,u,d))throw(p=new Error("Cannot read PKCS#12 "+n.name)).errors=d,p;i()}return s}(l,r,a,n),e.safeContents.push(d)}}(s,o.value,t,r,a),s},L.makeBagAttr=function(e,t){var r=[];return r.push(D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.localKeyId).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,e)])])),"friendlyName"in t&&r.push(D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.friendlyName).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[D.create(D.Class.UNIVERSAL,D.Type.BMPSTRING,!1,t.friendlyName)])])),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,r)},L.toPkcs12Asn1=function(e,t,r,a){P(),(a=a||{}).saltSize=a.saltSize||8,a.count=a.count||2048,a.algorithm=a.algorithm||a.encAlgorithm||"aes128",a.format=a.format||0,"useMac"in a||(a.useMac=!0),a.usePkcs12=!0;for(var n=[],i=[],s=[],o=0;o<e.length;o++)s.push(L.makeBagAttr(e[o].keyId,a));for(o=0;o<e.length+t.length;o++){var c=null,c=o<e.length?e[o].cert:t[o-e.length],u=o<e.length?s[o]:void 0,d=U.certificateToAsn1(c),l=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.certBag).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.x509Certificate).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,D.toDer(d).getBytes())])])]),u]);i.push(l)}for(var p,f,y,h,g=[],m=null,o=0;o<e.length;++o){var C=null;if(1&a.format){var E=[],v=w.asn1.fromDer(e[o].priKey);if(!D.validate(v,U.pbe.encryptedPrivateKeyValidator,{},E)){var S=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw S.errors=E,S.type=w.err.decode,S}C=v}else C=U.priKeyToPriKeyInfo(e[o].priKey);m=null===r?D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.keyBag).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[C]),s[o]]):D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.pkcs8ShroudedKeyBag).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[1&a.format?C:U.encryptPrivateKeyInfo(C,r,a)]),s[o]]),1&a.format?i.push(m):g.push(m)}0<g.length&&(p=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,g),f=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.data).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,D.toDer(p).getBytes())])]),n.push(f)),0<i.length&&(y=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,i),h=null,h=2&a.format?D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.data).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,D.toDer(y).getBytes())])]):U.encryptDataWithPBE(y,r,a),n.push(h));var T,I,A,b,N,B,k,R=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,n);return a.useMac&&(T=w.md.sha1.create(),I=new w.util.ByteBuffer(w.random.getBytes(a.saltSize)),A=a.count,b=L.generateKey(r,I,3,A,20),(N=w.hmac.create()).start(T,b),N.update(D.toDer(R).getBytes()),B=N.getMac(),k=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.sha1).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")]),D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,B.getBytes())]),D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,I.getBytes()),D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(A).getBytes())])),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(3).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(U.oids.data).getBytes()),D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,D.toDer(R).getBytes())])]),k])},L.generateKey=w.pbe.generatePkcs12Key):dreamsecurity.chkIntegrity(arguments.callee,"pkcs12")}var n,i="pkcs12";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),P(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(P);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function c(e){var t,i,s,o;null!=e||"function"!=typeof dreamsecurity.chkIntegrity?(t=e.tsp=dreamsecurity.tsp||{},i=e.asn1,(s=e.pki).oids,o={name:"TSTInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"TSTInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"TSTInfo.policy",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"policy"},{name:"TSTInfo.messageImprint",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"messageImprint",value:[s.algIdValidator("TSTInfo.messageImprint.hashAlgorithm","TSTInfo.messageImprint.hashAlgorithm","hashAlgorithm","TSTInfo.messageImprint.parameters","hashAlgorithmParameters"),{name:"TSTInfo.messageImprint.hashedMessage",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"hashedMessage"}]},{name:"TSTInfo.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"TSTInfo.genTime",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,capture:"genTime"},{name:"TSTInfo.accuracy",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,optional:!0,capture:"accuracy",value:[{name:"TSTInfo.accuracy.seconds",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"seconds"},{name:"TSTInfo.accuracy.millis",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"millis"},{name:"TSTInfo.accuracy.micros",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"micros"}]},{name:"TSTInfo.ordering",tagClass:i.Class.UNIVERSAL,type:i.Type.BOOLEAN,constructed:!1,optional:!0,capture:"ordering"},{name:"TSTInfo.nonce",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"nonce"},{name:"TSTInfo.tsa",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"tsa"},{name:"TSTInfo.extensions",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,captureAsn1:"certExtensions"}]},t.tstInfoFromAsn1=function(e){c();var t={},r=[];if(!i.validate(e,o,t,r)){var a=new Error("Cannot read time stamp token. ASN.1 object is not an time stamp token.");throw a.errors=r,a}var n={msgImprint:{},tsa:{}};return n.version=t.version.charCodeAt(0),n.policy=i.derToOid(t.policy),n.msgImprint.hashAlg=i.derToOid(t.hashAlgorithm),n.msgImprint.hashedMessage=t.hashedMessage,n.serialNumber=t.serialNumber,n.genTime=i.generalizedTimeToDate(t.genTime),n.nonce=t.nonce,s.processGeneralName(t.tsa[0],n.tsa),n}):dreamsecurity.chkIntegrity(arguments.callee,"tsp")}var n;if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),c(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(c);if((e=e||{}).defined=e.defined||{},e.defined.tsp)return e.tsp;e.defined.tsp=!0;for(var r=0;r<t.length;++r)t[r](e);return e.tsp}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function g(c){var e,u,d,o,t,l,p,f;function y(e,t){var r={},a=[];if(!u.validate(e,f,r,a)){var n=new Error("Cannot read HashedDataInfo. ASN.1 object is not an HashedDataInfo.");throw n.errors=a,n}if(t.hashAlg=c.pki.oids[c.asn1.derToOid(r.hashAlgOid)],"string"!=typeof r.hashedData){for(var i="\0",s=0;s<r.hashedData.length;++s)i+=u.toDer(r.hashedData[s]).getBytes();r.hashedData=i}var o=c.util.createBuffer(r.hashedData);++o.read,t.hashedData=o.getBytes()}function h(e){for(var t=[],r=0;r<e.value.length;++r){var a=e.value[r],n={};if(n.id=u.derToOid(a.value[0].value),n.critical=!1,a.value[1].type===u.Type.BOOLEAN?(n.critical=0!==a.value[1].value.charCodeAt(0),n.value=a.value[2].value):n.value=a.value[1].value,!(n.id in o))throw new Error("Extension("+n.name+") is not supported.");n.name=o[n.id];var i,s=u.fromDer(n.value);"kiec_usageType"===n.name&&(i=0,1<s.value.length&&(i=s.value.charCodeAt(1)),n.online=128==(128&i),n.mobile=64==(64&i),n.paperEnable=32==(32&i)),t.push(n)}return t}null!=c||"function"!=typeof dreamsecurity.chkIntegrity?(e=c.arcCert=dreamsecurity.arcCert||{},u=c.asn1,d=c.pki,o=d.oids,t=c.pki.algIdValidator,l={name:"ARCCertInfo",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertInfo.version",tagClass:u.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"ARCCertInfo.version.integer",tagClass:u.Class.UNIVERSAL,type:u.Type.INTEGER,constructed:!1,capture:"version"}]},{name:"ARCCertInfo.serialNumber",tagClass:u.Class.UNIVERSAL,type:u.Type.INTEGER,constructed:!1,capture:"serialNumber"},{name:"ARCCertInfo.issuer",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,capture:"issuer"},{name:"ARCCertInfo.dateOfIssue",tagClass:u.Class.UNIVERSAL,type:u.Type.GENERALIZEDTIME,constructed:!1,capture:"dateOfIssue"},{name:"ARCCertInfo.dateOfExpiration",captureAsn1:"dateOfExpiration"},{name:"ARCCertInfo.policy",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertInfo.requestInfo",captureAsn1:"requestInfo"},{name:"ARCCertInfo.target",captureAsn1:"target"},{name:"ARCCertInfo.extensions",tagClass:u.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"extensions"}]},p={name:"ARCCertReq",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,value:[{name:"ARCCertReq.version",tagClass:u.Class.UNIVERSAL,type:u.Type.INTEGER,constructed:!1,options:!0,capture:"version"},{name:"ARCCertReq.requester",captureAsn1:"requester"},{name:"ARCCertReq.requestTime",captureAsn1:"requestTime"},{name:"ARCCertReq.policy",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,captureAsn1:"policy"},{name:"ARCCertReq.target",captureAsn1:"target"},{name:"ARCCertReq.nonce",tagClass:u.Class.UNIVERSAL,type:u.Type.INTEGER,constructed:!1,capture:"nonce"},{name:"ARCCertReq.extensions",tagClass:u.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"extensions"}]},f={name:"HashedDataInfo",tagClass:u.Class.UNIVERSAL,type:u.Type.SEQUENCE,constructed:!0,value:[t("HashedDataInfo.hashAlg","AlgorithmIdentifier.algorithm","hashAlgOid","AlgorithmIdentifier.parameter","parameters"),{name:"HashedDataInfo.hashedData",tagClass:u.Class.UNIVERSAL,type:u.Type.BITSTRING,constructed:!1,capture:"hashedData"}]},e.arcCertResFromAsn1=function(e){g();var t={},r=[],a=new Error("Cannot read ARCCertResponse. ASN.1 object is not an ARCCertResponse.");if(e.tagClass!==u.Class.CONTEXT_SPECIFIC)throw a;var n={};if(0!=e.type)throw 1==e.type?new Error("The ARCCertResponse is an arcErrorNotice."):a;if(!u.validate(e.value[0],l,t,r))throw a.errors=r,a;n.version=t.version.charCodeAt(0);var i=c.util.createBuffer(t.serialNumber);n.serialNumber=i.toHex(),n.issuer=[];for(var s=0;s<t.issuer.length;s++){var o={};d.processGeneralName(t.issuer[s],o),n.issuer.push(o)}return n.dateOfIssue=u.generalizedTimeToDate(t.dateOfIssue),n.dateOfExpiration=function(e){{if(e.type==u.Type.GENERALIZEDTIME)return u.generalizedTimeToDate(e.value);if(e.type==u.Type.NULL)return null}throw new Error("ASN.1 object is not an CertDateOfExpiration")}(t.dateOfExpiration),n.policy=d.processCertPolicies(t.policy),n.requestInfo=function(e){var t={},r=[];{if(e.type==u.Type.SEQUENCE){if(!u.validate(e,p,t,r)){var a=new Error("Cannot read ARCCertRequest. ASN.1 object is not an ARCCertRequest.");throw a.errors=r,a}var n={};if(n.version=t.version.charCodeAt(0),t.requester.type==u.Type.SEQUENCE){n.requester=[];for(var i=0;i<t.requester.value.length;i++){var s={};d.processGeneralName(t.requester.value[i],s),n.requester.push(s)}}else{if(t.requester.type!=u.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requester)");n.requester=null}if(t.requestTime.type==u.Type.GENERALIZEDTIME)n.requestTime=u.generalizedTimeToDate(t.requestTime.value);else{if(t.requester.type!=u.Type.NULL)throw new Error("ASN.1 object is not an ARCCertRequest (invalid requestTime)");n.requestTime=null}return n.policy=d.processCertPolicies(t.policy),n.target=function(e){var t={};{if(e.type==u.Type.SEQUENCE)throw t.choice="targetRecord",new Error("targetRecord in Target is not supported.");if(e.tagClass!=u.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0!=e.type)throw 1==e.type?(t.choice="targetDocInfo",new Error("targetDocInfo in Target is not supported.")):new Error("ASN.1 object is not an Target");t.choice="targetHash",y(e.value[0],t)}return t}(t.target),n.nonce=t.nonce,n.extensions=h(t.extensions[0]),n}if(e.type==u.Type.NULL)return null}throw new Error("ASN.1 object is not an RequestInfo")}(t.requestInfo),n.target=function(e){var t={};{if(e.tagClass!=u.Class.CONTEXT_SPECIFIC)throw new Error("ASN.1 object is not an Target");if(0==e.type)throw t.choice="opRecord",new Error("opRecord in TargetToCertify is not supported.");if(1==e.type)throw t.choice="orgAndIssued",new Error("orgAndIssued in TargetToCertify is not supported.");if(2!=e.type)throw new Error("ASN.1 object is not an Target");t.choice="dataHash",y(e.value[0],t)}return t}(t.target),n.extensions=h(t.extensions[0]),n}):dreamsecurity.chkIntegrity(arguments.callee,"arccert")}var n,i="arccert";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof dreamsecurity&&(dreamsecurity={}),g(dreamsecurity);var r=!0;define=function(e,t){t(require,module)}}var a=define;define=function(e,t){return n="string"==typeof e?t.slice(2):e.slice(2),r?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./util"],function(){(function(a,e){e.exports=function(e){var t=n.map(function(e){return a(e)}).concat(g);if((e=e||{}).defined=e.defined||{},e.defined[i])return e[i];e.defined[i]=!0;for(var r=0;r<t.length;++r)t[r](e);return e[i]}}).apply(null,Array.prototype.slice.call(arguments,0))})}(),"undefined"==typeof gpkijs&&(gpkijs={}),function y(g){if(null==g){if(dreamsecurity.chkIntegrity)return void("function"==typeof dreamsecurity.chkIntegrity&&dreamsecurity.chkIntegrity(arguments.callee,"magicjs"));throw new Error("The GPKIJS is not initialized!!")}g.version="1.2.1.3",g.md=g.md||{},g.hmac=g.hmac||{},g.cipher=g.cipher||{},g.pubKey=g.pubKey||{},g.priKey=g.priKey||{},g.pkcs5=g.pkcs5||{},g.x509Cert=g.x509Cert||{},g.x509Crl=g.x509Crl||{},g.pkcs7=g.pkcs7||{},g.pkcs7.signedData=g.pkcs7.signedData||{},g.pkcs7.envelopedData=g.pkcs7.envelopedData||{},g.pkcs7.signedAndEnvData=g.pkcs7.signedAndEnvData||{},g.pkcs10=g.pkcs10||{},g.pkcs12=g.pkcs12||{},g.tsp=g.tsp||{},g.tsp.token=g.tsp.token||{},g.arcCert=g.arcCert||{},g.arcCert.response=g.arcCert.response||{},g.pem=g.pem||{},g.base64=g.base64||{},g.hex=g.hex||{},g.utf8=g.utf8||{},g.err=g.err||{},g.ByteStringBuffer=g.ByteStringBuffer||{};var m={};function a(e,t,r,a,n){e.func=t,e.name=r,e.code=a,"string"==typeof n?e.message=n:(e.message=n.message,void 0!==n.errors&&(e.detail=n.errors))}function h(e,t,r){a(this,e,"UnsupportedError",m.msg.unsupported|t,r)}function s(e,t,r){a(this,e,"WrongPasswordError",m.msg.wrongPasswd|t,r)}function o(e,t,r){a(this,e,"RevokedError",m.msg.revoked|t,r)}function c(e,t,r){a(this,e,"ExpiredError",m.msg.expired|t,r)}function u(e,t,r){a(this,e,"VidNotExistError",m.msg.vidNotExist|t,r)}function d(e,t,r){a(this,e,"NotValidRecpError",m.msg.notValidRecp|t,r)}function l(e,t,r){a(this,e,"EncryptError",m.op.encrypt|t,r)}function p(e,t,r){a(this,e,"DecryptError",m.op.decrypt|t,r)}function f(e,t,r){a(this,e,"SignError",m.op.sign|t,r)}function C(e,t,r){a(this,e,"VerifyError",m.op.verify|t,r)}function E(e,t,r){a(this,e,"GenerateError",m.op.generate|t,r)}function v(e,t,r){a(this,e,"ProcessError",m.op.process|t,r)}function S(e,t,r){a(this,e,"EncodeError",m.op.encode|t,r)}function T(e,t,r){a(this,e,"DecodeError",m.op.decode|t,r)}function I(e,t,r){a(this,e,"LicenseError",m.op.decode|t,r)}function A(e,t,r){a(this,e,"InvalidInputError",m.msg.invalidInput|t,r)}function b(e,t,r,a){var n=dreamsecurity.err;switch(void 0!==a.type&&(e=a.type),e){case n.unsupported:throw new h(t,r,a);case n.wrongPasswd:throw new s(t,r,a);case n.revoked:throw new o(t,r,a);case n.expired:throw new c(t,r,a);case n.encrypt:throw new l(t,r,a);case n.decrypt:throw new p(t,r,a);case n.sign:throw new f(t,r,a);case n.verify:throw new C(t,r,a);case n.generate:throw new E(t,r,a);case n.process:throw new v(t,r,a);case n.encode:throw new S(t,r,a);case n.decode:throw new T(t,r,a);case n.license:throw new I(t,r,a);case n.invalidInput:throw new A(t,r,a);case n.vidNotExist:throw new u(t,r,a);default:throw a}}function N(e){var t=null;if(null!=e&&null!=e){if("string"==typeof e)return e;if("data"in e&&"string"==typeof e.data&&"read"in e&&"number"==typeof e.read)return e.data.slice(e.read)}else t=new Error("The input is null.");throw(t=t||new Error("The input is invalid type.")).type=dreamsecurity.err.invalidInput,t.code=g.err.msg.invalidInput,t}function B(e,t){var r=e.toLowerCase();if("sha256"==r||"sha1"==r)return r;throw new h(t,m.alg.md,'Unknown hash algorithm "'+r+'"')}function n(e,t){var r=void 0,a=void 0;return!e||e.scheme&&"RSAES-PKCS1-V1_5"===e.scheme.toUpperCase()||!(!e.scheme&&e.md||e.scheme&&"RSA-OAEP"===e.scheme.toUpperCase())?a="RSAES-PKCS1-V1_5":(a="RSA-OAEP",r={},e.md?r.md=dreamsecurity.md.algorithms[e.md.toLowerCase()].create():r.md=t||dreamsecurity.md.algorithms.sha1.create()),{scheme:a,schemeOpts:r}}function k(e,t){if(!e)return"RSASSA-PKCS1-V1_5";if(e.scheme&&"RSASSA-PKCS1-V1_5"===e.scheme.toUpperCase())return"RSASSA-PKCS1-V1_5";if(!e.scheme&&e.md||e.scheme&&"RSA-PSS"===e.scheme.toUpperCase()){var r=20,a="sha1";t?a=t.toLowerCase():e.md&&(a=e.md.toLowerCase());var n=dreamsecurity.md.algorithms[a].create(),r=e.saltLength?e.saltLength:n.digestLength;return dreamsecurity.pss.create({md:n,mgf:dreamsecurity.mgf.mgf1.create(dreamsecurity.md.algorithms[a].create()),saltLength:r})}return"RSASSA-PKCS1-V1_5"}function R(e){var t=null;switch(e.signAlg.name){case"sha1WithRSAEncryption":t=dreamsecurity.md.algorithms.sha1.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":default:t=dreamsecurity.md.algorithms.sha256.create()}return t}function w(e){var t="";for(i=e.attributes.length-1;0<=i;i--)i!=e.attributes.length-1&&(t+=","),t+=e.attributes[i].shortName+"="+dreamsecurity.util.decodeUtf8(e.attributes[i].value);return t}function D(e){var t={};if(t.id={oid:e.id,name:e.name},t.critical=e.critical,e.id===dreamsecurity.pki.oids.authorityKeyIdentifier)t.aki={},void 0!==e.keyIdentifier&&(t.aki.keyIdentifier=dreamsecurity.util.createBuffer(e.keyIdentifier)),void 0!==e.authorityCertIssuer&&(t.aki.authorityCertIssuer=w(e.authorityCertIssuer)),void 0!==e.authorityCertSerialNumber&&(t.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(e.authorityCertSerialNumber).toHex());else if(e.id===dreamsecurity.pki.oids.issuerAltName){t.issuerAltName=[];for(var r=0;r<e.altNames.length;r++)t.issuerAltName.push(e.altNames[r])}else e.id===dreamsecurity.pki.oids.cRLNumber?t.cRLNumber=e.cRLNumber:e.id===dreamsecurity.pki.oids.issuingDistributionPoint?(t.issuingDistributionPoint={},t.issuingDistributionPoint.distributionPoint=e.distributionPoint,t.issuingDistributionPoint.onlyContainsUserCerts=e.onlyContainsUserCerts,t.issuingDistributionPoint.onlyContainsCACerts=e.onlyContainsCACerts,t.issuingDistributionPoint.indirectCRL=e.indirectCRL,t.issuingDistributionPoint.onlyContainsAttributeCerts=e.onlyContainsAttributeCerts):e.id===dreamsecurity.pki.oids.cRLReason?t.cRLReason=e.cRLReason:e.id===dreamsecurity.pki.oids.invalidityDate&&(t.invalidityDate=e.invalidityDate);return t}function U(e){return e.key.read=0,e.parameter.read=0,{algorithm:dreamsecurity.pki.oids[e.algorithm],key:e.key,iv:e.parameter.copy()}}m.data={keyPair:16777216,secretKey:33554432,x509Cert:50331648,x509Crl:67108864,pubKey:83886080,priKey:100663296,encPriKey:117440512,signedData:134217728,envelopedData:150994944,pkcs10Csr:167772160,pkcs12Pfx:184549376,signedAndEnvData:201326592,tsp:218103808,arcCert:234881024,bitMask:251658240},m.encoding={der:1048576,base64:2097152,pem:3145728,hex:4194304,utf8:5242880,bitMask:15728640},m.alg={md:65536,symmetric:131072,asymmetric:196608,sign:262144,hmac:327680,rand:393216,bitMask:983040},m.op={encrypt:4096,decrypt:8192,sign:12288,verify:16384,generate:20480,process:24576,encode:28672,decode:32768,bitMask:61440},m.step={init:256,udpate:512,finish:768,bitMask:3840},m.msg={unsupported:1,wrongPasswd:2,revoked:3,expired:4,vidNotExist:5,notValidRecp:6,invalidInput:7,bitMask:15},g.err=m||g.err,h.prototype=Error.prototype,s.prototype=Error.prototype,o.prototype=Error.prototype,c.prototype=Error.prototype,u.prototype=Error.prototype,l.prototype=Error.prototype,p.prototype=Error.prototype,f.prototype=Error.prototype,C.prototype=Error.prototype,E.prototype=Error.prototype,v.prototype=Error.prototype,S.prototype=Error.prototype,T.prototype=Error.prototype,A.prototype=Error.prototype,g.init=function(e){"gf"===e?dreamsecurity.vi.gf=!0:dreamsecurity.vi.l=e},g.md.create=function(e){var t="ds.md.create",r=e.toLowerCase(),a={algorithm:r},n=null;if(!(r in dreamsecurity.md.algorithms))throw new h(t,m.alg.hmac,'Unknown message digest algorithm "'+r+'"');try{y(),n=dreamsecurity.md.algorithms[r].create()}catch(e){b(dreamsecurity.err.generate,t,m.alg.md|m.step.init,e)}return a.init=function(){try{n.start()}catch(e){b(dreamsecurity.err.generate,"ds.md.init",m.alg.md|m.step.init,e)}},a.update=function(e,t){try{n.update(N(e),t)}catch(e){b(dreamsecurity.err.generate,"ds.md.udpate",m.alg.md|m.step.update,e)}},a.digest=function(e,t){try{if(null!=e){if(void 0!==e.getEngine&&!0===e.getEngine)return n;n.update(N(e),t)}var r=n.digest();return n.start(),r}catch(e){b(dreamsecurity.err.generate,"ds.md.digest",m.alg.md|m.step.finish,e)}},a},g.hmac.create=function(e){var t=e.toLowerCase(),r=null,a={algorithm:t};if(!(t in dreamsecurity.md.algorithms))throw new h("ds.hamc.create",m.alg.hmac,'Unknown mac algorithm "'+t+'"');try{y(),r=dreamsecurity.hmac.create()}catch(e){b(dreamsecurity.err.generate,"ds.hamc.create",m.alg.hamc|m.step.init,e)}return a.init=function(e){try{r.start(a.algorithm,e)}catch(e){b(dreamsecurity.err.generate,"ds.hmac.init",m.alg.hmac|m.step.init,e)}},a.update=function(e){try{r.update(N(e))}catch(e){b(dreamsecurity.err.generate,"ds.hmac.udpate",m.alg.hmac|m.step.update,e)}},a.generate=function(){try{return r.digest()}catch(e){b(dreamsecurity.err.generate,"ds.hmac.generate",m.alg.hmac|m.step.finish,e)}},a.verify=function(e){try{return r.digest().toHex()==dreamsecurity.util.bytesToHex(N(e))}catch(e){b(dreamsecurity.err.generate,"ds.hmac.verify",m.alg.hmac|m.step.finish,e)}},a},g.cipher.create=function(e,t,r){var a={algorithm:t.toUpperCase(),encrypt:e},n=null;try{y();var i=0,s=a.algorithm;if(0==s.indexOf("SEED")||-1!=s.indexOf("128"))i=16;else if(0==s.indexOf("3DES")||-1!=s.indexOf("192"))i=24;else if(-1!=s.indexOf("256"))i=32;else{if(0!=s.indexOf("DES"))throw new h("ds.cipher.create",m.alg.symmetric,'Unknown cipher algorithm "'+s+'"');i=8}var o=N(r);i!=o.length&&b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",m.alg.symmetric,"The "+o.length+" bytes key length is not valid for "+s+" algorithm."),0==s.indexOf("AES")?s="AES-CBC":0==s.indexOf("ARIA")&&(s="ARIA-CBC"),n=1==e?dreamsecurity.cipher.createCipher(s,o):dreamsecurity.cipher.createDecipher(s,o)}catch(e){b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.create",m.alg.symmetric,e)}return a.init=function(e){try{n.start({iv:N(e)})}catch(e){b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.init",m.alg.symmetric|m.step.init,e)}},a.update=function(e){try{n.update(dreamsecurity.util.createBuffer(e))}catch(e){b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.update",m.alg.symmetric|m.step.update,e)}},a.finish=function(e){if(null!=e&&"pkcs5padding"!=e.toLowerCase())throw new h("ds.cipher.finish",m.alg.symmetric|m.step.finish,'Unknown padding : "'+e+'"');try{n.finish()||b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",m.alg.symmetric|m.step.finish,"The Operation failed.")}catch(e){b(a.encrypt?dreamsecurity.err.encrypt:dreamsecurity.err.decrypt,"ds.cipher.finish",m.alg.symmetric|m.step.finish,e)}return a.output=n.output,a.output},a},g.generateRandomBytes=function(e){try{return dreamsecurity.util.createBuffer(dreamsecurity.random.getBytesSync(e))}catch(e){b(dreamsecurity.err.generate,"ds.generateRandomBytes",m.alg.rand,e)}},g.generateKey=function(e,t){var r=e.toUpperCase(),a=0;if(-1!=r.indexOf("SEED")?a=16:-1!=r.indexOf("AES")||-1!=r.indexOf("ARIA")?null!=t&&null!=t.bits&&null!=t&&null!=t.bits?a=t.bits/8:-1!=r.indexOf("128")?a=16:-1!=r.indexOf("192")?a=24:-1!=r.indexOf("256")&&(a=32):-1!=r.indexOf("3DES")?a=24:-1!=r.indexOf("DES")&&(a=8),0==a)throw new h("ds.generateKey",m.alg.symmetric,'Unknown algorithm : "'+e+'"');try{return g.generateRandomBytes(a)}catch(e){throw e.func="ds.generateRandomBytes",e}},g.generateKeyPair=function(e,t){var r={},a=null,n=e.toLowerCase();if("rsa"!=n)throw new h("ds.generateKeyPair",m.alg.asymmetric,'Unknown algorithm : "'+e+'"');a=dreamsecurity.pki.rsa;try{y(),(r=a.generateKeyPair(t)).privateKey.algName=n,r.publicKey.algName=n,r.privateKey=g.priKey.create(r.privateKey),r.publicKey=g.pubKey.create(r.publicKey)}catch(e){if(void 0!==e.func)throw e.func="ds.generateKeyPair",e;b(dreamsecurity.err.generate,"ds.generateKeyPair",m.alg.asymmetric,e)}return r},g.pubKey.create=function(e){var t,c={algorithm:"",keyLength:0},r=0,u=null;try{y(),u="string"==typeof e?(t=null,t=0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,(t=dreamsecurity.pem.decode(e)[0]).body):(r=m.encoding.base64,g.base64.decode(e)),r=m.encoding.der,dreamsecurity.pki.publicKeyFromAsn1(dreamsecurity.asn1.fromDer(t))):e}catch(e){throw new T("ds.pubKey.create",m.data.pubKey|r,e)}if(c.algorithm=u.algName,null!=u.n)c.keyLength=u.n.bitLength();else{if(null==u.p)throw new h("ds.pubKey.create",m.data.pubKey,"The publicKey is not for RSA or KCDSA.");c.keyLength=u.p.bitLength()}return c.toDer=function(){var e=null;try{e=dreamsecurity.pki.publicKeyToSubjectPublicKeyInfo(u)}catch(e){throw new S("ds.pubKey.toDer",m.data.pubKey|m.encoding.der,e)}return dreamsecurity.asn1.toDer(e).copy()},c.toPem=function(){try{return g.pem.encode(c,"PUBLIC KEY")}catch(e){throw new S("ds.pubKey.toPem",m.data.pubKey|m.encoding.pem,e)}},c.verify=function(e,t,r){if("rsa"!=c.algorithm)throw new C("ds.pubKey.verify",m.data.pubKey,"Wrong usage. This verify method works when public key is for RSA.");try{var a=k(r);return u.verify(e.digest().getBytes(),N(t),a)}catch(e){b(dreamsecurity.err.verify,"ds.pubKey.verify",m.data.pubKey,e)}},c.verifySignature=function(e,t,r,a){try{var n="ds.pubKey.verifySignature",i=B(t,n);if("rsa"!=c.algorithm)return u.verify(N(e),i,N(r));var s=dreamsecurity.md.algorithms[i].create();s.update(N(e));var o=k(a);return u.verify(s.digest().getBytes(),N(r),o)}catch(e){b(dreamsecurity.err.verify,n,m.data.pubKey,e)}},c.encrypt=function(e,t){try{var r=n(t);return u.encrypt(N(e),r.scheme,r.schemeOpts)}catch(e){b(dreamsecurity.err.encrypt,"ds.pubKey.encrypt",m.data.pubKey,e)}},c.decrypt=function(e){try{return n(null),dreamsecurity.pki.rsa.decrypt(N(e),u,!0,!0)}catch(e){throw new p("ds.pubKey.decrypt",m.data.pubKey,e)}},c.k=u,c},g.priKey.create=function(e){var t,o={algorithm:"",keyLength:0},r=0,c=null;try{y(),c="string"==typeof e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pki.privateKeyFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pki.privateKeyFromAsn1(dreamsecurity.asn1.fromDer(t,!0,!1))):e}catch(e){throw new T("ds.priKey.create",m.data.priKey|r,e)}if(o.algorithm=c.algName,null!=c.n)o.keyLength=c.n.bitLength();else{if(null==c.p)throw new h("ds.priKey.create",m.data.priKey,"The priKey is not supported algorithm.");o.keyLength=c.p.bitLength()}return o.getRandomNum=function(){if(null!=c.randomNum)return c.randomNum;throw new u("ds.priKey.getRandomNum",m.data.priKey,"The priKey does not have a random number for VID.")},o.toDer=function(){var e=null;try{e=dreamsecurity.pki.priKeyToPriKeyInfo(c)}catch(e){throw new S("ds.priKey.toDer",m.data.priKey|m.encoding.der,e)}return dreamsecurity.asn1.toDer(e).copy()},o.toPem=function(){try{return g.pem.encode(o,"PRIVATE KEY")}catch(e){throw new S("ds.priKey.toPem",m.encoding.pem,e)}},o.sign=function(e,t){if("rsa"!=o.algorithm)throw new f("ds.priKey.sign",m.data.priKey,"Wrong usage. This sign method works when private key is for RSA.");var r=k(t);return c.sign(e.digest({getEngine:!0}),r)},o.generateSignature=function(e,t,r){try{var a="ds.priKey.generateSignature",n=B(t,a);if("rsa"==o.algorithm){var i=dreamsecurity.md.algorithms[n].create();i.update(N(e));var s=k(r);return c.sign(i,s)}if("kcdsa"!=o.algorithm)throw new f(a,m.data.priKey,"The "+o.algorithm+" sign is not supported.");if(null==r||null==r.pubKey||null==r.pubKey)throw new f(a,m.data.priKey,"The publicKey is requred to KCDSA sign.");return c.sign(N(e),n,r.pubKey.k.y)}catch(e){b(dreamsecurity.err.sign,a,m.data.priKey,e)}},o.decrypt=function(e,t){try{var r=n(t);return c.decrypt(N(e),r.scheme,r.schemeOpts)}catch(e){b(dreamsecurity.err.decrypt,"ds.priKey.decrypt",m.data.priKey,e)}},o.encrypt=function(e){try{return dreamsecurity.pki.rsa.encrypt(N(e),c,1)}catch(e){b(dreamsecurity.err.encrypt,"ds.priKey.encrypt",m.data.priKey,e)}},o.k=c,o},g.x509Cert.create=function(e){var t,h={},r=null,a=0;try{y(),r="string"==typeof e?0===e.lastIndexOf("-----",0)?(a=m.encoding.pem,dreamsecurity.pki.certificateFromPem(e)):(a=m.encoding.base64,t=g.base64.decode(e),a=m.encoding.der,dreamsecurity.pki.certificateFromAsn1(dreamsecurity.asn1.fromDer(t))):e}catch(e){throw new T("ds.x509Cert.create",m.data.x509Cert|a,e)}h.version=r.version+1,h.serialNum=r.serialNumber,h.issuer=w(r.issuer),h.signAlg={oid:r.signatureOid,name:dreamsecurity.pki.oids[r.signatureOid]},h.validity={notBefore:r.validity.notBefore,notAfter:r.validity.notAfter},h.subject=w(r.subject),h.pubKey=g.pubKey.create(r.publicKey),h.signature=dreamsecurity.util.createBuffer(),h.signature.putBytes(r.signature),h.extensions=[];for(var n=0;n<r.extensions.length;n++)h.extensions.push(function(e){var t={};if(t.id={oid:e.id,name:e.name},t.critical=e.critical,e.id===dreamsecurity.pki.oids.authorityKeyIdentifier)t.aki={},void 0!==e.keyIdentifier&&(t.aki.keyIdentifier=dreamsecurity.util.createBuffer(e.keyIdentifier)),void 0!==e.authorityCertIssuer&&(t.aki.authorityCertIssuer=w(e.authorityCertIssuer)),void 0!==e.authorityCertSerialNumber&&(t.aki.authorityCertSerialNumber=dreamsecurity.util.createBuffer(e.authorityCertSerialNumber).toHex());else if(e.id===dreamsecurity.pki.oids.subjectKeyIdentifier)t.ski=dreamsecurity.util.createBuffer(dreamsecurity.util.hexToBytes(e.subjectKeyIdentifier));else if(e.id===dreamsecurity.pki.oids.keyUsage)t.keyUsage={},t.keyUsage.cRLSign=e.cRLSign,t.keyUsage.dataEncipherment=e.dataEncipherment,t.keyUsage.decipherOnly=e.decipherOnly,t.keyUsage.digitalSignature=e.digitalSignature,t.keyUsage.encipherOnly=e.encipherOnly,t.keyUsage.keyAgreement=e.keyAgreement,t.keyUsage.keyCertSign=e.keyCertSign,t.keyUsage.keyEncipherment=e.keyEncipherment,t.keyUsage.nonRepudiation=e.nonRepudiation;else if(e.id===dreamsecurity.pki.oids.certificatePolicies){t.certPolicies=[];for(var r=0;r<e.certificatePolicies.length;r++)t.certPolicies.push(e.certificatePolicies[r])}else if(e.id===dreamsecurity.pki.oids.issuerAltName)for(t.issuerAltName=[],r=0;r<e.altNames.length;r++)t.issuerAltName.push(e.altNames[r]);else if(e.id===dreamsecurity.pki.oids.subjectAltName)for(t.subjectAltName=[],r=0;r<e.altNames.length;r++)t.subjectAltName.push(e.altNames[r]);else e.id===dreamsecurity.pki.oids.basicConstraints?(t.basicConsts={},t.basicConsts.cA=e.cA,t.basicConsts.pathLenConstraint=e.pathLenConstraint):e.id===dreamsecurity.pki.oids.policyConstraints?t.policyConsts=e.policyConstraints:e.id===dreamsecurity.pki.oids.cRLDistributionPoints?t.crlDPs=e.cRLDistributionPoints:e.id===dreamsecurity.pki.oids.authorityInfoAccess&&(t.aia=e.authorityInfoAccess);return t}(r.extensions[n]));return h.toPem=function(){try{return dreamsecurity.pki.certificateToPem(r)}catch(e){throw new S("ds.x509Cert.toPem",m.data.x509Cert|m.encoding.pem,e)}},h.toDer=function(){try{return dreamsecurity.asn1.toDer(dreamsecurity.pki.certificateToAsn1(r))}catch(e){throw new S("ds.x509Cert.toDer",m.data.x509Cert|m.encoding.der,e)}},h.verifyVID=function(e,t){return h.makeVID(e,t,2,!0)},h.makeVID=function(e,t,r,a){var n=!1;null!=a&&null!=a&&(n=a);var i="ds.x509Cert."+(n?"verifyVID":"makeVirtualID");try{for(var s=0,o=!1,s=0;s<h.extensions.length;s++)if(null!=h.extensions[s].subjectAltName){o=!0;break}if(!o)throw new Error("VidNotExist");for(altName=h.extensions[s].subjectAltName,s=0;s<altName.length;s++)if(null!=altName[s].otherName){if(null==altName[s].otherName.vid)throw new Error("VidNotExist");var c=dreamsecurity.asn1,u=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.PRINTABLESTRING,!1,N(t)),c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,String.fromCharCode(0)+N(e))]),d=c.toDer(u).getBytes(),l=B(altName[s].otherName.vid.hashAlg,i),p=dreamsecurity.md.algorithms[l].create();p.update(d);var f=p.digest();if(null!=r&&null!=r&&2==r){var y=dreamsecurity.md.algorithms[l].create();if(y.update(f.getBytes()),f=y.digest(),n)return f.toHex()==altName[s].otherName.vid.value.toHex()}return f}throw new Error("VidNotExist")}catch(e){e.message&&"VidNotExist"==e.message&&(e.message="The certificate does not have a vid information.",e.type=dreamsecurity.err.vidNotExist),b(dreamsecurity.err.encode,i,m.data.x509Cert|m.encoding.der,e)}},h.k=r,h},g.x509Cert.verify=function(e,t){try{y();var r=[];r[0]=e.k;for(var a=dreamsecurity.pki.createCaStore(null),n=0;n<t.length;n++)a.addCertificate(t[n].k);dreamsecurity.pki.verifyCertificateChain(a,r)}catch(e){b(dreamsecurity.err.verify,"ds.x509Cert.verify",m.data.x509Cert,e)}},g.x509Crl.create=function(e,t){var r,a={},n=null,i=0,s=0;try{y(),n="string"==typeof e?0===e.lastIndexOf("-----",0)?(s=m.encoding.pem,dreamsecurity.pki.certificateRevocationListFromPem(e)):(s=m.encoding.base64,r=g.base64.decode(e),s=m.encoding.der,dreamsecurity.pki.certificateRevocationListFromAsn1(dreamsecurity.asn1.fromDer(r))):e}catch(e){throw new T("ds.x509Crl.create",m.data.x509Crl|s,e)}try{if(a.version=n.version+1,a.issuer=w(n.issuer),a.signAlg={oid:n.signatureOid,name:dreamsecurity.pki.oids[n.signatureOid]},a.thisUpdate=n.thisUpdate,a.nextUpdate=n.nextUpdate,a.signature=dreamsecurity.util.createBuffer(),a.signature.putBytes(n.signature),a.revokedCerts=[],t)for(n.revokedCerts=dreamsecurity.pki.revokedCertificatesFromAsn1(n.revokedCertsAsn1),i=0;i<n.revokedCerts.length;i++)a.revokedCerts.push(function(e){var t={};t.userCert=e.userCertificate,t.revocationDate=e.revocationDate,t.extensions=[];for(var r=0;r<e.exts.length;r++)t.extensions.push(D(e.exts[r]));return t}(n.revokedCerts[i]));for(a.extensions=[],i=0;i<n.extensions.length;i++)a.extensions.push(D(n.extensions[i]))}catch(e){throw new v("ds.x509Crl.create",m.data.x509Crl,e)}return a.toPem=function(){try{return g.pem.encode(a,g.pem.type.crl)}catch(e){throw new S("ds.x509Crl.toPem",m.data.x509Crl|m.encoding.pem,e)}},a.toDer=function(){try{return dreamsecurity.asn1.toDer(n.toAsn1())}catch(e){throw new S("ds.x509Crl.toDer",m.data.x509Crl|m.encoding.der,e)}},a.verify=function(e){try{return n.verify(e.k)}catch(e){b(dreamsecurity.err.verify,"ds.x509Crl.verify",m.data.x509Crl,e)}},a.isRevoked=function(e){try{return n.isRevoked(e)}catch(e){throw new v("ds.x509Crl.isRevoked",m.data.x509Crl,e)}},a},g.pkcs5.encrypt=function(e,t,r){if("rsa"!==e.algorithm&&"kcdsa"!==e.algorithm)throw new h("ds.pkcs5.encrypt",m.data.priKey,"Unknown privateKey algorithm : "+e.algorithm);try{y();var a=dreamsecurity.pki.priKeyToPriKeyInfo(e.k),n=dreamsecurity.pki.encryptPrivateKey(a,N(t),r)}catch(e){throw new l("ds.pkcs5.encrypt",m.data.priKey,e)}return n},g.pkcs5.decrypt=function(e,t,r){var a,n=null,i=0;r=r||!1;try{"string"==typeof e&&(a=null,a=0===e.lastIndexOf("-----",0)?(i=m.encoding.pem,(n=g.pem.decode(e)).body):(i=m.encoding.base64,g.base64.decode(e)),i=m.encoding.der,n=dreamsecurity.asn1.fromDer(a))}catch(e){throw new T("ds.pkcs5.decrypt",m.data.encPriKey|i,e)}var s=null,o=null;try{s=dreamsecurity.pki.decryptPrivateKeyInfo(n,N(t),r)}catch(e){var c=m.data.encPriKey;void 0!==e.type&&e.type===dreamsecurity.err.decode&&(c|=m.encoding.der),b(dreamsecurity.err.decrypt,"ds.pkcs5.decrypt",c,e)}try{if(null==(o=r?s.privateKey:s))throw new Error("Confirm privateKey password.");return o=g.priKey.create(dreamsecurity.pki.privateKeyFromAsn1(o)),r?{algorithm:s.pbeAlg,version:s.pkcs5Version,fixedIv:s.fixedIv,priKey:o}:o}catch(e){void 0===e.type&&(e.message="Confirm privateKey password."),b(dreamsecurity.err.wrongPasswd,"ds.pkcs5.decrypt",m.data.encPriKey,e)}},g.pkcs5.changePassword=function(e,t,r){try{var a=g.pkcs5.decrypt(e,t,!0),n=a.algorithm.toLowerCase(),i=n.indexOf("-cbc");0<i&&(n=n.substr(0,i));var s={};s.algorithm=n,s.version=a.version,s.fixedIv=a.fixedIv;var o=dreamsecurity.pki.priKeyToPriKeyInfo(a.priKey.k);return dreamsecurity.pki.encryptPrivateKey(o,N(r),s)}catch(e){throw new v("ds.pkcs5.changePassword",e.code,e)}},g.pkcs7.signedData.format={},g.pkcs7.signedData.format.none=0,g.pkcs7.signedData.format.useContentInfo=1,g.pkcs7.signedData.format.noContent=2,g.pkcs7.signedData.format.signGateFormat=4,g.pkcs7.signedData.format.hashedContent=18,g.pkcs7.signedData.format.noSignedAttributes=32,g.pkcs7.signedData.create=function(e){var t,d={},r=0,p=null;d.contentType=null,d.content=null,d.signerInfos=[],d.certificates=[];try{y(),null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,p=dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,p=dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t)),d.contentType=p.contentType,d.content=p.content):p=dreamsecurity.pkcs7.createSignedData()}catch(e){throw new T("ds.pkcs7.signedData.create",m.data.signedData|r,e)}return d.makeTBSData=function(e,t,r){var a="ds.pkcs7.signedData.makeTBSData";try{if(r&&32&r.format||4&r.format)return e;var n=B(t,a),i=dreamsecurity.md.algorithms[n].create(),s={makeSignedAttributes:!0,signingTime:r?r.signingTime:void 0};return p.content=N(e),p.sign(null,null,i,null,null,s).getBytes()}catch(e){throw new E(a,m.data.signedData,e)}},d.compose=function(e,t,r,a,n){var i="ds.pkcs7.signedData.compose",s=null,o=null;try{if(1===e){var c,u=t;u&&(u.md&&(c=B(u.md,i),s=dreamsecurity.md.algorithms[c].create()),u.format&&(o=u.format));var d=k(u,(s=s||R(cert)).algorithm);p.content=N(r);var l={composeSignedData:!0,tbsData:a,signature:n};p.sign(u.cert.k,null,s,d,o,l)}else if(2===e){if(l={setContent:!0},null!==p.content)throw new v(i,m.data.signedData,"The signedData already contains the content.");p.content=N(t),p.sign(null,null,null,null,null,l)}}catch(e){throw new E(i,m.data.signedData,e)}},d.addSign=function(e,t,r){try{if(!d.verify())throw new v("ds.pkcs7.signedData.addSign",m.data.signedData,"There is a signature can't verify.");d.sign(e,t,r)}catch(e){throw e.func="ds.pkcs7.signedData.addSign",e}},d.sign=function(e,t,r){var a,n,i=null,s=null,o="ds.pkcs7.signedData.sign";try{r&&(r.md&&(n=B(r.md,o),i=dreamsecurity.md.algorithms[n].create()),r.format&&(s=r.format)),a=k(r,(i=i||R(e)).algorithm),p.content=N(d.content);for(var c=0,c=0;c<d.certificates.length;c++)p.addCertificate(d.certificates[c].k);var u={signingTime:r?r.signingTime:void 0};p.sign(e.k,t.k,i,a,s,u)}catch(e){throw new E(o,m.data.signedData,e)}},d.toDer=function(){try{return dreamsecurity.asn1.toDer(p.toAsn1())}catch(e){throw new S("ds.pkcs7.signedData.toDer",m.data.signedData|m.encoding.der,e)}},d.toPem=function(){try{return g.pem.encode(d,g.pem.type.pkcs7)}catch(e){throw new S("ds.pkcs7.signedData.toPem",m.data.signedData|m.encoding.pem,e)}},d.verify=function(){if(null==p.content){if(null==d.content)throw new v("ds.pkcs7.signedData.verify",m.data.signedData,"The content is required. The SignedData does not have a content.");p.content=N(d.content)}try{if(!p.verify())return!1;d.content=p.content,d.signerInfos=[],d.certificates=[];for(var e=0,t=[],e=0;e<p.certificates.length;e++)t.push(!1);var r=p.getSignerInfos();for(e=0;e<r.length;e++)t[r[e].certIndex]=!0,d.signerInfos.push({cert:g.x509Cert.create(p.certificates[r[e].certIndex]),signingTime:r[e].signingTime});for(e=0;e<t.length;e++)t[e]||d.certificates.push(g.x509Cert.create(p.certificates[e]));return!0}catch(e){throw new v("ds.pkcs7.signedData.verify",m.data.signedData,e)}},d},g.pkcs7.envelopedData.create=function(e){var t,s={},r=0,o=null;try{y(),o=null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t))):dreamsecurity.pkcs7.createEnvelopedData()}catch(e){throw new T("ds.pkcs7.envelopedData.create",m.data.envelopedData|r,e)}return s.content=null,s.contentEncInfo={},s.addRecipient=function(e,t){var r,a=null;try{t&&t.scheme&&"RSA-OAEP"==t.scheme.toUpperCase()&&(null!=t.md&&null!=t.md||(a=R(e))),r=n(t,a),o.addRecipient(e.k,r.scheme,r.schemeOpts)}catch(e){throw new E("ds.pkcs7.envelopedData.addRecipient",m.data.envelopedData,e)}},s.encrypt=function(e,t){var r=e.split("-"),a="ds.pkcs7.envelopedData.encrypt";if(r.length<2)throw new h(a,m.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+e);var n=1,i=r[0].toLowerCase();if(3===r.length&&(i+="-"+r[1].toUpperCase(),n=2),"seed"===i)algName="seed";else if("3des"===i||"des-EDE3"===i)algName="des-EDE3-";else if("aes"===i||"aes128"===i)algName="aes128-";else if("aes192"===i)algName="aes192-";else if("aes256"===i)algName="aes256-";else if("aria"===i||"aria128"===i)algName="aria";else if("aria192"===i)algName="aria192-";else{if("aria256"!==i)throw new h(a,m.alg.symmetric,"Unknown cipher algorithm  : "+e);algName="aria256-"}if(algName+=r[n].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new h(a,m.alg.symmetric,"Unknown cipher algorithm  : "+e);try{o.content=new dreamsecurity.util.ByteBuffer(s.content),o.encrypt(t,dreamsecurity.pki.oids[algName]),s.contentEncInfo=U(o.encryptedContent)}catch(e){throw new E(a,m.data.envelopedData,e)}},s.toDer=function(){try{return dreamsecurity.asn1.toDer(o.toAsn1())}catch(e){throw new S("ds.pkcs7.envelopedData.toDer",m.data.envelopedData|m.encoding.der,e)}},s.toPem=function(){try{return g.pem.encode(s,g.pem.type.pkcs7)}catch(e){throw new S("ds.pkcs7.envelopedData.toPem",m.data.envelopedData|m.encoding.pem,e)}},s.decrypt=function(e,t){var r,a="ds.pkcs7.envelopedData.decrypt";try{if(null==(r=o.findRecipient(e.k)))throw new d(a,m.data.envelopedData,"The certificiate is not a valid recipient.");o.decrypt(r,t.k),s.content=o.content.getBytes(),s.contentEncInfo=U(o.encryptedContent)}catch(e){throw new v(a,m.data.envelopedData,e)}},s},g.pkcs7.signedAndEnvData.create=function(e){var t,p={},r=0,f=null;try{y(),f=null!=e?0===e.lastIndexOf("-----",0)?(r=m.encoding.pem,dreamsecurity.pkcs7.messageFromPem(e)):(r=m.encoding.base64,t=g.base64.decode(e),r=m.encoding.der,dreamsecurity.pkcs7.messageFromAsn1(dreamsecurity.asn1.fromDer(t))):dreamsecurity.pkcs7.createSignedAndEnvelopedData()}catch(e){throw new T("ds.pkcs7.signedAndEnvData.create",m.data.signedAndEnvData|r,e)}return p.content=null,p.signerInfos=[],p.certificates=[],p.contentEncInfo={},p.signAndEnv=function(e,t,r,a){var n,i,s=null,o="ds.pkcs7.signedAndEnvData.signAndEnv";try{a&&a.md&&(i=B(a.md,o),s=dreamsecurity.md.algorithms[i].create()),n=k(a,(s=s||R(e)).algorithm);var c=r.split("-");if(c.length<2)throw new h(o,m.alg.symmetric,'Invalid cipher algorithm form. (ex. "SEED-CBC") : '+r);var u=1,d=c[0].toLowerCase();if(3===c.length&&(d+="-"+c[1].toUpperCase(),u=2),"seed"===d)algName="seed";else if("3des"===d||"des-EDE3"===d)algName="des-EDE3-";else if("aes"===d||"aes128"===d)algName="aes128-";else if("aes192"===d)algName="aes192-";else if("aes256"===d)algName="aes256-";else if("aria"===d||"aria128"===d)algName="aria";else if("aria192"===d)algName="aria192-";else{if("aria256"!==d)throw new h(o,m.alg.symmetric,"Unknown cipher algorithm  : "+r);algName="aria256-"}if(algName+=c[u].toUpperCase(),void 0===dreamsecurity.pki.oids[algName])throw new h(o,m.alg.symmetric,"Unknown cipher algorithm  : "+r);f.content=new dreamsecurity.util.ByteBuffer(p.content);for(var l=0,l=0;l<p.certificates.length;l++)f.addCertificate(p.certificates[l].k);f.signAndEnv(e.k,t.k,s,n,null,a?a.key:null,dreamsecurity.pki.oids[algName]),p.contentEncInfo=U(f.encryptedContent)}catch(e){throw new E(o,m.data.signedAndEnvData,e)}},p.toDer=function(){try{return dreamsecurity.asn1.toDer(f.toAsn1())}catch(e){throw new S("ds.pkcs7.signedAndEnvData.toDer",m.data.signedAndEnvData|m.encoding.der,e)}},p.toPem=function(){try{return g.pem.encode(p,g.pem.type.pkcs7)}catch(e){throw new S("ds.pkcs7.signedAndEnvData.toPem",m.data.signedAndEnvData|m.encoding.pem,e)}},p.verifyAndDec=function(e,t){try{var r,a="ds.pkcs7.signedAndEnvData.verifyAndDec";if(null==(r=f.findRecipient(e.k)))throw new d(a,m.data.signedAndEnvData,"The certificiate is not a valid recipient.");if(!f.verifyAndDec(r,t.k))return!1;p.content=f.content.getBytes(),p.signerInfos=[],p.certificates=[];for(var n=0,i=[],n=0;n<f.certificates.length;n++)i.push(!1);var s=f.getSignerInfos();for(n=0;n<s.length;n++)i[s[n].certIndex]=!0,p.signerInfos.push({cert:g.x509Cert.create(f.certificates[s[n].certIndex])});return p.contentEncInfo=U(f.encryptedContent),!0}catch(e){throw new v(a,m.data.signedAndEnvData,e)}},p.addRecipient=function(e,t){var r,a=null;try{t&&t.scheme&&"RSA-OAEP"==t.scheme.toUpperCase()&&(t.md||(a=R(e))),r=n(t,a),f.addRecipient(e.k,r.scheme,r.schemeOpts)}catch(e){throw new E("ds.pkcs7.signedAndEnvData.addRecipient",m.data.signedAndEnvData,e)}},p},g.pkcs10.create=function(){var o={},c=null;try{y(),c=dreamsecurity.pki.createCertificationRequest()}catch(e){throw new E("ds.pkcs10.create",m.data.pkcs10Csr,e)}return o.keyPair={},o.setSubject=function(e){for(var t=[],r=e.split(","),a={cn:"2.5.4.3",c:"2.5.4.6",o:"2.5.4.10",ou:"2.5.4.11"},n=0,n=0;n<r.length;n++){var i=r[n].split("=");if(2!=i.length)throw new E("ds.pkcs10.create",m.data.pkcs10Csr,"The dn is wrong format. : "+e);t.push({type:a[i[0]],value:i[1]})}try{c.setSubject(t)}catch(e){throw new E("ds.pkcs10.create",m.data.pkcs10Csr,e)}},o.sign=function(e,t){var r,a,n,i=null,s="ds.pkcs10.sign";i=null==e?dreamsecurity.md.algorithms.sha256.create():"string"==typeof e?(r=B(e,s),dreamsecurity.md.algorithms[r].create()):e.digest({getEngine:!0});try{null!=o.keyPair.privateKey&&null!=o.keyPair.publicKey||(a="",n=0,n=null!=t?(a=null==t.algorithm?"rsa":t.algorithm.toLowerCase(),null==t.bits?2048:t.bits):(a="rsa",2048),o.keyPair=g.generateKeyPair(a,{bits:n})),c.version=0,c.publicKey=o.keyPair.publicKey.k,c.sign(o.keyPair.privateKey.k,i)}catch(e){b(dreamsecurity.err.generate,s,m.data.pkcs10Csr,e)}},o.toPem=function(){try{return g.pem.encode(o,g.pem.type.pkcs10)}catch(e){throw new S("ds.pkcs10.toPem",m.data.pkcs10Csr|m.encoding.pem,e)}},o.toDer=function(){try{return dreamsecurity.asn1.toDer(dreamsecurity.pki.certificationRequestToAsn1(c))}catch(e){throw new S("ds.pkcs10.toDer",m.data.pkcs10Csr|m.encoding.der,e)}},o},g.pkcs12.format={},g.pkcs12.format.encPriKey=1,g.pkcs12.format.noEncCert=2,g.pkcs12.create=function(e){var l={},p=null;try{y()}catch(e){throw new E("ds.pkcs10.create",m.data.pkcs10Csr,e)}return p=null!=e?e:null,l.safeContents=[],l.certificates=[],l.exportPfx=function(e,t){if(0===l.safeContents.length)throw new E("ds.pkcs12.exportPfx",m.data.pkcs12Pfx,"A certificate and priKey pair is not setted.");try{for(var r=0,a=[],n=[],r=0;r<l.safeContents.length;r++){var i=null;t&&t.format&&t.format&g.pkcs12.format.encPriKey&&(i=0===l.safeContents[r].priKey.lastIndexOf("-----",0)?g.pem.decode(l.safeContents[r].priKey).body:g.base64.decode(l.safeContents[r].priKey)),null==i&&(i=l.safeContents[r].priKey.k),a.push({cert:l.safeContents[r].cert.k,priKey:i,keyId:String.fromCharCode(4)+String.fromCharCode(4)+String.fromCharCode(r+1)+String.fromCharCode(0)+String.fromCharCode(0)+String.fromCharCode(0)})}for(r=0;r<l.certificates.length;r++)n.push(l.certificates[r].k);l.pfx=dreamsecurity.pkcs12.toPkcs12Asn1(a,n,N(e),t)}catch(e){throw new E("ds.pkcs12.exportPfx",m.data.pkcs12Pfx,e)}},l.toDer=function(){try{return dreamsecurity.asn1.toDer(l.pfx)}catch(e){throw new S("ds.pkcs12.toDer",m.data.pkcs12Pfx|m.encoding.der,e)}},l.importPfx=function(e,t){try{m.encoding.base64;var r=dreamsecurity.util.decode64(p),r=dreamsecurity.asn1.fromDer(r);p=dreamsecurity.pkcs12.pkcs12FromAsn1(r,!0,N(e),t)}catch(e){if(e.type!=dreamsecurity.err.wrongPasswd)throw new v("ds.pkcs12.importPfx",m.data.pkcs12Pfx,e);b(dreamsecurity.err.wrongPasswd,"ds.pkcs12.importPfx",m.data.pkcs12Pfx,e)}var a=0,n=0,i=[],s=[],o=[];try{for(a=0;a<p.safeContents.length;a++)for(var c=0,u=p.safeContents[a],c=0;c<u.safeBags.length;c++)if(null!=u.safeBags[c].attributes.localKeyId)if(0==a){for(var d=-1,n=0;n<i.length;n++)if(i[n]===u.safeBags[c].attributes.localKeyId[0]){d=n;break}-1==d&&i.push(u.safeBags[c].attributes.localKeyId[0]),null!=u.safeBags[c].key?-1==d?(o.push(u.safeBags[c].key),s.push(null)):o[n]=u.safeBags[c].key:-1==d?(o.push(null),s.push(u.safeBags[c].cert)):s[n]=u.safeBags[c].cert}else for(n=0;n<i.length;n++)i[n]===u.safeBags[c].attributes.localKeyId[0]&&(null!=u.safeBags[c].key?o[n]=u.safeBags[c].key:s[n]=u.safeBags[c].cert);else l.certificates.push(g.x509Cert.create(u.safeBags[c].cert));for(a=0;a<i.length;a++)t&&t.format&&t.format&g.pkcs12.format.encPriKey?l.safeContents.push({cert:g.x509Cert.create(s[a]),priKey:dreamsecurity.asn1.toDer(o[a])}):l.safeContents.push({cert:g.x509Cert.create(s[a]),priKey:g.priKey.create(o[a])})}catch(e){throw new v("ds.pkcs12.importPfx",m.data.pkcs12Pfx,e)}},l},g.tsp.token.create=function(e){var s={signerCert:null};if(!e)throw new A("ds.tsp.token.create",m.data.tsp,"The input data is empty.");try{y(),s.token=g.pkcs7.signedData.create(e)}catch(e){throw new T("ds.tsp.token.create",m.data.tsp|m.encoding.der,e)}if(s.token.contentType!==dreamsecurity.oids.tstInfo)throw new A("ds.tsp.token.create",m.data.tsp,"The input data is not a timeStampToken.");try{s.info=dreamsecurity.tsp.tstInfoFromAsn1(dreamsecurity.asn1.fromDer(s.token.content))}catch(e){throw new T("ds.tsp.token.create",m.data.tsp|m.encoding.der,e)}return s.info.tsa=w(s.info.tsa.dn),s.verify=function(e,t){if(!s.token.verify())throw new C("ds.tsp.token.verify",m.data.tsp|m.alg.sign,"Verification of a signature in timeStampToken is failed.");try{var r=s.info.msgImprint,a=dreamsecurity.oids[r.hashAlg],n=dreamsecurity.md.algorithms[a].create();n.update(N(e));var i=n.digest()}catch(e){throw new C("ds.tsp.token.verify",m.data.tsp,"Verification of a messageImprint in timeStampToken is failed. ("+e.message+")")}if(i.toHex()!=dreamsecurity.util.bytesToHex(N(r.hashedMessage)))throw new C("ds.tsp.token.verify",m.data.tsp|m.alg.md,"The msg is not for this timeStampToken (The messageImprint is different).");if(1!=s.token.signerInfos.length)throw new C("ds.tsp.token.verify",m.data.tsp,"The count of signer is not 1.");s.signerCert=s.token.signerInfos[0].cert},s},g.arcCert.response.create=function(e){var t="ds.arcCert.response.create",i={signerCert:null};if(!e)throw new A(t,m.data.arccert,"The input data is empty.");try{y(),i.response=g.pkcs7.signedData.create(e)}catch(e){throw new T(t,m.data.arccert|m.encoding.der,e)}if(i.response.contentType!==dreamsecurity.oids.arcCertRes)throw new A(t,m.data.arccert,"The input data is not a arcCertResponse.");try{i.info=dreamsecurity.arcCert.arcCertResFromAsn1(dreamsecurity.asn1.fromDer(i.response.content))}catch(e){throw new T(t,m.data.arccert|m.encoding.der,e)}return i.verify=function(e,t){var r="ds.arcCert.response.verify";if(!i.response.verify())throw new C(r,m.data.arcCert|m.alg.sign,"Verification of a signature in ArcCert is failed.");try{var a=i.info.target;if("dataHash"!=a.choice)throw new h(r,m.data.arcCert,a.choice+" in Target is not supported");var n=dreamsecurity.md.algorithms[a.hashAlg].create();if(n.update(N(e)),n.digest().toHex()!=dreamsecurity.util.bytesToHex(N(a.hashedData)))throw new C(r,m.data.arcCert|m.alg.md,"The msg is not for this ArcCert (The dataHash is different).")}catch(e){throw new C(r,m.data.arcCert,"Verification of a dataHash in ArcCert is failed. ("+e.message+")")}if(1!=i.response.signerInfos.length)throw new C(r,m.data.arcCert,"The count of signer is not 1.");i.signerCert=i.response.signerInfos[0].cert},i},g.pem.type={},g.pem.type.publicKey="PUBLIC KEY",g.pem.type.privateKey="PRIVATE KEY",g.pem.type.rsaPubKey="RSA PUBLIC KEY",g.pem.type.rsaPriKey="RSA PRIVATE KEY",g.pem.type.cert="CERTIFICATE",g.pem.type.crl="X509 CRL",g.pem.type.pkcs7="PKCS7",g.pem.type.pkcs10="CERTIFICATE REQUEST",g.pem.type.encPriKey="ENCRYPTED PRIVATE KEY",g.pem.encode=function(e,t){var r={};try{return y(),r.type=t,"toDer"in e?r.body=e.toDer().getBytes():r.body=N(e),dreamsecurity.pem.encode(r)}catch(e){b(dreamsecurity.err.encode,"ds.pem.encode",m.encoding.pem,e.type&&e.message?e.message:"The "+t+" pem encoding failed.")}},g.pem.decode=function(e){try{return y(),dreamsecurity.pem.decode(N(e))[0]}catch(e){b(dreamsecurity.err.decode,"ds.pem.decode",m.encoding.pem,e.type&&e.message?e.message:"The pem decoding failed.")}},g.base64.encode=function(e){try{return y(),dreamsecurity.util.encode64(N(e))}catch(e){b(dreamsecurity.err.encode,"ds.base64.encode",m.encoding.base64,e.type&&e.message?e.message:"The Base64 encoding failed.")}},g.base64.decode=function(e){try{return y(),dreamsecurity.util.decode64(N(e))}catch(e){b(dreamsecurity.err.decode,"ds.base64.decode",m.encoding.base64,e.type&&e.message?e.message:"The Base64 decoding failed.")}},g.hex.encode=function(e){try{return y(),dreamsecurity.util.bytesToHex(N(e))}catch(e){b(dreamsecurity.err.encode,"ds.hex.encode",m.encoding.hex,e.type&&e.message?e.message:"The Hex encoding failed.")}},g.hex.decode=function(e){try{return y(),dreamsecurity.util.hexToBytes(N(e))}catch(e){b(dreamsecurity.err.decode,"ds.hex.decode",m.encoding.hex,e.type&&e.message?e.message:"The Hex decoding failed.")}},g.utf8.encode=function(e){try{return y(),dreamsecurity.util.encodeUtf8(N(e))}catch(e){b(dreamsecurity.err.encode,"ds.utf8.encode",m.encoding.utf8,e.type&&e.message?e:"The UTF8 encoding failed.")}},g.utf8.decode=function(e){try{return y(),dreamsecurity.util.decodeUtf8(N(e))}catch(e){b(dreamsecurity.err.decode,m.encoding.utf8,e.type&&e.message?e.message:"The UTF8 decoding failed.")}},g.ByteStringBuffer.create=function(e){return y(),dreamsecurity.util.createBuffer(e)},"function"==typeof Object.freeze&&Object.freeze(g)}(gpkijs);